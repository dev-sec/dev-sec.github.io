{"name":"cis-docker-benchmark","title":"CIS Docker Benchmark Profile","maintainer":"DevSec Hardening Framework Team","copyright":"DevSec Hardening Framework Team","copyright_email":"hello@dev-sec.io","license":"Apache-2.0","summary":"An InSpec Compliance Profile for the CIS Docker Benchmark","version":"2.1.0","inspec_version":">= 2.3.23","attributes":[{"name":"container_user","required":false,"description":"define user within containers.","default":"ubuntu","type":"string"},{"name":"container_capadd","required":true,"description":"define needed capabilities for containers.","type":"string"},{"name":"app_armor_profile","required":false,"description":"define apparmor profile for Docker containers.","default":"docker-default","type":"string"},{"name":"selinux_profile","required":false,"description":"define SELinux profile for Docker containers.","default":"label:level:s0-s0:c1023","type":"string"},{"name":"trusted_user","required":false,"description":"define trusted user to control Docker daemon.","default":"vagrant","type":"string"},{"name":"managable_container_number","required":true,"description":"keep number of containers on a host to a manageable total.","default":25,"type":"numeric"},{"name":"benchmark_version","required":true,"description":"to execute also the old controls from previous benchmarks. to execute the controls, define the value as 1.12.0","type":"string"},{"name":"registry_cert_path","required":true,"description":"directory contains various Docker registry directories.","default":"/etc/docker/certs.d","type":"string"},{"name":"registry_name","required":true,"description":"directory contain certificate certain Docker registry.","default":"/etc/docker/certs.d/registry_hostname:port","type":"string"},{"name":"registry_ca_file","required":false,"description":"directory contain certificate certain Docker registry.","default":"/etc/docker/certs.d/registry_hostname:port/ca.crt","type":"string"},{"name":"daemon_tlscacert","required":false,"description":"Trust certs signed only by this CA","default":"/etc/docker/ssl/ca.pem","type":"string"},{"name":"daemon_tlscert","required":false,"description":"Path to TLS certificate file","default":"/etc/docker/ssl/server_cert.pem","type":"string"},{"name":"daemon_tlskey","required":false,"description":"Path to TLS key file","default":"/etc/docker/ssl/server_key.pem","type":"string"},{"name":"authorization_plugin","required":false,"description":"define authorization plugin to manage access to Docker daemon.","default":"authz-broker","type":"string"},{"name":"log_driver","required":false,"description":"define preferable way to store logs.","default":"syslog","type":"string"},{"name":"log_opts","required":false,"description":"define Docker daemon log-opts.","default":"syslog-address","type":"string"},{"name":"swarm_mode","required":false,"description":"define the swarm mode, `active` or `inactive`","default":"inactive","type":"string"},{"name":"swarm_max_manager_nodes","required":false,"description":"number of manager nodes in a swarm","default":3,"type":"numeric"},{"name":"swarm_port","required":false,"description":"port of the swarm node","default":2377,"type":"numeric"},{"name":"seccomp_default_profile","required":false,"description":"define the default seccomp profile","default":"default","type":"string"}],"supports":[],"controls":[{"title":"Create a user for the container","desc":"Create a non-root user for the container in the Dockerfile for the container image.\n\n  Rationale: It is a good practice to run the container as a non-root user, if possible. Though user namespace mapping is now available, if a user is already defined in the container image, the container is run as that user by default and specific user namespace remapping is not required.","descriptions":{"default":"Create a non-root user for the container in the Dockerfile for the container image.\n\n  Rationale: It is a good practice to run the container as a non-root user, if possible. Though user namespace mapping is now available, if a user is already defined in the container image, the container is run as that user by default and specific user namespace remapping is not required."},"impact":1.0,"refs":[{"url":"https://github.com/docker/docker/issues/2918","ref":"Having non-root privileges on the host and root inside the container"},{"url":"https://github.com/docker/docker/pull/4572","ref":"Support for user namespaces"},{"url":"https://github.com/docker/docker/issues/7906","ref":"Proposal: Support for user namespaces"},{"url":"https://docs.docker.com/engine/security/","ref":"Secure Engine"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.1","cis-docker-1.13.0":"4.1","level:1":null},"code":"control 'docker-4.1' do\n  impact 1.0\n  title 'Create a user for the container'\n  desc 'Create a non-root user for the container in the Dockerfile for the container image.\n\n  Rationale: It is a good practice to run the container as a non-root user, if possible. Though user namespace mapping is now available, if a user is already defined in the container image, the container is run as that user by default and specific user namespace remapping is not required.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.1'\n  tag 'cis-docker-1.13.0': '4.1'\n  tag 'level:1'\n  ref 'Having non-root privileges on the host and root inside the container', url: 'https://github.com/docker/docker/issues/2918'\n  ref 'Support for user namespaces', url: 'https://github.com/docker/docker/pull/4572'\n  ref 'Proposal: Support for user namespaces', url: 'https://github.com/docker/docker/issues/7906'\n  ref 'Secure Engine', url: 'https://docs.docker.com/engine/security/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[Config User]) { should_not eq nil }\n      its(%w[Config User]) { should eq CONTAINER_USER }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":33},"id":"docker-4.1"},{"title":"Use trusted base images for containers","desc":"Ensure that the container image is written either from scratch or is based on another established and trusted base image downloaded over a secure channel.\n\n  Rationale: Official repositories are Docker images curated and optimized by the Docker community or the vendor. There could be other potentially unsafe public repositories. You should thus exercise a lot of caution when obtaining container images.","descriptions":{"default":"Ensure that the container image is written either from scratch or is based on another established and trusted base image downloaded over a secure channel.\n\n  Rationale: Official repositories are Docker images curated and optimized by the Docker community or the vendor. There could be other potentially unsafe public repositories. You should thus exercise a lot of caution when obtaining container images."},"impact":1.0,"refs":[{"url":"https://titanous.com/posts/docker-insecurity","ref":"Docker Image Insecurity"},{"url":"https://hub.docker.com/","ref":"Docker Hub"},{"url":"https://blog.docker.com/2014/10/docker-1-3-signed-images-process-injection-security-options-mac-shared-directories/","ref":"Docker 1.3: signed images, process injection, security options, Mac shared directories"},{"url":"https://github.com/docker/docker/issues/8093","ref":"Proposal: Provenance step 1 - Transform images for validation and verification"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"},{"url":"https://github.com/docker/docker/pull/11109","ref":"Add support for referring to images by digest"},{"url":"https://blog.docker.com/2015/11/docker-trusted-registry-1-4/","ref":"Announcing Docker Trusted Registry 1.4 – New User Interface, Integrated Content Trust and Support for Docker Engine 1.9"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.2","cis-docker-1.13.0":"4.2","level:1":null},"code":"control 'docker-4.2' do\n  impact 1.0\n  title 'Use trusted base images for containers'\n  desc 'Ensure that the container image is written either from scratch or is based on another established and trusted base image downloaded over a secure channel.\n\n  Rationale: Official repositories are Docker images curated and optimized by the Docker community or the vendor. There could be other potentially unsafe public repositories. You should thus exercise a lot of caution when obtaining container images.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.2'\n  tag 'cis-docker-1.13.0': '4.2'\n  tag 'level:1'\n  ref 'Docker Image Insecurity', url: 'https://titanous.com/posts/docker-insecurity'\n  ref 'Docker Hub', url: 'https://hub.docker.com/'\n  ref 'Docker 1.3: signed images, process injection, security options, Mac shared directories', url: 'https://blog.docker.com/2014/10/docker-1-3-signed-images-process-injection-security-options-mac-shared-directories/'\n  ref 'Proposal: Provenance step 1 - Transform images for validation and verification', url: 'https://github.com/docker/docker/issues/8093'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n  ref 'Add support for referring to images by digest', url: 'https://github.com/docker/docker/pull/11109'\n  ref 'Announcing Docker Trusted Registry 1.4 – New User Interface, Integrated Content Trust and Support for Docker Engine 1.9', url: 'https://blog.docker.com/2015/11/docker-trusted-registry-1-4/'\n\n  describe os_env('DOCKER_CONTENT_TRUST') do\n    its('content') { should eq '1' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":57},"id":"docker-4.2"},{"title":"Do not install unnecessary packages in the container","desc":"Containers tend to be minimal and slim down versions of the Operating System. Do not install anything that does not justify the purpose of container.\n\n  Rationale: Bloating containers with unnecessary software could possibly increase the attack surface of the container. This also voids the concept of minimal and slim down versions of container images. Hence, do not install anything else apart from what is truly needed for the purpose of the container.","descriptions":{"default":"Containers tend to be minimal and slim down versions of the Operating System. Do not install anything that does not justify the purpose of container.\n\n  Rationale: Bloating containers with unnecessary software could possibly increase the attack surface of the container. This also voids the concept of minimal and slim down versions of container images. Hence, do not install anything else apart from what is truly needed for the purpose of the container."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/get-started/","ref":"Get Started, Part 1: Orientation and setup"},{"url":"http://www.livewyer.com/blog/2015/02/24/slimming-down-your-docker-containers-alpine-linux","ref":"Slimming down your Docker containers with Alpine Linux"},{"url":"https://github.com/progrium/busybox","ref":"busybox"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.3","cis-docker-1.13.0":"4.3","level:1":null},"code":"control 'docker-4.3' do\n  impact 1.0\n  title 'Do not install unnecessary packages in the container'\n  desc 'Containers tend to be minimal and slim down versions of the Operating System. Do not install anything that does not justify the purpose of container.\n\n  Rationale: Bloating containers with unnecessary software could possibly increase the attack surface of the container. This also voids the concept of minimal and slim down versions of container images. Hence, do not install anything else apart from what is truly needed for the purpose of the container.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.3'\n  tag 'cis-docker-1.13.0': '4.3'\n  tag 'level:1'\n  ref 'Get Started, Part 1: Orientation and setup', url: 'https://docs.docker.com/get-started/'\n  ref 'Slimming down your Docker containers with Alpine Linux', url: 'http://www.livewyer.com/blog/2015/02/24/slimming-down-your-docker-containers-alpine-linux'\n  ref 'busybox', url: 'https://github.com/progrium/busybox'\n\n  describe 'docker-test' do\n    skip 'Do not install unnecessary packages in the container'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":81},"id":"docker-4.3"},{"title":"Rebuild the images to include security patches","desc":"Instead of patching your containers and images, rebuild the images from scratch and instantiate new containers from it.\n\n  Rationale: Vulnerabilities are loopholes/bugs that can be exploited and security patches are updates to resolve these vulnerabilities. We can use image vulnerability scanning tools to find any kind of vulnerabilities within the images and then check for available patches to mitigate these vulnerabilities. Patches update the system to the most recent code base. Being on the current code base is important because that's where vendors focus on fixing problems. Evaluate the security patches before applying and follow the patching best practices. Also, it would be better if, image vulnerability scanning tools could perform binary level analysis or hash based verification instead of just version string matching.","descriptions":{"default":"Instead of patching your containers and images, rebuild the images from scratch and instantiate new containers from it.\n\n  Rationale: Vulnerabilities are loopholes/bugs that can be exploited and security patches are updates to resolve these vulnerabilities. We can use image vulnerability scanning tools to find any kind of vulnerabilities within the images and then check for available patches to mitigate these vulnerabilities. Patches update the system to the most recent code base. Being on the current code base is important because that's where vendors focus on fixing problems. Evaluate the security patches before applying and follow the patching best practices. Also, it would be better if, image vulnerability scanning tools could perform binary level analysis or hash based verification instead of just version string matching."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/get-started/","ref":"Get Started, Part 1: Orientation and setup"},{"url":" https://docs.docker.com/docker-cloud/builds/image-scan/","ref":"Docker Security Scan"},{"url":"https://blog.docker.com/2016/05/docker-security-scanning/","ref":"Docker Security Scanning safeguards the container content lifecycle"},{"url":"https://docs.docker.com/engine/reference/builder/","ref":"Dockerfile reference"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.4","cis-docker-1.13.0":"4.4","level:1":null},"code":"control 'docker-4.4' do\n  impact 1.0\n  title 'Rebuild the images to include security patches'\n  desc 'Instead of patching your containers and images, rebuild the images from scratch and instantiate new containers from it.\n\n  Rationale: Vulnerabilities are loopholes/bugs that can be exploited and security patches are updates to resolve these vulnerabilities. We can use image vulnerability scanning tools to find any kind of vulnerabilities within the images and then check for available patches to mitigate these vulnerabilities. Patches update the system to the most recent code base. Being on the current code base is important because that\\'s where vendors focus on fixing problems. Evaluate the security patches before applying and follow the patching best practices. Also, it would be better if, image vulnerability scanning tools could perform binary level analysis or hash based verification instead of just version string matching.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.4'\n  tag 'cis-docker-1.13.0': '4.4'\n  tag 'level:1'\n  ref 'Get Started, Part 1: Orientation and setup', url: 'https://docs.docker.com/get-started/'\n  ref 'Docker Security Scan', url: ' https://docs.docker.com/docker-cloud/builds/image-scan/'\n  ref 'Docker Security Scanning safeguards the container content lifecycle', url: 'https://blog.docker.com/2016/05/docker-security-scanning/'\n  ref 'Dockerfile reference', url: 'https://docs.docker.com/engine/reference/builder/'\n\n  describe 'docker-test' do\n    skip 'Rebuild the images to include security patches'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":101},"id":"docker-4.4"},{"title":"Enable Content trust for Docker","desc":"Content trust is disabled by default. You should enable it.\n\n  Rationale: Content trust provides the ability to use digital signatures for data sent to and received from remote Docker registries. These signatures allow client-side verification of the integrity and publisher of specific image tags. This ensures provenance of container images.","descriptions":{"default":"Content trust is disabled by default. You should enable it.\n\n  Rationale: Content trust provides the ability to use digital signatures for data sent to and received from remote Docker registries. These signatures allow client-side verification of the integrity and publisher of specific image tags. This ensures provenance of container images."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/trust/content_trust/","ref":"Content trust in Docker"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/#notary","ref":"Notary"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/#environment-variables","ref":"Environment variables"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.5","cis-docker-1.13.0":"4.5","level:2":null},"code":"control 'docker-4.5' do\n  impact 1.0\n  title 'Enable Content trust for Docker'\n  desc 'Content trust is disabled by default. You should enable it.\n\n  Rationale: Content trust provides the ability to use digital signatures for data sent to and received from remote Docker registries. These signatures allow client-side verification of the integrity and publisher of specific image tags. This ensures provenance of container images.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.5'\n  tag 'cis-docker-1.13.0': '4.5'\n  tag 'level:2'\n  ref 'Content trust in Docker', url: 'https://docs.docker.com/engine/security/trust/content_trust/'\n  ref 'Notary', url: 'https://docs.docker.com/engine/reference/commandline/cli/#notary'\n  ref 'Environment variables', url: 'https://docs.docker.com/engine/reference/commandline/cli/#environment-variables'\n\n  describe os_env('DOCKER_CONTENT_TRUST') do\n    its('content') { should eq '1' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":122},"id":"docker-4.5"},{"title":"Add HEALTHCHECK instruction to the container image","desc":"Add HEALTHCHECK instruction in your docker container images to perform the health check on running containers.\n\n  Rationale: One of the important security triads is availability. Adding HEALTHCHECK instruction to your container image ensures that the docker engine periodically checks the running container instances against that instruction to ensure that the instances are still working. Based on the reported health status, the docker engine could then exit non-working containers and instantiate new ones.","descriptions":{"default":"Add HEALTHCHECK instruction in your docker container images to perform the health check on running containers.\n\n  Rationale: One of the important security triads is availability. Adding HEALTHCHECK instruction to your container image ensures that the docker engine periodically checks the running container instances against that instruction to ensure that the instances are still working. Based on the reported health status, the docker engine could then exit non-working containers and instantiate new ones."},"impact":0.0,"refs":[{"url":"https://github.com/moby/moby/pull/22719","ref":"Add support for user-defined healthchecks"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.6","cis-docker-1.13.0":"4.6","level:1":null},"code":"control 'docker-4.6' do\n  impact 0.0\n  title 'Add HEALTHCHECK instruction to the container image'\n  desc 'Add HEALTHCHECK instruction in your docker container images to perform the health check on running containers.\n\n  Rationale: One of the important security triads is availability. Adding HEALTHCHECK instruction to your container image ensures that the docker engine periodically checks the running container instances against that instruction to ensure that the instances are still working. Based on the reported health status, the docker engine could then exit non-working containers and instantiate new ones.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.6'\n  tag 'cis-docker-1.13.0': '4.6'\n  tag 'level:1'\n  ref 'Add support for user-defined healthchecks', url: 'https://github.com/moby/moby/pull/22719'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[Config Healthcheck]) { should_not eq nil }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":142},"id":"docker-4.6"},{"title":"Do not use update instructions alone in the Dockerfile","desc":"Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile.\n\n  Rationale: Adding the update instructions in a single line on the Dockerfile will cache the update layer. Thus, when you build any image later using the same instruction, previously cached update layer will be used. This could potentially deny any fresh updates to go in the later builds.","descriptions":{"default":"Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile.\n\n  Rationale: Adding the update instructions in a single line on the Dockerfile will cache the update layer. Thus, when you build any image later using the same instruction, previously cached update layer will be used. This could potentially deny any fresh updates to go in the later builds."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/","ref":"Best practices for writing Dockerfiles"},{"url":"https://github.com/moby/moby/issues/3313","ref":"caching and apt-get update"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.7","cis-docker-1.13.0":"4.7","level:1":null},"code":"control 'docker-4.7' do\n  impact 1.0\n  title 'Do not use update instructions alone in the Dockerfile'\n  desc 'Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile.\n\n  Rationale: Adding the update instructions in a single line on the Dockerfile will cache the update layer. Thus, when you build any image later using the same instruction, previously cached update layer will be used. This could potentially deny any fresh updates to go in the later builds.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.7'\n  tag 'cis-docker-1.13.0': '4.7'\n  tag 'level:1'\n  ref 'Best practices for writing Dockerfiles', url: 'https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/'\n  ref 'caching and apt-get update', url: 'https://github.com/moby/moby/issues/3313'\n\n  docker.images.ids.each do |id|\n    describe command(\"docker --no-trunc history #{id}| grep -e 'update'\") do\n      its('stdout') { should eq '' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":162},"id":"docker-4.7"},{"title":"Remove setuid and setgid permissions in the images","desc":"Removing setuid and setgid permissions in the images would prevent privilege escalation attacks in the containers.\n\n  Rationale: setuid and setgid permissions could be used for elevating privileges. While these permissions are at times legitimately needed, these could potentially be used in privilege escalation attacks. Thus, you should consider dropping these permissions for the packages which do not need them within the images.","descriptions":{"default":"Removing setuid and setgid permissions in the images would prevent privilege escalation attacks in the containers.\n\n  Rationale: setuid and setgid permissions could be used for elevating privileges. While these permissions are at times legitimately needed, these could potentially be used in privilege escalation attacks. Thus, you should consider dropping these permissions for the packages which do not need them within the images."},"impact":1.0,"refs":[{"url":"https://github.com/dev-sec/linux-baseline","ref":"DevSec Linux Baseline"},{"url":"http://www.oreilly.com/webops-perf/free/files/docker-security.pdf","ref":"Docker Security"},{"url":"http://container-solutions.com/content/uploads/2015/06/15.06.15_DockerCheatSheet_A2.pdf","ref":"Docker Security Cheat Sheet"},{"url":"http://man7.org/linux/man-pages/man2/setuid.2.html","ref":"setuid - set user identity"},{"url":"http://man7.org/linux/man-pages/man2/setgid.2.html","ref":"setgid - set group identity"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.8","cis-docker-1.13.0":"4.8","level:2":null},"code":"control 'docker-4.8' do\n  impact 1.0\n  title 'Remove setuid and setgid permissions in the images'\n  desc 'Removing setuid and setgid permissions in the images would prevent privilege escalation attacks in the containers.\n\n  Rationale: setuid and setgid permissions could be used for elevating privileges. While these permissions are at times legitimately needed, these could potentially be used in privilege escalation attacks. Thus, you should consider dropping these permissions for the packages which do not need them within the images.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.8'\n  tag 'cis-docker-1.13.0': '4.8'\n  tag 'level:2'\n  ref 'DevSec Linux Baseline', url: 'https://github.com/dev-sec/linux-baseline'\n  ref 'Docker Security', url: 'http://www.oreilly.com/webops-perf/free/files/docker-security.pdf'\n  ref 'Docker Security Cheat Sheet', url: 'http://container-solutions.com/content/uploads/2015/06/15.06.15_DockerCheatSheet_A2.pdf'\n  ref 'setuid - set user identity', url: 'http://man7.org/linux/man-pages/man2/setuid.2.html'\n  ref 'setgid - set group identity', url: 'http://man7.org/linux/man-pages/man2/setgid.2.html'\n\n  describe 'docker-test' do\n    skip 'Use DevSec Linux Baseline in Container'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":183},"id":"docker-4.8"},{"title":"Use COPY instead of ADD in Dockerfile","desc":"Use COPY instruction instead of ADD instruction in the Dockerfile.\n\n  Rationale: COPY instruction just copies the files from the local host machine to the container file system. ADD instruction potentially could retrieve files from remote URLs and perform operations such as unpacking. Thus, ADD instruction introduces risks such as adding malicious files from URLs without scanning and unpacking procedure vulnerabilities.","descriptions":{"default":"Use COPY instruction instead of ADD instruction in the Dockerfile.\n\n  Rationale: COPY instruction just copies the files from the local host machine to the container file system. ADD instruction potentially could retrieve files from remote URLs and perform operations such as unpacking. Thus, ADD instruction introduces risks such as adding malicious files from URLs without scanning and unpacking procedure vulnerabilities."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/","ref":"Best practices for writing Dockerfiles"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.9","cis-docker-1.13.0":"4.9","level:1":null},"code":"control 'docker-4.9' do\n  impact 1.0\n  title 'Use COPY instead of ADD in Dockerfile'\n  desc 'Use COPY instruction instead of ADD instruction in the Dockerfile.\n\n  Rationale: COPY instruction just copies the files from the local host machine to the container file system. ADD instruction potentially could retrieve files from remote URLs and perform operations such as unpacking. Thus, ADD instruction introduces risks such as adding malicious files from URLs without scanning and unpacking procedure vulnerabilities.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.9'\n  tag 'cis-docker-1.13.0': '4.9'\n  tag 'level:1'\n  ref 'Best practices for writing Dockerfiles', url: 'https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/'\n\n  docker.images.ids.each do |id|\n    describe command(\"docker --no-trunc history #{id}| grep 'ADD'\") do\n      its('stdout') { should eq '' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":205},"id":"docker-4.9"},{"title":"Do not store secrets in Dockerfiles","desc":"Do not store any secrets in Dockerfiles.\n\n  Rationale: Dockerfiles could be backtracked easily by using native Docker commands such as docker history and various tools and utilities. Also, as a general practice, image publishers provide Dockerfiles to build the credibility for their images. Hence, the secrets within these Dockerfiles could be easily exposed and potentially be exploited.","descriptions":{"default":"Do not store any secrets in Dockerfiles.\n\n  Rationale: Dockerfiles could be backtracked easily by using native Docker commands such as docker history and various tools and utilities. Also, as a general practice, image publishers provide Dockerfiles to build the credibility for their images. Hence, the secrets within these Dockerfiles could be easily exposed and potentially be exploited."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/issues/13490","ref":"Secrets: write-up best practices, do's and don'ts, roadmap"},{"url":"https://12factor.net/config","ref":"The Twelve-Factor App"},{"url":"https://avicoder.me/2016/07/22/Twitter-Vine-Source-code-dump/","ref":"Twitter's Vine Source code dump"}],"tags":{"docker":null,"cis-docker-1.12.0":"4.10","cis-docker-1.13.0":"4.10","level:1":null},"code":"control 'docker-4.10' do\n  impact 1.0\n  title 'Do not store secrets in Dockerfiles'\n  desc 'Do not store any secrets in Dockerfiles.\n\n  Rationale: Dockerfiles could be backtracked easily by using native Docker commands such as docker history and various tools and utilities. Also, as a general practice, image publishers provide Dockerfiles to build the credibility for their images. Hence, the secrets within these Dockerfiles could be easily exposed and potentially be exploited.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '4.10'\n  tag 'cis-docker-1.13.0': '4.10'\n  tag 'level:1'\n  ref 'Secrets: write-up best practices, do\\'s and don\\'ts, roadmap', url: 'https://github.com/moby/moby/issues/13490'\n  ref 'The Twelve-Factor App', url: 'https://12factor.net/config'\n  ref 'Twitter\\'s Vine Source code dump', url: 'https://avicoder.me/2016/07/22/Twitter-Vine-Source-code-dump/'\n\n  describe 'docker-test' do\n    skip 'Manually verify that you have not used secrets in images'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":225},"id":"docker-4.10"},{"title":"Install verified packages only","desc":"Verify authenticity of the packages before installing them in the image.\n\n  Rationale: Verifying authenticity of the packages is essential for building a secure container image. Tampered packages could potentially be malicious or have some known vulnerabilities that could be exploited.","descriptions":{"default":"Verify authenticity of the packages before installing them in the image.\n\n  Rationale: Verifying authenticity of the packages is essential for building a secure container image. Tampered packages could potentially be malicious or have some known vulnerabilities that could be exploited."},"impact":1.0,"refs":[{"url":"http://www.oreilly.com/webops-perf/free/files/docker-security.pdf","ref":"Docker Security"},{"url":"https://github.com/docker-library/httpd/blob/12bf8c8883340c98b3988a7bade8ef2d0d6dcf8a/2.4/Dockerfile","ref":"Dockerfile HTTPD"},{"url":"https://github.com/docker-library/php/blob/d8a4ccf4d620ec866d5b42335b699742df08c5f0/7.0/alpine/Dockerfile","ref":"Dockerfile PHP Alpine"},{"url":"https://access.redhat.com/security/team/key","ref":"Product Signing (GPG) Keys"}],"tags":{"docker":null,"cis-docker-1.13.0":"4.11","level:1":null},"code":"control 'docker-4.11' do\n  impact 1.0\n  title 'Install verified packages only'\n  desc 'Verify authenticity of the packages before installing them in the image.\n\n  Rationale: Verifying authenticity of the packages is essential for building a secure container image. Tampered packages could potentially be malicious or have some known vulnerabilities that could be exploited.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '4.11'\n  tag 'level:1'\n  ref 'Docker Security', url: 'http://www.oreilly.com/webops-perf/free/files/docker-security.pdf'\n  ref 'Dockerfile HTTPD', url: 'https://github.com/docker-library/httpd/blob/12bf8c8883340c98b3988a7bade8ef2d0d6dcf8a/2.4/Dockerfile'\n  ref 'Dockerfile PHP Alpine', url: 'https://github.com/docker-library/php/blob/d8a4ccf4d620ec866d5b42335b699742df08c5f0/7.0/alpine/Dockerfile'\n  ref 'Product Signing (GPG) Keys', url: 'https://access.redhat.com/security/team/key'\n\n  describe 'docker-test' do\n    skip 'Manually verify that you installed verified packages'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_images.rb","line":245},"id":"docker-4.11"},{"title":"Verify AppArmor Profile, if applicable","desc":"AppArmor is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Debian and Ubuntu.\n\n  Rationale: AppArmor protects the Linux OS and applications from various threats by enforcing security policy which is also known as AppArmor profile. You can create your own AppArmor profile for containers or use the Docker's default AppArmor profile. This would enforce security policies on the containers as defined in the profile.","descriptions":{"default":"AppArmor is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Debian and Ubuntu.\n\n  Rationale: AppArmor protects the Linux OS and applications from various threats by enforcing security policy which is also known as AppArmor profile. You can create your own AppArmor profile for containers or use the Docker's default AppArmor profile. This would enforce security policies on the containers as defined in the profile."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/security/","ref":"Docker Security"},{"url":"https://docs.docker.com/engine/security/","ref":"Secure Engine"},{"url":"https://docs.docker.com/engine/security/apparmor/","ref":"AppArmor security profiles for Docker"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.1","cis-docker-1.13.0":"5.1","level:1":null},"code":"control 'docker-5.1' do\n  impact 1.0\n  title 'Verify AppArmor Profile, if applicable'\n  desc 'AppArmor is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Debian and Ubuntu.\n\n  Rationale: AppArmor protects the Linux OS and applications from various threats by enforcing security policy which is also known as AppArmor profile. You can create your own AppArmor profile for containers or use the Docker\\'s default AppArmor profile. This would enforce security policies on the containers as defined in the profile.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.1'\n  tag 'cis-docker-1.13.0': '5.1'\n  tag 'level:1'\n  ref 'Docker Security', url: 'https://docs.docker.com/engine/security/security/'\n  ref 'Secure Engine', url: 'https://docs.docker.com/engine/security/'\n  ref 'AppArmor security profiles for Docker', url: 'https://docs.docker.com/engine/security/apparmor/'\n\n  only_if { %w[ubuntu debian].include? os[:name] }\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(['AppArmorProfile']) { should include(APP_ARMOR_PROFILE) }\n      its(['AppArmorProfile']) { should_not eq nil }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":35},"id":"docker-5.1"},{"title":"Verify SELinux security options, if applicable","desc":"SELinux is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Red Hat and Fedora.\n\n  Rationale: SELinux provides a Mandatory Access Control (MAC) system that greatly augments the default Discretionary Access Control (DAC) model. You can thus add an extra layer of safety by enabling SELinux on your Linux host, if applicable.","descriptions":{"default":"SELinux is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Red Hat and Fedora.\n\n  Rationale: SELinux provides a Mandatory Access Control (MAC) system that greatly augments the default Discretionary Access Control (DAC) model. You can thus add an extra layer of safety by enabling SELinux on your Linux host, if applicable."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/security/","ref":"Docker Security"},{"url":"https://docs.docker.com/engine/security/","ref":"Secure Engine"},{"url":"https://docs.docker.com/engine/security/apparmor/","ref":"AppArmor security profiles for Docker"},{"url":"https://github.com/docker/docker/issues/22826","ref":"Bug: Wrong SELinux label for devmapper device"},{"url":"https://bugzilla.redhat.com/show_bug.cgi?id=1312665","ref":"Bug: selinux break docker user namespace"},{"url":"https://docs-old.fedoraproject.org/en-US/Fedora/13/html/Security-Enhanced_Linux/","ref":"Security-Enhanced Linux"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.2","cis-docker-1.13.0":"5.2","level:2":null},"code":"control 'docker-5.2' do\n  impact 1.0\n  title 'Verify SELinux security options, if applicable'\n  desc 'SELinux is an effective and easy-to-use Linux application security system. It is available on quite a few Linux distributions by default such as Red Hat and Fedora.\n\n  Rationale: SELinux provides a Mandatory Access Control (MAC) system that greatly augments the default Discretionary Access Control (DAC) model. You can thus add an extra layer of safety by enabling SELinux on your Linux host, if applicable.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.2'\n  tag 'cis-docker-1.13.0': '5.2'\n  tag 'level:2'\n  ref 'Docker Security', url: 'https://docs.docker.com/engine/security/security/'\n  ref 'Secure Engine', url: 'https://docs.docker.com/engine/security/'\n  ref 'AppArmor security profiles for Docker', url: 'https://docs.docker.com/engine/security/apparmor/'\n  ref 'Bug: Wrong SELinux label for devmapper device', url: 'https://github.com/docker/docker/issues/22826'\n  ref 'Bug: selinux break docker user namespace', url: 'https://bugzilla.redhat.com/show_bug.cgi?id=1312665'\n  ref 'Security-Enhanced Linux', url: 'https://docs-old.fedoraproject.org/en-US/Fedora/13/html/Security-Enhanced_Linux/'\n\n  only_if { %w[centos redhat].include? os[:name] }\n  describe json('/etc/docker/daemon.json') do\n    its(['selinux-enabled']) { should eq(true) }\n  end\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig SecurityOpt]) { should_not eq nil }\n      its(%w[HostConfig SecurityOpt]) { should include(SELINUX_PROFILE) }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":59},"id":"docker-5.2"},{"title":"Restrict Linux Kernel Capabilities within containers","desc":"By default, Docker starts containers with a restricted set of Linux Kernel Capabilities. It means that any process may be granted the required capabilities instead of root access. Using Linux Kernel Capabilities, the processes do not have to run as root for almost all the specific areas where root privileges are usually needed.\n\n  Rationale: Docker supports the addition and removal of capabilities, allowing use of a non-default profile. This may make Docker more secure through capability removal, or less secure through the addition of capabilities. It is thus recommended to remove all capabilities except those explicitly required for your container process.\n\n  For example, capabilities such as below are usually not needed for container process: NET_ADMIN, SYS_ADMIN, SYS_MODULE","descriptions":{"default":"By default, Docker starts containers with a restricted set of Linux Kernel Capabilities. It means that any process may be granted the required capabilities instead of root access. Using Linux Kernel Capabilities, the processes do not have to run as root for almost all the specific areas where root privileges are usually needed.\n\n  Rationale: Docker supports the addition and removal of capabilities, allowing use of a non-default profile. This may make Docker more secure through capability removal, or less secure through the addition of capabilities. It is thus recommended to remove all capabilities except those explicitly required for your container process.\n\n  For example, capabilities such as below are usually not needed for container process: NET_ADMIN, SYS_ADMIN, SYS_MODULE"},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/security/","ref":"Docker Security"},{"url":"https://docs.docker.com/engine/security/","ref":"Secure Engine"},{"url":"http://man7.org/linux/man-pages/man7/capabilities.7.html","ref":"capabilities - overview of Linux capabilities"},{"url":"http://www.oreilly.com/webops-perf/free/files/docker-security.pdf","ref":"Docker Security Book"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.3","cis-docker-1.13.0":"5.3","level:1":null},"code":"control 'docker-5.3' do\n  impact 1.0\n  title 'Restrict Linux Kernel Capabilities within containers'\n  desc 'By default, Docker starts containers with a restricted set of Linux Kernel Capabilities. It means that any process may be granted the required capabilities instead of root access. Using Linux Kernel Capabilities, the processes do not have to run as root for almost all the specific areas where root privileges are usually needed.\n\n  Rationale: Docker supports the addition and removal of capabilities, allowing use of a non-default profile. This may make Docker more secure through capability removal, or less secure through the addition of capabilities. It is thus recommended to remove all capabilities except those explicitly required for your container process.\n\n  For example, capabilities such as below are usually not needed for container process: NET_ADMIN, SYS_ADMIN, SYS_MODULE'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.3'\n  tag 'cis-docker-1.13.0': '5.3'\n  tag 'level:1'\n  ref 'Docker Security', url: 'https://docs.docker.com/engine/security/security/'\n  ref 'Secure Engine', url: 'https://docs.docker.com/engine/security/'\n  ref 'capabilities - overview of Linux capabilities', url: 'http://man7.org/linux/man-pages/man7/capabilities.7.html'\n  ref 'Docker Security Book', url: 'http://www.oreilly.com/webops-perf/free/files/docker-security.pdf'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig CapDrop]) { should include(/all/) }\n      its(%w[HostConfig CapDrop]) { should_not eq nil }\n      its(%w[HostConfig CapAdd]) { should eq CONTAINER_CAPADD }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":90},"id":"docker-5.3"},{"title":"Do not use privileged containers","desc":"Using the --privileged flag gives all Linux Kernel Capabilities to the container thus overwriting the --cap-add and --cap-drop flags. Ensure that it is not used.\n\n  Rationale: The --privileged flag gives all capabilities to the container, and it also lifts all the limitations enforced by the device cgroup controller. In other words, the container can then do almost everything that the host can do. This flag exists to allow special use-cases, like running Docker within Docker.","descriptions":{"default":"Using the --privileged flag gives all Linux Kernel Capabilities to the container thus overwriting the --cap-add and --cap-drop flags. Ensure that it is not used.\n\n  Rationale: The --privileged flag gives all capabilities to the container, and it also lifts all the limitations enforced by the device cgroup controller. In other words, the container can then do almost everything that the host can do. This flag exists to allow special use-cases, like running Docker within Docker."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.4","cis-docker-1.13.0":"5.4","level:1":null},"code":"control 'docker-5.4' do\n  impact 1.0\n  title 'Do not use privileged containers'\n  desc 'Using the --privileged flag gives all Linux Kernel Capabilities to the container thus overwriting the --cap-add and --cap-drop flags. Ensure that it is not used.\n\n  Rationale: The --privileged flag gives all capabilities to the container, and it also lifts all the limitations enforced by the device cgroup controller. In other words, the container can then do almost everything that the host can do. This flag exists to allow special use-cases, like running Docker within Docker.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.4'\n  tag 'cis-docker-1.13.0': '5.4'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig Privileged]) { should eq false }\n      its(%w[HostConfig Privileged]) { should_not eq true }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":117},"id":"docker-5.4"},{"title":"Do not mount sensitive host system directories on containers","desc":"Sensitive host system directories such as '/, /boot, /dev, /etc, /lib, /proc, /sys, /usr' should not be allowed to be mounted as container volumes especially in read-write mode.\n\n  Rationale: If sensitive directories are mounted in read-write mode, it would be possible to make changes to files within those sensitive directories. The changes might bring down security implications or unwarranted changes that could put the Docker host in compromised state.","descriptions":{"default":"Sensitive host system directories such as '/, /boot, /dev, /etc, /lib, /proc, /sys, /usr' should not be allowed to be mounted as container volumes especially in read-write mode.\n\n  Rationale: If sensitive directories are mounted in read-write mode, it would be possible to make changes to files within those sensitive directories. The changes might bring down security implications or unwarranted changes that could put the Docker host in compromised state."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/volumes/volumes/","ref":"Use volumes"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.5","cis-docker-1.13.0":"5.5","level:1":null},"code":"control 'docker-5.5' do\n  impact 1.0\n  title 'Do not mount sensitive host system directories on containers'\n  desc 'Sensitive host system directories such as \\'/, /boot, /dev, /etc, /lib, /proc, /sys, /usr\\' should not be allowed to be mounted as container volumes especially in read-write mode.\n\n  Rationale: If sensitive directories are mounted in read-write mode, it would be possible to make changes to files within those sensitive directories. The changes might bring down security implications or unwarranted changes that could put the Docker host in compromised state.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.5'\n  tag 'cis-docker-1.13.0': '5.5'\n  tag 'level:1'\n  ref 'Use volumes', url: 'https://docs.docker.com/engine/admin/volumes/volumes/'\n\n  docker.containers.running?.ids.each do |id|\n    info = docker.object(id)\n    info['Mounts'].each do |mounts|\n      describe mounts['Source'] do\n        it { should_not eq '/' }\n        it { should_not match(%r{\\/boot}) }\n        it { should_not match(%r{\\/dev}) }\n        it { should_not match(%r{\\/etc}) }\n        it { should_not match(%r{\\/lib}) }\n        it { should_not match(%r{\\/proc}) }\n        it { should_not match(%r{\\/sys}) }\n        it { should_not match(%r{\\/usr}) }\n      end\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":138},"id":"docker-5.5"},{"title":"Do not run ssh within containers","desc":"SSH server should not be running within the container. You should SSH into the Docker host, and use nsenter tool to enter a container from a remote host.\n\n  Rationale: Running SSH within the container increases the complexity of security management by making it\n\n            Difficult to manage access policies and security compliance for SSH server\n            Difficult to manage keys and passwords across various containers\n            Difficult to manage security upgrades for SSH server\n\n  It is possible to have shell access to a container without using SSH, the needlessly increasing the complexity of security management should be avoided.","descriptions":{"default":"SSH server should not be running within the container. You should SSH into the Docker host, and use nsenter tool to enter a container from a remote host.\n\n  Rationale: Running SSH within the container increases the complexity of security management by making it\n\n            Difficult to manage access policies and security compliance for SSH server\n            Difficult to manage keys and passwords across various containers\n            Difficult to manage security upgrades for SSH server\n\n  It is possible to have shell access to a container without using SSH, the needlessly increasing the complexity of security management should be avoided."},"impact":1.0,"refs":[{"url":"https://blog.docker.com/2014/06/why-you-dont-need-to-run-sshd-in-docker/","ref":"Why you don't need to run SSHd in your Docker containers"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.6","cis-docker-1.13.0":"5.6","level:1":null},"code":"control 'docker-5.6' do\n  impact 1.0\n  title 'Do not run ssh within containers'\n  desc 'SSH server should not be running within the container. You should SSH into the Docker host, and use nsenter tool to enter a container from a remote host.\n\n  Rationale: Running SSH within the container increases the complexity of security management by making it\n\n            Difficult to manage access policies and security compliance for SSH server\n            Difficult to manage keys and passwords across various containers\n            Difficult to manage security upgrades for SSH server\n\n  It is possible to have shell access to a container without using SSH, the needlessly increasing the complexity of security management should be avoided.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.6'\n  tag 'cis-docker-1.13.0': '5.6'\n  tag 'level:1'\n  ref 'Why you don\\'t need to run SSHd in your Docker containers', url: 'https://blog.docker.com/2014/06/why-you-dont-need-to-run-sshd-in-docker/'\n\n  docker.containers.running?.ids.each do |id|\n    execute_command = 'docker exec ' + id + ' ps -e'\n    describe command(execute_command) do\n      its('stdout') { should_not match(/ssh/) }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":168},"id":"docker-5.6"},{"title":"Do not map privileged ports within containers","desc":"The TCP/IP port numbers below 1024 are considered privileged ports. Normal users and processes are not allowed to use them for various security reasons. Docker allows a container port to be mapped to a privileged port.\n\n  Rationale: By default, if the user does not specifically declare the container port to host port mapping, Docker automatically and correctly maps the container port to one available in 49153-65535 block on the host. But, Docker allows a container port to be mapped to a privileged port on the host if the user explicitly declared it. This is so because containers are executed with NET_BIND_SERVICE Linux kernel capability that does not restrict the privileged port mapping. The privileged ports receive and transmit various sensitive and privileged data. Allowing containers to use them can bring serious implications.","descriptions":{"default":"The TCP/IP port numbers below 1024 are considered privileged ports. Normal users and processes are not allowed to use them for various security reasons. Docker allows a container port to be mapped to a privileged port.\n\n  Rationale: By default, if the user does not specifically declare the container port to host port mapping, Docker automatically and correctly maps the container port to one available in 49153-65535 block on the host. But, Docker allows a container port to be mapped to a privileged port on the host if the user explicitly declared it. This is so because containers are executed with NET_BIND_SERVICE Linux kernel capability that does not restrict the privileged port mapping. The privileged ports receive and transmit various sensitive and privileged data. Allowing containers to use them can bring serious implications."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/default_network/binding/","ref":"Bind container ports to the host"},{"url":"https://www.adayinthelifeof.nl/2012/03/12/why-putting-ssh-on-another-port-than-22-is-bad-idea/","ref":"Why putting SSH on another port than 22 is bad idea"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.7","cis-docker-1.13.0":"5.7","level:1":null},"code":"control 'docker-5.7' do\n  impact 1.0\n  title 'Do not map privileged ports within containers'\n  desc 'The TCP/IP port numbers below 1024 are considered privileged ports. Normal users and processes are not allowed to use them for various security reasons. Docker allows a container port to be mapped to a privileged port.\n\n  Rationale: By default, if the user does not specifically declare the container port to host port mapping, Docker automatically and correctly maps the container port to one available in 49153-65535 block on the host. But, Docker allows a container port to be mapped to a privileged port on the host if the user explicitly declared it. This is so because containers are executed with NET_BIND_SERVICE Linux kernel capability that does not restrict the privileged port mapping. The privileged ports receive and transmit various sensitive and privileged data. Allowing containers to use them can bring serious implications.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.7'\n  tag 'cis-docker-1.13.0': '5.7'\n  tag 'level:1'\n  ref 'Bind container ports to the host', url: 'https://docs.docker.com/engine/userguide/networking/default_network/binding/'\n  ref 'Why putting SSH on another port than 22 is bad idea', url: 'https://www.adayinthelifeof.nl/2012/03/12/why-putting-ssh-on-another-port-than-22-is-bad-idea/'\n\n  docker.containers.running?.ids.each do |id|\n    container_info = docker.object(id)\n    next if container_info['NetworkSettings']['Ports'].nil?\n    container_info['NetworkSettings']['Ports'].each do |_, hosts|\n      next if hosts.nil?\n      hosts.each do |host|\n        describe host['HostPort'].to_i.between?(1, 1024) do\n          it { should eq false }\n        end\n      end\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":195},"id":"docker-5.7"},{"title":"Open only needed ports on container","desc":"Dockerfile for a container image defines the ports to be opened by default on a container instance. The list of ports may or may not be relevant to the application you are running within the container.\n\n  Rationale: A container can be run just with the ports defined in the Dockerfile for its image or can be arbitrarily passed run time parameters to open a list of ports. Additionally, Overtime, Dockerfile may undergo various changes and the list of exposed ports may or may not be relevant to the application you are running within the container. Opening unneeded ports increase the attack surface of the container and the containerized application. As a recommended practice, do not open unneeded ports.","descriptions":{"default":"Dockerfile for a container image defines the ports to be opened by default on a container instance. The list of ports may or may not be relevant to the application you are running within the container.\n\n  Rationale: A container can be run just with the ports defined in the Dockerfile for its image or can be arbitrarily passed run time parameters to open a list of ports. Additionally, Overtime, Dockerfile may undergo various changes and the list of exposed ports may or may not be relevant to the application you are running within the container. Opening unneeded ports increase the attack surface of the container and the containerized application. As a recommended practice, do not open unneeded ports."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/default_network/binding/","ref":"Bind container ports to the host"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.8","cis-docker-1.13.0":"5.8","level:1":null},"code":"control 'docker-5.8' do\n  impact 1.0\n  title 'Open only needed ports on container'\n  desc 'Dockerfile for a container image defines the ports to be opened by default on a container instance. The list of ports may or may not be relevant to the application you are running within the container.\n\n  Rationale: A container can be run just with the ports defined in the Dockerfile for its image or can be arbitrarily passed run time parameters to open a list of ports. Additionally, Overtime, Dockerfile may undergo various changes and the list of exposed ports may or may not be relevant to the application you are running within the container. Opening unneeded ports increase the attack surface of the container and the containerized application. As a recommended practice, do not open unneeded ports.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.8'\n  tag 'cis-docker-1.13.0': '5.8'\n  tag 'level:1'\n  ref 'Bind container ports to the host', url: 'https://docs.docker.com/engine/userguide/networking/default_network/binding/'\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":223},"id":"docker-5.8"},{"title":"Do not share the host's network namespace","desc":"The networking mode on a container when set to '--net=host', skips placing the container inside separate network stack. In essence, this choice tells Docker to not containerize the container's networking. This would network-wise mean that the container lives \"outside\" in the main Docker host and has full access to its network interfaces.\n\n  Rationale: This is potentially dangerous. It allows the container process to open low-numbered ports like any other root process. It also allows the container to access network services like D-bus on the Docker host. Thus, a container process can potentially do unexpected things such as shutting down the Docker host. You should not use this option.","descriptions":{"default":"The networking mode on a container when set to '--net=host', skips placing the container inside separate network stack. In essence, this choice tells Docker to not containerize the container's networking. This would network-wise mean that the container lives \"outside\" in the main Docker host and has full access to its network interfaces.\n\n  Rationale: This is potentially dangerous. It allows the container process to open low-numbered ports like any other root process. It also allows the container to access network services like D-bus on the Docker host. Thus, a container process can potentially do unexpected things such as shutting down the Docker host. You should not use this option."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/","ref":"Docker container networking"},{"url":"https://github.com/docker/docker/issues/6401","ref":"Rebooting within docker container actually reboots the host"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.9","cis-docker-1.13.0":"5.9","level:1":null},"code":"control 'docker-5.9' do\n  impact 1.0\n  title 'Do not share the host\\'s network namespace'\n  desc 'The networking mode on a container when set to \\'--net=host\\', skips placing the container inside separate network stack. In essence, this choice tells Docker to not containerize the container\\'s networking. This would network-wise mean that the container lives \"outside\" in the main Docker host and has full access to its network interfaces.\n\n  Rationale: This is potentially dangerous. It allows the container process to open low-numbered ports like any other root process. It also allows the container to access network services like D-bus on the Docker host. Thus, a container process can potentially do unexpected things such as shutting down the Docker host. You should not use this option.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.9'\n  tag 'cis-docker-1.13.0': '5.9'\n  tag 'level:1'\n  ref 'Docker container networking', url: 'https://docs.docker.com/engine/userguide/networking/'\n  ref 'Rebooting within docker container actually reboots the host', url: 'https://github.com/docker/docker/issues/6401'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig NetworkMode]) { should_not eq 'host' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":237},"id":"docker-5.9"},{"title":"Limit memory usage for container","desc":"By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as memory limit, you can control the amount of memory that a container may consume.\n\n  Rationale: By default, container can use all of the memory on the host. You can use memory limit mechanism to prevent a denial of service arising from one container consuming all of the host’s resources such that other containers on the same host cannot perform their intended functions. Having no limit on memory can lead to issues where one container can easily make the whole system unstable and as a result unusable.","descriptions":{"default":"By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as memory limit, you can control the amount of memory that a container may consume.\n\n  Rationale: By default, container can use all of the memory on the host. You can use memory limit mechanism to prevent a denial of service arising from one container consuming all of the host’s resources such that other containers on the same host cannot perform their intended functions. Having no limit on memory can lead to issues where one container can easily make the whole system unstable and as a result unusable."},"impact":1.0,"refs":[{"url":"https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/","ref":"Resource management in Docker"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"},{"url":"https://docs.docker.com/engine/admin/runmetrics/","ref":"Runtime metrics"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.10","cis-docker-1.13.0":"5.10","level:1":null},"code":"control 'docker-5.10' do\n  impact 1.0\n  title 'Limit memory usage for container'\n  desc 'By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as memory limit, you can control the amount of memory that a container may consume.\n\n  Rationale: By default, container can use all of the memory on the host. You can use memory limit mechanism to prevent a denial of service arising from one container consuming all of the host’s resources such that other containers on the same host cannot perform their intended functions. Having no limit on memory can lead to issues where one container can easily make the whole system unstable and as a result unusable.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.10'\n  tag 'cis-docker-1.13.0': '5.10'\n  tag 'level:1'\n  ref 'Resource management in Docker', url: 'https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n  ref 'Runtime metrics', url: 'https://docs.docker.com/engine/admin/runmetrics/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig Memory]) { should_not eq 0 }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":258},"id":"docker-5.10"},{"title":"Set container CPU priority appropriately","desc":"By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as CPU shares, you can control the host CPU resources that a container may consume.\n\n  Rationale: By default, CPU time is divided between containers equally. If it is desired, to control the CPU time amongst the container instances, you can use CPU sharing feature. CPU sharing allows to prioritize one container over the other and forbids the lower priority container to claim CPU resources more often. This ensures that the high priority containers are served better.","descriptions":{"default":"By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as CPU shares, you can control the host CPU resources that a container may consume.\n\n  Rationale: By default, CPU time is divided between containers equally. If it is desired, to control the CPU time amongst the container instances, you can use CPU sharing feature. CPU sharing allows to prioritize one container over the other and forbids the lower priority container to claim CPU resources more often. This ensures that the high priority containers are served better."},"impact":1.0,"refs":[{"url":"https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/","ref":"Resource management in Docker"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"},{"url":"https://docs.docker.com/engine/admin/runmetrics/","ref":"Runtime metrics"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.11","cis-docker-1.13.0":"5.11","level:1":null},"code":"control 'docker-5.11' do\n  impact 1.0\n  title 'Set container CPU priority appropriately'\n  desc 'By default, all containers on a Docker host share the resources equally. By using the resource management capabilities of Docker host, such as CPU shares, you can control the host CPU resources that a container may consume.\n\n  Rationale: By default, CPU time is divided between containers equally. If it is desired, to control the CPU time amongst the container instances, you can use CPU sharing feature. CPU sharing allows to prioritize one container over the other and forbids the lower priority container to claim CPU resources more often. This ensures that the high priority containers are served better.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.11'\n  tag 'cis-docker-1.13.0': '5.11'\n  tag 'level:1'\n  ref 'Resource management in Docker', url: 'https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n  ref 'Runtime metrics', url: 'https://docs.docker.com/engine/admin/runmetrics/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig CpuShares]) { should_not eq 0 }\n      its(%w[HostConfig CpuShares]) { should_not eq 1024 }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":280},"id":"docker-5.11"},{"title":"Mount container's root filesystem as read only","desc":"The container's root file system should be treated as a 'golden image' and any writes to the root filesystem should be avoided. You should explicitly define a container volume for writing.\n\n  Rationale: You should not be writing data within containers. The data volume belonging to a container should be explicitly defined and administered. This is useful in many cases where the admin controls where they would want developers to write files and errors. Also, this has other advantages such as below:\n\n      This leads to an immutable infrastructure\n      Since the container instance cannot be written to, there is no need to audit instance divergence\n      Reduced security attack vectors since the instance cannot be tampered with or written to\n      Ability to use a purely volume based backup without backing up anything from theinstance","descriptions":{"default":"The container's root file system should be treated as a 'golden image' and any writes to the root filesystem should be avoided. You should explicitly define a container volume for writing.\n\n  Rationale: You should not be writing data within containers. The data volume belonging to a container should be explicitly defined and administered. This is useful in many cases where the admin controls where they would want developers to write files and errors. Also, this has other advantages such as below:\n\n      This leads to an immutable infrastructure\n      Since the container instance cannot be written to, there is no need to audit instance divergence\n      Reduced security attack vectors since the instance cannot be tampered with or written to\n      Ability to use a purely volume based backup without backing up anything from theinstance"},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.12","cis-docker-1.13.0":"5.12","level:1":null},"code":"control 'docker-5.12' do\n  impact 1.0\n  title 'Mount container\\'s root filesystem as read only'\n  desc 'The container\\'s root file system should be treated as a \\'golden image\\' and any writes to the root filesystem should be avoided. You should explicitly define a container volume for writing.\n\n  Rationale: You should not be writing data within containers. The data volume belonging to a container should be explicitly defined and administered. This is useful in many cases where the admin controls where they would want developers to write files and errors. Also, this has other advantages such as below:\n\n      This leads to an immutable infrastructure\n      Since the container instance cannot be written to, there is no need to audit instance divergence\n      Reduced security attack vectors since the instance cannot be tampered with or written to\n      Ability to use a purely volume based backup without backing up anything from theinstance'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.12'\n  tag 'cis-docker-1.13.0': '5.12'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig ReadonlyRootfs]) { should eq true }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":303},"id":"docker-5.12"},{"title":"Bind incoming container traffic to a specific host interface","desc":"By default, Docker containers can make connections to the outside world, but the outside world cannot connect to containers. Each outgoing connection will appear to originate from one of the host machine's own IP addresses. Only allow container services to be contacted through a specific external interface on the host machine.\n\n  Rationale: If you have multiple network interfaces on your host machine, the container can accept connections on the exposed ports on any network interface. This might not be desired and may not be secured. Many a times a particular interface is exposed externally and services such as intrusion detection, intrusion prevention, firewall, load balancing, etc. are run on those interfaces to screen incoming public traffic. Hence, you should not accept incoming connections on any interface. You should only allow incoming connections from a particular external interface.","descriptions":{"default":"By default, Docker containers can make connections to the outside world, but the outside world cannot connect to containers. Each outgoing connection will appear to originate from one of the host machine's own IP addresses. Only allow container services to be contacted through a specific external interface on the host machine.\n\n  Rationale: If you have multiple network interfaces on your host machine, the container can accept connections on the exposed ports on any network interface. This might not be desired and may not be secured. Many a times a particular interface is exposed externally and services such as intrusion detection, intrusion prevention, firewall, load balancing, etc. are run on those interfaces to screen incoming public traffic. Hence, you should not accept incoming connections on any interface. You should only allow incoming connections from a particular external interface."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/","ref":"Docker container networking"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.13","cis-docker-1.13.0":"5.13","level:1":null},"code":"control 'docker-5.13' do\n  impact 1.0\n  title 'Bind incoming container traffic to a specific host interface'\n  desc 'By default, Docker containers can make connections to the outside world, but the outside world cannot connect to containers. Each outgoing connection will appear to originate from one of the host machine\\'s own IP addresses. Only allow container services to be contacted through a specific external interface on the host machine.\n\n  Rationale: If you have multiple network interfaces on your host machine, the container can accept connections on the exposed ports on any network interface. This might not be desired and may not be secured. Many a times a particular interface is exposed externally and services such as intrusion detection, intrusion prevention, firewall, load balancing, etc. are run on those interfaces to screen incoming public traffic. Hence, you should not accept incoming connections on any interface. You should only allow incoming connections from a particular external interface.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.13'\n  tag 'cis-docker-1.13.0': '5.13'\n  tag 'level:1'\n  ref 'Docker container networking', url: 'https://docs.docker.com/engine/userguide/networking/'\n\n  docker.containers.running?.ids.each do |id|\n    container_info = docker.object(id)\n    next if container_info['NetworkSettings']['Ports'].nil?\n    container_info['NetworkSettings']['Ports'].each do |_, hosts|\n      next if hosts.nil?\n      hosts.each do |host|\n        describe host['HostIp'].to_i.between?(1, 1024) do\n          it { should_not eq '0.0.0.0' }\n        end\n      end\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":328},"id":"docker-5.13"},{"title":"Set the 'on-failure' container restart policy to 5","desc":"Using the '--restart' flag in 'docker run' command you can specify a restart policy for how a container should or should not be restarted on exit. You should choose the 'on-failure' restart policy and limit the restart attempts to 5.\n\n  Rationale: If you indefinitely keep trying to start the container, it could possibly lead to a denial of service on the host. It could be an easy way to do a distributed denial of service attack especially if you have many containers on the same host. Additionally, ignoring the exit status of the container and 'always' attempting to restart the container leads to non-investigation of the root cause behind containers getting terminated. If a container gets terminated, you should investigate on the reason behind it instead of just attempting to restart it indefinitely. Thus, it is recommended to use 'on-failure' restart policy and limit it to maximum of 5 restart attempts.","descriptions":{"default":"Using the '--restart' flag in 'docker run' command you can specify a restart policy for how a container should or should not be restarted on exit. You should choose the 'on-failure' restart policy and limit the restart attempts to 5.\n\n  Rationale: If you indefinitely keep trying to start the container, it could possibly lead to a denial of service on the host. It could be an easy way to do a distributed denial of service attack especially if you have many containers on the same host. Additionally, ignoring the exit status of the container and 'always' attempting to restart the container leads to non-investigation of the root cause behind containers getting terminated. If a container gets terminated, you should investigate on the reason behind it instead of just attempting to restart it indefinitely. Thus, it is recommended to use 'on-failure' restart policy and limit it to maximum of 5 restart attempts."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/start-containers-automatically/","ref":"Start containers automatically"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.14","cis-docker-1.13.0":"5.14","level:1":null},"code":"control 'docker-5.14' do\n  impact 1.0\n  title 'Set the \\'on-failure\\' container restart policy to 5'\n  desc 'Using the \\'--restart\\' flag in \\'docker run\\' command you can specify a restart policy for how a container should or should not be restarted on exit. You should choose the \\'on-failure\\' restart policy and limit the restart attempts to 5.\n\n  Rationale: If you indefinitely keep trying to start the container, it could possibly lead to a denial of service on the host. It could be an easy way to do a distributed denial of service attack especially if you have many containers on the same host. Additionally, ignoring the exit status of the container and \\'always\\' attempting to restart the container leads to non-investigation of the root cause behind containers getting terminated. If a container gets terminated, you should investigate on the reason behind it instead of just attempting to restart it indefinitely. Thus, it is recommended to use \\'on-failure\\' restart policy and limit it to maximum of 5 restart attempts.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.14'\n  tag 'cis-docker-1.13.0': '5.14'\n  tag 'level:1'\n  ref 'Start containers automatically', url: 'https://docs.docker.com/engine/admin/start-containers-automatically/'\n\n  docker.containers.running?.ids.each do |id|\n    describe.one do\n      describe docker.object(id) do\n        its(%w[HostConfig RestartPolicy Name]) { should eq 'no' }\n      end\n      describe docker.object(id) do\n        its(%w[HostConfig RestartPolicy Name]) { should eq 'on-failure' }\n        its(%w[HostConfig RestartPolicy MaximumRetryCount]) { should eq 5 }\n      end\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":355},"id":"docker-5.14"},{"title":"Do not share the host's process namespace","desc":"Process ID (PID) namespaces isolate the process ID number space, meaning that processes in different PID namespaces can have the same PID. This is process level isolation between containers and the host.\n\n  Rationale: PID namespace provides separation of processes. The PID Namespace removes the view of the system processes, and allows process ids to be reused including PID 1. If the host's PID namespace is shared with the container, it would basically allow processes within the container to see all of the processes on the host system. This breaks the benefit of process level isolation between the host and the containers. Someone having access to the container can eventually know all the processes running on the host system and can even kill the host system processes from within the container. This can be catastrophic. Hence, do not share the host's process namespace with the containers.","descriptions":{"default":"Process ID (PID) namespaces isolate the process ID number space, meaning that processes in different PID namespaces can have the same PID. This is process level isolation between containers and the host.\n\n  Rationale: PID namespace provides separation of processes. The PID Namespace removes the view of the system processes, and allows process ids to be reused including PID 1. If the host's PID namespace is shared with the container, it would basically allow processes within the container to see all of the processes on the host system. This breaks the benefit of process level isolation between the host and the containers. Someone having access to the container can eventually know all the processes running on the host system and can even kill the host system processes from within the container. This can be catastrophic. Hence, do not share the host's process namespace with the containers."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/run/#pid-equivalent","ref":"PID settings (–pid)"},{"url":"http://man7.org/linux/man-pages/man7/pid_namespaces.7.html","ref":"pid_namespaces - overview of Linux PID namespaces"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.15","cis-docker-1.13.0":"5.15","level:1":null},"code":"control 'docker-5.15' do\n  impact 1.0\n  title 'Do not share the host\\'s process namespace'\n  desc 'Process ID (PID) namespaces isolate the process ID number space, meaning that processes in different PID namespaces can have the same PID. This is process level isolation between containers and the host.\n\n  Rationale: PID namespace provides separation of processes. The PID Namespace removes the view of the system processes, and allows process ids to be reused including PID 1. If the host\\'s PID namespace is shared with the container, it would basically allow processes within the container to see all of the processes on the host system. This breaks the benefit of process level isolation between the host and the containers. Someone having access to the container can eventually know all the processes running on the host system and can even kill the host system processes from within the container. This can be catastrophic. Hence, do not share the host\\'s process namespace with the containers.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.15'\n  tag 'cis-docker-1.13.0': '5.15'\n  tag 'level:1'\n  ref 'PID settings (–pid)', url: 'https://docs.docker.com/engine/reference/run/#pid-equivalent'\n  ref 'pid_namespaces - overview of Linux PID namespaces', url: 'http://man7.org/linux/man-pages/man7/pid_namespaces.7.html'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig PidMode]) { should_not eq 'host' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":381},"id":"docker-5.15"},{"title":"Do not share the host's IPC namespace","desc":"IPC (POSIX/SysV IPC) namespace provides separation of named shared memory segments, semaphores and message queues. IPC namespace on the host thus should not be shared with the containers and should remain isolated.\n\n  Rationale: IPC namespace provides separation of IPC between the host and containers. If the host's IPC namespace is shared with the container, it would basically allow processes within the container to see all of the IPC on the host system. This breaks the benefit of IPC level isolation between the host and the containers. Someone having access to the container can eventually manipulate the host IPC. This can be catastrophic. Hence, do not share the host's IPC namespace with the containers.","descriptions":{"default":"IPC (POSIX/SysV IPC) namespace provides separation of named shared memory segments, semaphores and message queues. IPC namespace on the host thus should not be shared with the containers and should remain isolated.\n\n  Rationale: IPC namespace provides separation of IPC between the host and containers. If the host's IPC namespace is shared with the container, it would basically allow processes within the container to see all of the IPC on the host system. This breaks the benefit of IPC level isolation between the host and the containers. Someone having access to the container can eventually manipulate the host IPC. This can be catastrophic. Hence, do not share the host's IPC namespace with the containers."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/run/#ipc-settings---ipc","ref":"IPC settings (–ipc)"},{"url":"http://man7.org/linux/man-pages/man7/namespaces.7.html","ref":"namespaces - overview of Linux namespaces"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.16","cis-docker-1.13.0":"5.16","level:1":null},"code":"control 'docker-5.16' do\n  impact 1.0\n  title 'Do not share the host\\'s IPC namespace'\n  desc 'IPC (POSIX/SysV IPC) namespace provides separation of named shared memory segments, semaphores and message queues. IPC namespace on the host thus should not be shared with the containers and should remain isolated.\n\n  Rationale: IPC namespace provides separation of IPC between the host and containers. If the host\\'s IPC namespace is shared with the container, it would basically allow processes within the container to see all of the IPC on the host system. This breaks the benefit of IPC level isolation between the host and the containers. Someone having access to the container can eventually manipulate the host IPC. This can be catastrophic. Hence, do not share the host\\'s IPC namespace with the containers.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.16'\n  tag 'cis-docker-1.13.0': '5.16'\n  tag 'level:1'\n  ref 'IPC settings (–ipc)', url: 'https://docs.docker.com/engine/reference/run/#ipc-settings---ipc'\n  ref 'namespaces - overview of Linux namespaces', url: 'http://man7.org/linux/man-pages/man7/namespaces.7.html'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig IpcMode]) { should_not eq 'host' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":402},"id":"docker-5.16"},{"title":"Do not directly expose host devices to containers","desc":"Host devices can be directly exposed to containers at runtime. Do not directly expose host devices to containers especially for containers that are not trusted.\n\n  Rationale: The '--device' option exposes the host devices to the containers and consequently the containers can directly access such host devices. You would not require the container to run in 'privileged' mode to access and manipulate the host devices. By default, the container will be able to read, write and mknod these devices. Additionally, it is possible for containers to remove block devices from the host. Hence, do not expose host devices to containers directly. If at all, you would want to expose the host device to a container, use the sharing permissions appropriately:\n\n      r - read only\n      w - writable\n      m - mknod allowed","descriptions":{"default":"Host devices can be directly exposed to containers at runtime. Do not directly expose host devices to containers especially for containers that are not trusted.\n\n  Rationale: The '--device' option exposes the host devices to the containers and consequently the containers can directly access such host devices. You would not require the container to run in 'privileged' mode to access and manipulate the host devices. By default, the container will be able to read, write and mknod these devices. Additionally, it is possible for containers to remove block devices from the host. Hence, do not expose host devices to containers directly. If at all, you would want to expose the host device to a container, use the sharing permissions appropriately:\n\n      r - read only\n      w - writable\n      m - mknod allowed"},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.17","cis-docker-1.13.0":"5.17","level:1":null},"code":"control 'docker-5.17' do\n  impact 1.0\n  title 'Do not directly expose host devices to containers'\n  desc 'Host devices can be directly exposed to containers at runtime. Do not directly expose host devices to containers especially for containers that are not trusted.\n\n  Rationale: The \\'--device\\' option exposes the host devices to the containers and consequently the containers can directly access such host devices. You would not require the container to run in \\'privileged\\' mode to access and manipulate the host devices. By default, the container will be able to read, write and mknod these devices. Additionally, it is possible for containers to remove block devices from the host. Hence, do not expose host devices to containers directly. If at all, you would want to expose the host device to a container, use the sharing permissions appropriately:\n\n      r - read only\n      w - writable\n      m - mknod allowed'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.17'\n  tag 'cis-docker-1.13.0': '5.17'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig Devices]) { should be_empty }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":423},"id":"docker-5.17"},{"title":"Override default ulimit at runtime only if needed","desc":"The default ulimit is set at the Docker daemon level. However, you may override the default ulimit setting, if needed, during container runtime.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. The default ulimit set at the Docker daemon level should be honored. If the default ulimit settings are not appropriate for a particular container instance, you may override them as an exception. But, do not make this a practice. If most of the container instances are overriding default ulimit settings, consider changing the default ulimit settings to something that is appropriate for your needs.","descriptions":{"default":"The default ulimit is set at the Docker daemon level. However, you may override the default ulimit setting, if needed, during container runtime.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. The default ulimit set at the Docker daemon level should be honored. If the default ulimit settings are not appropriate for a particular container instance, you may override them as an exception. But, do not make this a practice. If most of the container instances are overriding default ulimit settings, consider changing the default ulimit settings to something that is appropriate for your needs."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/run/","ref":"docker run"},{"ref":"Command: man setrlimit"},{"url":"http://www.oreilly.com/webops-perf/free/files/docker-security.pdf","ref":"Docker Security Book"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.18","cis-docker-1.13.0":"5.18","level:1":null},"code":"control 'docker-5.18' do\n  impact 1.0\n  title 'Override default ulimit at runtime only if needed'\n  desc 'The default ulimit is set at the Docker daemon level. However, you may override the default ulimit setting, if needed, during container runtime.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. The default ulimit set at the Docker daemon level should be honored. If the default ulimit settings are not appropriate for a particular container instance, you may override them as an exception. But, do not make this a practice. If most of the container instances are overriding default ulimit settings, consider changing the default ulimit settings to something that is appropriate for your needs.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.18'\n  tag 'cis-docker-1.13.0': '5.18'\n  tag 'level:1'\n  ref 'docker run', url: 'https://docs.docker.com/engine/reference/commandline/run/'\n  ref 'Command: man setrlimit'\n  ref 'Docker Security Book', url: 'http://www.oreilly.com/webops-perf/free/files/docker-security.pdf'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig Ulimits]) { should eq nil }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":447},"id":"docker-5.18"},{"title":"Do not set mount propagation mode to shared","desc":"Mount propagation mode allows mounting volumes in shared, slave or private mode on a container. Do not use shared mount propagation mode until needed.\n\n  Rationale: A shared mount is replicated at all mounts and the changes made at any mount point are propagated to all mounts. Mounting a volume in shared mode does not restrict any other container to mount and make changes to that volume. This might be catastrophic if the mounted volume is sensitive to changes. Do not set mount propagation mode to shared until needed.","descriptions":{"default":"Mount propagation mode allows mounting volumes in shared, slave or private mode on a container. Do not use shared mount propagation mode until needed.\n\n  Rationale: A shared mount is replicated at all mounts and the changes made at any mount point are propagated to all mounts. Mounting a volume in shared mode does not restrict any other container to mount and make changes to that volume. This might be catastrophic if the mounted volume is sensitive to changes. Do not set mount propagation mode to shared until needed."},"impact":1.0,"refs":[{"url":"https://github.com/docker/docker/pull/17034","ref":"Capability to specify per volume mount propagation mode"},{"url":"https://docs.docker.com/engine/reference/run/","ref":"Docker run reference"},{"url":"https://www.kernel.org/doc/Documentation/filesystems/sharedsubtree.txt","ref":"Shared Subtrees"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.19","cis-docker-1.13.0":"5.19","level:1":null},"code":"control 'docker-5.19' do\n  impact 1.0\n  title 'Do not set mount propagation mode to shared'\n  desc 'Mount propagation mode allows mounting volumes in shared, slave or private mode on a container. Do not use shared mount propagation mode until needed.\n\n  Rationale: A shared mount is replicated at all mounts and the changes made at any mount point are propagated to all mounts. Mounting a volume in shared mode does not restrict any other container to mount and make changes to that volume. This might be catastrophic if the mounted volume is sensitive to changes. Do not set mount propagation mode to shared until needed.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.19'\n  tag 'cis-docker-1.13.0': '5.19'\n  tag 'level:1'\n  ref 'Capability to specify per volume mount propagation mode', url: 'https://github.com/docker/docker/pull/17034'\n  ref 'Docker run reference', url: 'https://docs.docker.com/engine/reference/run/'\n  ref 'Shared Subtrees', url: 'https://www.kernel.org/doc/Documentation/filesystems/sharedsubtree.txt'\n\n  docker.containers.running?.ids.each do |id|\n    raw = command(\"docker inspect --format '{{range $mnt := .Mounts}} {{json $mnt.Propagation}} {{end}}' #{id}\").stdout\n    describe raw.delete(\"\\n\").delete('\\\"').delete(' ') do\n      it { should_not eq 'shared' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":469},"id":"docker-5.19"},{"title":"Do not share the host's UTS namespace","desc":"UTS namespaces provide isolation of two system identifiers: the hostname and the NIS domain name. It is used for setting the hostname and the domain that is visible to running processes in that namespace. Processes running within containers do not typically require to know hostname and domain name. Hence, the namespace should not be shared with the host.\n\n  Rationale: Sharing the UTS namespace with the host provides full permission to the container to change the hostname of the host. This is insecure and should not be allowed.","descriptions":{"default":"UTS namespaces provide isolation of two system identifiers: the hostname and the NIS domain name. It is used for setting the hostname and the domain that is visible to running processes in that namespace. Processes running within containers do not typically require to know hostname and domain name. Hence, the namespace should not be shared with the host.\n\n  Rationale: Sharing the UTS namespace with the host provides full permission to the container to change the hostname of the host. This is insecure and should not be allowed."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/run/","ref":"Docker run reference"},{"url":" http://man7.org/linux/man-pages/man7/namespaces.7.html","ref":"namespaces - overview of Linux namespaces"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.20","cis-docker-1.13.0":"5.20","level:1":null},"code":"control 'docker-5.20' do\n  impact 1.0\n  title 'Do not share the host\\'s UTS namespace'\n  desc 'UTS namespaces provide isolation of two system identifiers: the hostname and the NIS domain name. It is used for setting the hostname and the domain that is visible to running processes in that namespace. Processes running within containers do not typically require to know hostname and domain name. Hence, the namespace should not be shared with the host.\n\n  Rationale: Sharing the UTS namespace with the host provides full permission to the container to change the hostname of the host. This is insecure and should not be allowed.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.20'\n  tag 'cis-docker-1.13.0': '5.20'\n  tag 'level:1'\n  ref 'Docker run reference', url: 'https://docs.docker.com/engine/reference/run/'\n  ref 'namespaces - overview of Linux namespaces', url: ' http://man7.org/linux/man-pages/man7/namespaces.7.html'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig UTSMode]) { should_not eq 'host' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":492},"id":"docker-5.20"},{"title":"Do not disable default seccomp profile","desc":"Seccomp filtering provides a means for a process to specify a filter for incoming system calls. The default Docker seccomp profile disables 44 system calls, out of 313. It should not be disabled unless it hinders your container application usage.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security.","descriptions":{"default":"Seccomp filtering provides a means for a process to specify a filter for incoming system calls. The default Docker seccomp profile disables 44 system calls, out of 313. It should not be disabled unless it hinders your container application usage.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security."},"impact":1.0,"refs":[{"url":"http://blog.aquasec.com/new-docker-security-features-and-what-they-mean-seccomp-profiles","ref":"New Docker Security Features and What They Mean: Seccomp Profiles"},{"url":"https://docs.docker.com/engine/reference/run/","ref":"Docker run reference"},{"url":"https://github.com/moby/moby/blob/master/profiles/seccomp/default.json","ref":"Seccomp default.json"},{"url":"https://docs.docker.com/engine/security/seccomp/","ref":"Seccomp security profiles for Docker"},{"url":"https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt","ref":"SECure COMPuting with filters"},{"url":"https://github.com/moby/moby/pull/17034","ref":"Capability to specify per volume mount propagation mode"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.21","cis-docker-1.13.0":"5.21","level:1":null},"code":"control 'docker-5.21' do\n  impact 1.0\n  title 'Do not disable default seccomp profile'\n  desc 'Seccomp filtering provides a means for a process to specify a filter for incoming system calls. The default Docker seccomp profile disables 44 system calls, out of 313. It should not be disabled unless it hinders your container application usage.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.21'\n  tag 'cis-docker-1.13.0': '5.21'\n  tag 'level:1'\n  ref 'New Docker Security Features and What They Mean: Seccomp Profiles', url: 'http://blog.aquasec.com/new-docker-security-features-and-what-they-mean-seccomp-profiles'\n  ref 'Docker run reference', url: 'https://docs.docker.com/engine/reference/run/'\n  ref 'Seccomp default.json', url: 'https://github.com/moby/moby/blob/master/profiles/seccomp/default.json'\n  ref 'Seccomp security profiles for Docker', url: 'https://docs.docker.com/engine/security/seccomp/'\n  ref 'SECure COMPuting with filters', url: 'https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt'\n  ref 'Capability to specify per volume mount propagation mode', url: 'https://github.com/moby/moby/pull/17034'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig SecurityOpt]) { should include(/seccomp/) }\n      its(%w[HostConfig SecurityOpt]) { should_not include(/seccomp[=|:]unconfined/) }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":513},"id":"docker-5.21"},{"title":"Do not docker exec commands with privileged option","desc":"Do not docker exec with --privileged option.\n\n  Rationale: Using --privileged option in docker exec gives extended Linux capabilities to the command. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions.","descriptions":{"default":"Do not docker exec with --privileged option.\n\n  Rationale: Using --privileged option in docker exec gives extended Linux capabilities to the command. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/exec/","ref":"docker exec"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.22","cis-docker-1.13.0":"5.22","level:2":null},"code":"control 'docker-5.22' do\n  impact 1.0\n  title 'Do not docker exec commands with privileged option'\n  desc 'Do not docker exec with --privileged option.\n\n  Rationale: Using --privileged option in docker exec gives extended Linux capabilities to the command. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.22'\n  tag 'cis-docker-1.13.0': '5.22'\n  tag 'level:2'\n  ref 'docker exec', url: 'https://docs.docker.com/engine/reference/commandline/exec/'\n\n  describe command('ausearch --input-logs -k docker | grep exec | grep privileged').stdout do\n    it { should be_empty }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":539},"id":"docker-5.22"},{"title":"Do not docker exec commands with user option","desc":"Do not docker exec with --user option.\n\n  Rationale: Using --user option in docker exec executes the command within the container as that user. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions. For example, suppose your container is running as tomcat user (or any other non-root user), it would be possible to run a command through docker exec as root with --user=root option. This could potentially be dangerous.","descriptions":{"default":"Do not docker exec with --user option.\n\n  Rationale: Using --user option in docker exec executes the command within the container as that user. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions. For example, suppose your container is running as tomcat user (or any other non-root user), it would be possible to run a command through docker exec as root with --user=root option. This could potentially be dangerous."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/exec/","ref":"docker exec"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.23","cis-docker-1.13.0":"5.23","level:2":null},"code":"control 'docker-5.23' do\n  impact 1.0\n  title 'Do not docker exec commands with user option'\n  desc 'Do not docker exec with --user option.\n\n  Rationale: Using --user option in docker exec executes the command within the container as that user. This could potentially be insecure and unsafe to do especially when you are running containers with dropped capabilities or with enhanced restrictions. For example, suppose your container is running as tomcat user (or any other non-root user), it would be possible to run a command through docker exec as root with --user=root option. This could potentially be dangerous.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.23'\n  tag 'cis-docker-1.13.0': '5.23'\n  tag 'level:2'\n  ref 'docker exec', url: 'https://docs.docker.com/engine/reference/commandline/exec/'\n\n  describe command('ausearch --input-logs -k docker | grep exec | grep user').stdout do\n    it { should be_empty }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":557},"id":"docker-5.23"},{"title":"Confirm cgroup usage","desc":"It is possible to attach to a particular cgroup on container run. Confirming cgroup usage would ensure that containers are running under defined cgroups.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. At run-time, it is possible to attach to a different cgroup other than the one that was expected to be used. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is expected, excess permissions and resources might be granted to the container and thus, can prove to be unsafe.","descriptions":{"default":"It is possible to attach to a particular cgroup on container run. Confirming cgroup usage would ensure that containers are running under defined cgroups.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. At run-time, it is possible to attach to a different cgroup other than the one that was expected to be used. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is expected, excess permissions and resources might be granted to the container and thus, can prove to be unsafe."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/run/","ref":"Specify custom cgroups"},{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html","ref":"Chapter 1. Introduction to Control Groups (Cgroups)"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.24","cis-docker-1.13.0":"5.24","level:1":null},"code":"control 'docker-5.24' do\n  impact 1.0\n  title 'Confirm cgroup usage'\n  desc 'It is possible to attach to a particular cgroup on container run. Confirming cgroup usage would ensure that containers are running under defined cgroups.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. At run-time, it is possible to attach to a different cgroup other than the one that was expected to be used. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is expected, excess permissions and resources might be granted to the container and thus, can prove to be unsafe.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.24'\n  tag 'cis-docker-1.13.0': '5.24'\n  tag 'level:1'\n  ref 'Specify custom cgroups', url: 'https://docs.docker.com/engine/reference/run/'\n  ref 'Chapter 1. Introduction to Control Groups (Cgroups)', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig CgroupParent]) { should be_empty }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":575},"id":"docker-5.24"},{"title":"Restrict container from acquiring additional privileges","desc":"Restrict the container from acquiring additional privileges via suid or sgid bits.\n\n  Rationale: A process can set the no_new_priv bit in the kernel. It persists across fork, clone and execve. The no_new_priv bit ensures that the process or its children processes do not gain any additional privileges via suid or sgid bits. This way a lot of dangerous operations become a lot less dangerous because there is no possibility of subverting privileged binaries.","descriptions":{"default":"Restrict the container from acquiring additional privileges via suid or sgid bits.\n\n  Rationale: A process can set the no_new_priv bit in the kernel. It persists across fork, clone and execve. The no_new_priv bit ensures that the process or its children processes do not gain any additional privileges via suid or sgid bits. This way a lot of dangerous operations become a lot less dangerous because there is no possibility of subverting privileged binaries."},"impact":1.0,"refs":[{"url":"https://github.com/projectatomic/atomic-site/issues/269","ref":"BLOG: No New Privileges support in docker"},{"url":"https://github.com/moby/moby/pull/20727","ref":"Add support for NoNewPrivileges in docker"},{"url":"https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt","ref":"no_new_privs"},{"url":"https://lwn.net/Articles/475678/","ref":"System call filtering and no_new_privs"},{"url":"https://lwn.net/Articles/475362/","ref":"Add PR_{GET,SET}_NO_NEW_PRIVS to prevent execve from granting privs"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.25","cis-docker-1.13.0":"5.25","level:1":null},"code":"control 'docker-5.25' do\n  impact 1.0\n  title 'Restrict container from acquiring additional privileges'\n  desc 'Restrict the container from acquiring additional privileges via suid or sgid bits.\n\n  Rationale: A process can set the no_new_priv bit in the kernel. It persists across fork, clone and execve. The no_new_priv bit ensures that the process or its children processes do not gain any additional privileges via suid or sgid bits. This way a lot of dangerous operations become a lot less dangerous because there is no possibility of subverting privileged binaries.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.25'\n  tag 'cis-docker-1.13.0': '5.25'\n  tag 'level:1'\n  ref 'BLOG: No New Privileges support in docker', url: 'https://github.com/projectatomic/atomic-site/issues/269'\n  ref 'Add support for NoNewPrivileges in docker', url: 'https://github.com/moby/moby/pull/20727'\n  ref 'no_new_privs', url: 'https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt'\n  ref 'System call filtering and no_new_privs', url: 'https://lwn.net/Articles/475678/'\n  ref 'Add PR_{GET,SET}_NO_NEW_PRIVS to prevent execve from granting privs', url: 'https://lwn.net/Articles/475362/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its(%w[HostConfig SecurityOpt]) { should include(/no-new-privileges/) }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":596},"id":"docker-5.25"},{"title":"Check container health at runtime","desc":"If the container image does not have an HEALTHCHECK instruction defined, use --health-cmd parameter at container runtime for checking container health.\n\n  Rationale: One of the important security triads is availability. If the container image you are using does not have a pre-defined HEALTHCHECK instruction, use the --health-cmd parameter to check container health at runtime. Based on the reported health status, you could take necessary actions.","descriptions":{"default":"If the container image does not have an HEALTHCHECK instruction defined, use --health-cmd parameter at container runtime for checking container health.\n\n  Rationale: One of the important security triads is availability. If the container image you are using does not have a pre-defined HEALTHCHECK instruction, use the --health-cmd parameter to check container health at runtime. Based on the reported health status, you could take necessary actions."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/pull/22719","ref":"Add support for user-defined healthchecks"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.26","cis-docker-1.13.0":"5.26","level:1":null},"code":"control 'docker-5.26' do\n  impact 1.0\n  title 'Check container health at runtime'\n  desc 'If the container image does not have an HEALTHCHECK instruction defined, use --health-cmd parameter at container runtime for checking container health.\n\n  Rationale: One of the important security triads is availability. If the container image you are using does not have a pre-defined HEALTHCHECK instruction, use the --health-cmd parameter to check container health at runtime. Based on the reported health status, you could take necessary actions.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.26'\n  tag 'cis-docker-1.13.0': '5.26'\n  tag 'level:1'\n  ref 'Add support for user-defined healthchecks', url: 'https://github.com/moby/moby/pull/22719'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its('State.Health.Status') { should eq 'healthy' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":620},"id":"docker-5.26"},{"title":"Ensure docker commands always get the latest version of the image","desc":"Always ensure that you are using the latest version of the image within your repository and not the cached older versions.\n\n  Rationale: Multiple docker commands such as docker pull, docker run, etc. are known to have an issue that by default, they extract the local copy of the image, if present, even though there is an updated version of the image with the \"same tag\" in the upstream repository. This could lead to using older and vulnerable images.","descriptions":{"default":"Always ensure that you are using the latest version of the image within your repository and not the cached older versions.\n\n  Rationale: Multiple docker commands such as docker pull, docker run, etc. are known to have an issue that by default, they extract the local copy of the image, if present, even though there is an updated version of the image with the \"same tag\" in the upstream repository. This could lead to using older and vulnerable images."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/pull/16609","ref":"Modifying trusted/untrusted pull behavior for create/run/build"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.27","cis-docker-1.13.0":"5.27","level:1":null},"code":"control 'docker-5.27' do\n  impact 1.0\n  title 'Ensure docker commands always get the latest version of the image'\n  desc 'Always ensure that you are using the latest version of the image within your repository and not the cached older versions.\n\n  Rationale: Multiple docker commands such as docker pull, docker run, etc. are known to have an issue that by default, they extract the local copy of the image, if present, even though there is an updated version of the image with the \"same tag\" in the upstream repository. This could lead to using older and vulnerable images.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.27'\n  tag 'cis-docker-1.13.0': '5.27'\n  tag 'level:1'\n  ref 'Modifying trusted/untrusted pull behavior for create/run/build', url: 'https://github.com/moby/moby/pull/16609'\n\n  describe 'docker-test' do\n    skip 'Ensure docker commands always get the latest version of the image'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":640},"id":"docker-5.27"},{"title":"Use PIDs cgroup limit","desc":"Use --pids-limit flag at container runtime.\n\n  Rationale: Attackers could launch a fork bomb with a single command inside the container. This fork bomb can crash the entire system and requires a restart of the host to make the system functional again. PIDs cgroup --pids-limit will prevent this kind of attacks by restricting the number of forks that can happen inside a container at a given time.","descriptions":{"default":"Use --pids-limit flag at container runtime.\n\n  Rationale: Attackers could launch a fork bomb with a single command inside the container. This fork bomb can crash the entire system and requires a restart of the host to make the system functional again. PIDs cgroup --pids-limit will prevent this kind of attacks by restricting the number of forks that can happen inside a container at a given time."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/pull/18697","ref":"Add PIDs cgroup support to Docker"},{"url":"https://docs.docker.com/engine/reference/commandline/run/","ref":"docker run"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.28","cis-docker-1.13.0":"5.28","level:1":null},"code":"control 'docker-5.28' do\n  impact 1.0\n  title 'Use PIDs cgroup limit'\n  desc 'Use --pids-limit flag at container runtime.\n\n  Rationale: Attackers could launch a fork bomb with a single command inside the container. This fork bomb can crash the entire system and requires a restart of the host to make the system functional again. PIDs cgroup --pids-limit will prevent this kind of attacks by restricting the number of forks that can happen inside a container at a given time.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.28'\n  tag 'cis-docker-1.13.0': '5.28'\n  tag 'level:1'\n  ref 'Add PIDs cgroup support to Docker', url: 'https://github.com/moby/moby/pull/18697'\n  ref 'docker run', url: 'https://docs.docker.com/engine/reference/commandline/run/'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its('HostConfig.PidsLimit') { should_not cmp 0 }\n      its('HostConfig.PidsLimit') { should_not cmp(-1) }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":658},"id":"docker-5.28"},{"title":"Do not use Docker's default bridge docker0","desc":"Do not use Docker's default bridge docker0. Use docker's user-defined networks for container networking.\n\n  Rationale: Docker connects virtual interfaces created in the bridge mode to a common bridge called docker0. This default networking model is vulnerable to ARP spoofing and MAC flooding attacks since there is no filtering applied.","descriptions":{"default":"Do not use Docker's default bridge docker0. Use docker's user-defined networks for container networking.\n\n  Rationale: Docker connects virtual interfaces created in the bridge mode to a common bridge called docker0. This default networking model is vulnerable to ARP spoofing and MAC flooding attacks since there is no filtering applied."},"impact":1.0,"refs":[{"url":"https://github.com/nyantec/narwhal","ref":"narwhal – secure Docker networking"},{"url":"https://arxiv.org/pdf/1501.02967.pdf","ref":"Analysis of Docker Security"},{"url":"https://docs.docker.com/engine/userguide/networking/","ref":"Docker container networking"}],"tags":{"do cker":null,"cis-docker-1.12.0":"5.29","cis-docker-1.13.0":"5.29","level:2":null},"code":"control 'docker-5.29' do\n  impact 1.0\n  title 'Do not use Docker\\'s default bridge docker0'\n  desc 'Do not use Docker\\'s default bridge docker0. Use docker\\'s user-defined networks for container networking.\n\n  Rationale: Docker connects virtual interfaces created in the bridge mode to a common bridge called docker0. This default networking model is vulnerable to ARP spoofing and MAC flooding attacks since there is no filtering applied.'\n\n  tag 'do cker'\n  tag 'cis-docker-1.12.0': '5.29'\n  tag 'cis-docker-1.13.0': '5.29'\n  tag 'level:2'\n  ref 'narwhal – secure Docker networking', url: 'https://github.com/nyantec/narwhal'\n  ref 'Analysis of Docker Security', url: 'https://arxiv.org/pdf/1501.02967.pdf'\n  ref 'Docker container networking', url: 'https://docs.docker.com/engine/userguide/networking/'\n\n  describe 'docker-test' do\n    skip 'Not implemented yet'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":680},"id":"docker-5.29"},{"title":"Do not share the host's user namespaces","desc":"Do not share the host's user namespaces with the containers.\n\n  Rationale: User namespaces ensure that a root process inside the container will be mapped to a non-root process outside the container. Sharing the user namespaces of the host with the container thus does not isolate users on the host with users on the containers.","descriptions":{"default":"Do not share the host's user namespaces with the containers.\n\n  Rationale: User namespaces ensure that a root process inside the container will be mapped to a non-root process outside the container. Sharing the user namespaces of the host with the container thus does not isolate users on the host with users on the containers."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/run/","ref":"docker run"},{"url":"https://events.linuxfoundation.org/sites/events/files/slides/User%20Namespaces%20-%20ContainerCon%202015%20-%2016-9-final_0.pdf","ref":"Rooting out Root: User namespaces in Docker"},{"url":"https://github.com/moby/moby/pull/12648","ref":"Phase 1 implementation of user namespaces as a remapped container root"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.30","cis-docker-1.13.0":"5.30","level:1":null},"code":"control 'docker-5.30' do\n  impact 1.0\n  title 'Do not share the host\\'s user namespaces'\n  desc 'Do not share the host\\'s user namespaces with the containers.\n\n  Rationale: User namespaces ensure that a root process inside the container will be mapped to a non-root process outside the container. Sharing the user namespaces of the host with the container thus does not isolate users on the host with users on the containers.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.30'\n  tag 'cis-docker-1.13.0': '5.30'\n  tag 'level:1'\n  ref 'docker run', url: 'https://docs.docker.com/engine/reference/commandline/run/'\n  ref 'Rooting out Root: User namespaces in Docker', url: 'https://events.linuxfoundation.org/sites/events/files/slides/User%20Namespaces%20-%20ContainerCon%202015%20-%2016-9-final_0.pdf'\n  ref 'Phase 1 implementation of user namespaces as a remapped container root', url: 'https://github.com/moby/moby/pull/12648'\n\n  docker.containers.running?.ids.each do |id|\n    describe docker.object(id) do\n      its('HostConfig.UsernsMode') { should eq '' }\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":700},"id":"docker-5.30"},{"title":"Do not mount the Docker socket inside any containers","desc":"The docker socket (docker.sock) should not be mounted inside a container.\n\n  Rationale: If the docker socket is mounted inside a container it would allow processes running within the container to execute docker commands which effectively allows for full control of the host.","descriptions":{"default":"The docker socket (docker.sock) should not be mounted inside a container.\n\n  Rationale: If the docker socket is mounted inside a container it would allow processes running within the container to execute docker commands which effectively allows for full control of the host."},"impact":1.0,"refs":[{"url":"https://raesene.github.io/blog/2016/03/06/The-Dangers-Of-Docker.sock/","ref":"The Dangers of Docker.sock"},{"url":"https://forums.docker.com/t/docker-in-docker-vs-mounting-var-run-docker-sock/9450/2","ref":"Docker-in-docker vs mounting /var/run/docker.sock"},{"url":"https://github.com/moby/moby/issues/21109","ref":"Is `-v /var/run/docker.sock:/var/run/docker.sock` a ticking time bomb"}],"tags":{"docker":null,"cis-docker-1.12.0":"5.31","cis-docker-1.13.0":"5.31","level:1":null},"code":"control 'docker-5.31' do\n  impact 1.0\n  title 'Do not mount the Docker socket inside any containers'\n  desc 'The docker socket (docker.sock) should not be mounted inside a container.\n\n  Rationale: If the docker socket is mounted inside a container it would allow processes running within the container to execute docker commands which effectively allows for full control of the host.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '5.31'\n  tag 'cis-docker-1.13.0': '5.31'\n  tag 'level:1'\n  ref 'The Dangers of Docker.sock', url: 'https://raesene.github.io/blog/2016/03/06/The-Dangers-Of-Docker.sock/'\n  ref 'Docker-in-docker vs mounting /var/run/docker.sock', url: 'https://forums.docker.com/t/docker-in-docker-vs-mounting-var-run-docker-sock/9450/2'\n  ref 'Is `-v /var/run/docker.sock:/var/run/docker.sock` a ticking time bomb', url: 'https://github.com/moby/moby/issues/21109'\n\n  docker.containers.running?.ids.each do |id|\n    docker.object(id).Mounts.each do |mount|\n      describe mount do\n        its('Source') { should_not include 'docker.sock' }\n      end\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/container_runtime.rb","line":722},"id":"docker-5.31"},{"title":"Restrict network traffic between containers","desc":"By default, all network traffic is allowed between containers on the same host. If not desired, restrict all the intercontainer communication. Link specific containers together that require inter communication.\n\n  Rationale: By default, unrestricted network traffic is enabled between all containers on the same host. Thus, each container has the potential of reading all packets across the container network on the same host. This might lead to unintended and unwanted disclosure of information to other containers. Hence, restrict the inter container communication.","descriptions":{"default":"By default, all network traffic is allowed between containers on the same host. If not desired, restrict all the intercontainer communication. Link specific containers together that require inter communication.\n\n  Rationale: By default, unrestricted network traffic is enabled between all containers on the same host. Thus, each container has the potential of reading all packets across the container network on the same host. This might lead to unintended and unwanted disclosure of information to other containers. Hence, restrict the inter container communication."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/","ref":"Docker container networking"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.1","cis-docker-1.13.0":"2.1","level:1":null},"code":"control 'docker-2.1' do\n  impact 1.0\n  title 'Restrict network traffic between containers'\n  desc 'By default, all network traffic is allowed between containers on the same host. If not desired, restrict all the intercontainer communication. Link specific containers together that require inter communication.\n\n  Rationale: By default, unrestricted network traffic is enabled between all containers on the same host. Thus, each container has the potential of reading all packets across the container network on the same host. This might lead to unintended and unwanted disclosure of information to other containers. Hence, restrict the inter container communication.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.1'\n  tag 'cis-docker-1.13.0': '2.1'\n  tag 'level:1'\n  ref 'Docker container networking', url: 'https://docs.docker.com/engine/userguide/networking/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['icc']) { should eq(false) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":42},"id":"docker-2.1"},{"title":"Set the logging level","desc":"Set Docker daemon log level to 'info'.\n\n  Rationale: Setting up an appropriate log level, configures the Docker daemon to log events that you would want to review later. A ase log level of 'info' and above would capture all logs except debug logs. Until and unless required, you should not run docker daemon at 'debug' log level.","descriptions":{"default":"Set Docker daemon log level to 'info'.\n\n  Rationale: Setting up an appropriate log level, configures the Docker daemon to log events that you would want to review later. A ase log level of 'info' and above would capture all logs except debug logs. Until and unless required, you should not run docker daemon at 'debug' log level."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/","ref":"Docker daemon"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.2","cis-docker-1.13.0":"2.2","level:1":null},"code":"control 'docker-2.2' do\n  impact 1.0\n  title 'Set the logging level'\n  desc 'Set Docker daemon log level to \\'info\\'.\n\n  Rationale: Setting up an appropriate log level, configures the Docker daemon to log events that you would want to review later. A ase log level of \\'info\\' and above would capture all logs except debug logs. Until and unless required, you should not run docker daemon at \\'debug\\' log level.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.2'\n  tag 'cis-docker-1.13.0': '2.2'\n  tag 'level:1'\n  ref 'Docker daemon', url: 'https://docs.docker.com/engine/reference/commandline/daemon/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['log-level']) { should eq('info') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":60},"id":"docker-2.2"},{"title":"Allow Docker to make changes to iptables","desc":"Iptables are used to set up, maintain, and inspect the tables of IP packet filter rules in the Linux kernel. Allow the Docker daemon to make changes to the iptables.\n\n  Rationale: Docker will never make changes to your system iptables rules if you choose to do so. Docker server would automatically make the needed changes to iptables based on how you choose your networking options for the containers if it is allowed to do so. It is recommended to let Docker server make changes to iptables automatically to avoid networking misconfiguration that might hamper the communication between containers and to the outside world. Additionally, it would save you hassles of updating iptables every time you choose to run the containers or modify networking options.","descriptions":{"default":"Iptables are used to set up, maintain, and inspect the tables of IP packet filter rules in the Linux kernel. Allow the Docker daemon to make changes to the iptables.\n\n  Rationale: Docker will never make changes to your system iptables rules if you choose to do so. Docker server would automatically make the needed changes to iptables based on how you choose your networking options for the containers if it is allowed to do so. It is recommended to let Docker server make changes to iptables automatically to avoid networking misconfiguration that might hamper the communication between containers and to the outside world. Additionally, it would save you hassles of updating iptables every time you choose to run the containers or modify networking options."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/default_network/container-communication/","ref":"Understand container communication"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.3","cis-docker-1.13.0":"2.3","level:1":null},"code":"control 'docker-2.3' do\n  impact 1.0\n  title 'Allow Docker to make changes to iptables'\n  desc 'Iptables are used to set up, maintain, and inspect the tables of IP packet filter rules in the Linux kernel. Allow the Docker daemon to make changes to the iptables.\n\n  Rationale: Docker will never make changes to your system iptables rules if you choose to do so. Docker server would automatically make the needed changes to iptables based on how you choose your networking options for the containers if it is allowed to do so. It is recommended to let Docker server make changes to iptables automatically to avoid networking misconfiguration that might hamper the communication between containers and to the outside world. Additionally, it would save you hassles of updating iptables every time you choose to run the containers or modify networking options.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.3'\n  tag 'cis-docker-1.13.0': '2.3'\n  tag 'level:1'\n  ref 'Understand container communication', url: 'https://docs.docker.com/engine/userguide/networking/default_network/container-communication/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['iptables']) { should eq(true) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":78},"id":"docker-2.3"},{"title":"Do not use insecure registries","desc":"Docker considers a private registry either secure or insecure. By default, registries are considered secure.\n\n  Rationale: A secure registry uses TLS. A copy of registry's CA certificate is placed on the Docker host at '/etc/docker/certs.d/<registry-name>/' directory. An insecure registry is the one not having either valid registry certificate or is not using TLS. You should not be using any insecure registries in the production environment. Insecure registries can be tampered with leading to possible compromise to your production system. Additionally, If a registry is marked as insecure then 'docker pull', 'docker push', and 'docker search' commands will not result in an error message and the user might be indefinitely working with insecure registries without ever being notified of potential danger.","descriptions":{"default":"Docker considers a private registry either secure or insecure. By default, registries are considered secure.\n\n  Rationale: A secure registry uses TLS. A copy of registry's CA certificate is placed on the Docker host at '/etc/docker/certs.d/<registry-name>/' directory. An insecure registry is the one not having either valid registry certificate or is not using TLS. You should not be using any insecure registries in the production environment. Insecure registries can be tampered with leading to possible compromise to your production system. Additionally, If a registry is marked as insecure then 'docker pull', 'docker push', and 'docker search' commands will not result in an error message and the user might be indefinitely working with insecure registries without ever being notified of potential danger."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/registry/insecure/","ref":"Insecure registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.4","cis-docker-1.13.0":"2.4","level:1":null},"code":"control 'docker-2.4' do\n  impact 1.0\n  title 'Do not use insecure registries'\n  desc 'Docker considers a private registry either secure or insecure. By default, registries are considered secure.\n\n  Rationale: A secure registry uses TLS. A copy of registry\\'s CA certificate is placed on the Docker host at \\'/etc/docker/certs.d/<registry-name>/\\' directory. An insecure registry is the one not having either valid registry certificate or is not using TLS. You should not be using any insecure registries in the production environment. Insecure registries can be tampered with leading to possible compromise to your production system. Additionally, If a registry is marked as insecure then \\'docker pull\\', \\'docker push\\', and \\'docker search\\' commands will not result in an error message and the user might be indefinitely working with insecure registries without ever being notified of potential danger.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.4'\n  tag 'cis-docker-1.13.0': '2.4'\n  tag 'level:1'\n  ref 'Insecure registry', url: 'https://docs.docker.com/registry/insecure/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['insecure-registries']) { should be_empty }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":96},"id":"docker-2.4"},{"title":"Do not use the aufs storage driver","desc":"Do not use 'aufs' as storage driver for your Docker instance.\n\n  Rationale: The 'aufs' storage driver is the oldest storage driver. It is based on a Linux kernel patch-set that is unlikely to be merged into the main Linux kernel. 'aufs' driver is also known to cause some serious kernel crashes. 'aufs' just has legacy support from Docker. Most importantly, 'aufs' is not a supported driver in many Linux distributions using latest Linux kernels.","descriptions":{"default":"Do not use 'aufs' as storage driver for your Docker instance.\n\n  Rationale: The 'aufs' storage driver is the oldest storage driver. It is based on a Linux kernel patch-set that is unlikely to be merged into the main Linux kernel. 'aufs' driver is also known to cause some serious kernel crashes. 'aufs' just has legacy support from Docker. Most importantly, 'aufs' is not a supported driver in many Linux distributions using latest Linux kernels."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/#daemon-storage-driver-option","ref":"Docker daemon storage driver options"},{"url":"http://muehe.org/posts/switching-docker-from-aufs-to-devicemapper/","ref":"Switch from aufs to devicemapper"},{"url":"http://jpetazzo.github.io/assets/2015-03-05-deep-dive-into-docker-storage-drivers.html#1","ref":"Deep dive into docker storage drivers"},{"url":"https://docs.docker.com/engine/userguide/storagedriver/","ref":"Docker storage drivers"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.5","cis-docker-1.13.0":"2.5","level:1":null},"code":"control 'docker-2.5' do\n  impact 1.0\n  title 'Do not use the aufs storage driver'\n  desc 'Do not use \\'aufs\\' as storage driver for your Docker instance.\n\n  Rationale: The \\'aufs\\' storage driver is the oldest storage driver. It is based on a Linux kernel patch-set that is unlikely to be merged into the main Linux kernel. \\'aufs\\' driver is also known to cause some serious kernel crashes. \\'aufs\\' just has legacy support from Docker. Most importantly, \\'aufs\\' is not a supported driver in many Linux distributions using latest Linux kernels.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.5'\n  tag 'cis-docker-1.13.0': '2.5'\n  tag 'level:1'\n  ref 'Docker daemon storage driver options', url: 'https://docs.docker.com/engine/reference/commandline/cli/#daemon-storage-driver-option'\n  ref 'Switch from aufs to devicemapper', url: 'http://muehe.org/posts/switching-docker-from-aufs-to-devicemapper/'\n  ref 'Deep dive into docker storage drivers', url: 'http://jpetazzo.github.io/assets/2015-03-05-deep-dive-into-docker-storage-drivers.html#1'\n  ref 'Docker storage drivers', url: 'https://docs.docker.com/engine/userguide/storagedriver/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['storage-driver']) { should_not eq('aufs') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":114},"id":"docker-2.5"},{"title":"Configure TLS authentication for Docker daemon","desc":"It is possible to make the Docker daemon to listen on a specific IP and port and any other Unix socket other than default Unix socket. Configure TLS authentication to restrict access to Docker daemon via IP and port.\n\n  Rationale: By default, Docker daemon binds to a non-networked Unix socket and runs with 'root' privileges. If you change the default docker daemon binding to a TCP port or any other Unix socket, anyone with access to that port or socket can have full access to Docker daemon and in turn to the host system. Hence, you should not bind the Docker daemon to another IP/port or a Unix socket. If you must expose the Docker daemon via a network socket, configure TLS authentication for the daemon and Docker Swarm APIs (if using). This would restrict the connections to your Docker daemon over the network to a limited number of clients who could successfully authenticate over TLS.","descriptions":{"default":"It is possible to make the Docker daemon to listen on a specific IP and port and any other Unix socket other than default Unix socket. Configure TLS authentication to restrict access to Docker daemon via IP and port.\n\n  Rationale: By default, Docker daemon binds to a non-networked Unix socket and runs with 'root' privileges. If you change the default docker daemon binding to a TCP port or any other Unix socket, anyone with access to that port or socket can have full access to Docker daemon and in turn to the host system. Hence, you should not bind the Docker daemon to another IP/port or a Unix socket. If you must expose the Docker daemon via a network socket, configure TLS authentication for the daemon and Docker Swarm APIs (if using). This would restrict the connections to your Docker daemon over the network to a limited number of clients who could successfully authenticate over TLS."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect Docker deamon socket"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.6","cis-docker-1.13.0":"2.6","level:1":null},"code":"control 'docker-2.6' do\n  impact 1.0\n  title 'Configure TLS authentication for Docker daemon'\n  desc 'It is possible to make the Docker daemon to listen on a specific IP and port and any other Unix socket other than default Unix socket. Configure TLS authentication to restrict access to Docker daemon via IP and port.\n\n  Rationale: By default, Docker daemon binds to a non-networked Unix socket and runs with \\'root\\' privileges. If you change the default docker daemon binding to a TCP port or any other Unix socket, anyone with access to that port or socket can have full access to Docker daemon and in turn to the host system. Hence, you should not bind the Docker daemon to another IP/port or a Unix socket. If you must expose the Docker daemon via a network socket, configure TLS authentication for the daemon and Docker Swarm APIs (if using). This would restrict the connections to your Docker daemon over the network to a limited number of clients who could successfully authenticate over TLS.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.6'\n  tag 'cis-docker-1.13.0': '2.6'\n  tag 'level:1'\n  ref 'Protect Docker deamon socket', url: 'https://docs.docker.com/engine/security/https/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['tls']) { should eq(true) }\n    its(['tlsverify']) { should eq(true) }\n    its(['tlscacert']) { should eq(DAEMON_TLSCACERT) }\n    its(['tlscert']) { should eq(DAEMON_TLSCERT) }\n    its(['tlskey']) { should eq(DAEMON_TLSKEY) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":135},"id":"docker-2.6"},{"title":"Set default ulimit as appropriate","desc":"Set the default ulimit options as appropriate in your environment.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. Setting default ulimit for the Docker daemon would enforce the ulimit for all container instances. You would not need to setup ulimit for each container instance. However, the default ulimit can be overridden during container runtime, if needed. Hence, to control the system resources, define a default ulimit as needed in your environment.","descriptions":{"default":"Set the default ulimit options as appropriate in your environment.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. Setting default ulimit for the Docker daemon would enforce the ulimit for all container instances. You would not need to setup ulimit for each container instance. However, the default ulimit can be overridden during container runtime, if needed. Hence, to control the system resources, define a default ulimit as needed in your environment."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/#default-ulimits","ref":"Docker daemon deafult ulimits"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.7","cis-docker-1.13.0":"2.7","level:1":null},"code":"control 'docker-2.7' do\n  impact 1.0\n  title 'Set default ulimit as appropriate'\n  desc 'Set the default ulimit options as appropriate in your environment.\n\n  Rationale: ulimit provides control over the resources available to the shell and to processes started by it. Setting system resource limits judiciously saves you from many disasters such as a fork bomb. Sometimes, even friendly users and legitimate processes can overuse system resources and in-turn can make the system unusable. Setting default ulimit for the Docker daemon would enforce the ulimit for all container instances. You would not need to setup ulimit for each container instance. However, the default ulimit can be overridden during container runtime, if needed. Hence, to control the system resources, define a default ulimit as needed in your environment.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.7'\n  tag 'cis-docker-1.13.0': '2.7'\n  tag 'level:1'\n  ref 'Docker daemon deafult ulimits', url: 'https://docs.docker.com/engine/reference/commandline/daemon/#default-ulimits'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['default-ulimits', 'nproc']) { should eq('1024:2408') }\n    its(['default-ulimits', 'nofile']) { should eq('100': '200') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":157},"id":"docker-2.7"},{"title":"Enable user namespace support","desc":"Enable user namespace support in Docker daemon to utilize container user to host user re-mapping. This recommendation is beneficial where containers you are using do not have an explicit container user defined in the container image. If container images that you are using have a pre-defined non-root user, this recommendation may be skipped since this feature is still in its infancy and might give you unpredictable issues and complexities.\n\n  Rationale: The Linux kernel user namespace support in Docker daemon provides additional security for the Docker host system. It allows a container to have a unique range of user and group IDs which are outside the traditional user and group range utilized by the host system. For example, the root user will have expected administrative privilege inside the container but can effectively be mapped to an unprivileged UID on the host system.","descriptions":{"default":"Enable user namespace support in Docker daemon to utilize container user to host user re-mapping. This recommendation is beneficial where containers you are using do not have an explicit container user defined in the container image. If container images that you are using have a pre-defined non-root user, this recommendation may be skipped since this feature is still in its infancy and might give you unpredictable issues and complexities.\n\n  Rationale: The Linux kernel user namespace support in Docker daemon provides additional security for the Docker host system. It allows a container to have a unique range of user and group IDs which are outside the traditional user and group range utilized by the host system. For example, the root user will have expected administrative privilege inside the container but can effectively be mapped to an unprivileged UID on the host system."},"impact":1.0,"refs":[{"url":"http://man7.org/linux/man-pages/man7/user_namespaces.7.html","ref":"User namespeces"},{"url":"https://docs.docker.com/engine/reference/commandline/daemon/","ref":"Docker daemon configuration"},{"url":"http://events.linuxfoundation.org/sites/events/files/slides/User%20Namespaces%20-%20ContainerCon%202015%20-%2016-9-final_0.pdf","ref":"Routing out root: user namespaces in docker"},{"url":"https://github.com/docker/docker/issues/21050","ref":"Docker images vanish when using user namespaces "}],"tags":{"docker":null,"cis-docker-1.12.0":"2.8","cis-docker-1.13.0":"2.8","level:2":null},"code":"control 'docker-2.8' do\n  impact 1.0\n  title 'Enable user namespace support'\n  desc 'Enable user namespace support in Docker daemon to utilize container user to host user re-mapping. This recommendation is beneficial where containers you are using do not have an explicit container user defined in the container image. If container images that you are using have a pre-defined non-root user, this recommendation may be skipped since this feature is still in its infancy and might give you unpredictable issues and complexities.\n\n  Rationale: The Linux kernel user namespace support in Docker daemon provides additional security for the Docker host system. It allows a container to have a unique range of user and group IDs which are outside the traditional user and group range utilized by the host system. For example, the root user will have expected administrative privilege inside the container but can effectively be mapped to an unprivileged UID on the host system.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.8'\n  tag 'cis-docker-1.13.0': '2.8'\n  tag 'level:2'\n  ref 'User namespeces', url: 'http://man7.org/linux/man-pages/man7/user_namespaces.7.html'\n  ref 'Docker daemon configuration', url: 'https://docs.docker.com/engine/reference/commandline/daemon/'\n  ref 'Routing out root: user namespaces in docker', url: 'http://events.linuxfoundation.org/sites/events/files/slides/User%20Namespaces%20-%20ContainerCon%202015%20-%2016-9-final_0.pdf'\n  ref 'Docker images vanish when using user namespaces ', url: 'https://github.com/docker/docker/issues/21050'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['userns-remap']) { should eq('default') }\n  end\n  describe file('/etc/subuid') do\n    it { should exist }\n    it { should be_file }\n  end\n  describe file('/etc/subgid') do\n    it { should exist }\n    it { should be_file }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":176},"id":"docker-2.8"},{"title":"Confirm default cgroup usage","desc":"The --cgroup-parent option allows you to set the default cgroup parent to use for all the containers. If there is no specific use case, this setting should be left at its default.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. It is possible to attach to a different cgroup other than that is the default. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is a default, it is possible to share resources unevenly and thus might starve the host for resources.","descriptions":{"default":"The --cgroup-parent option allows you to set the default cgroup parent to use for all the containers. If there is no specific use case, this setting should be left at its default.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. It is possible to attach to a different cgroup other than that is the default. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is a default, it is possible to share resources unevenly and thus might starve the host for resources."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/","ref":"Docker daemon configuration"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.9","cis-docker-1.13.0":"2.9","level:2":null},"code":"control 'docker-2.9' do\n  impact 1.0\n  title 'Confirm default cgroup usage'\n  desc 'The --cgroup-parent option allows you to set the default cgroup parent to use for all the containers. If there is no specific use case, this setting should be left at its default.\n\n  Rationale: System administrators typically define cgroups under which containers are supposed to run. Even if cgroups are not explicitly defined by the system administrators, containers run under docker cgroup by default. It is possible to attach to a different cgroup other than that is the default. This usage should be monitored and confirmed. By attaching to a different cgroup than the one that is a default, it is possible to share resources unevenly and thus might starve the host for resources.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.9'\n  tag 'cis-docker-1.13.0': '2.9'\n  tag 'level:2'\n  ref 'Docker daemon configuration', url: 'https://docs.docker.com/engine/reference/commandline/daemon/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['cgroup-parent']) { should eq('docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":205},"id":"docker-2.9"},{"title":"Do not change base device size until needed","desc":"In certain circumstances, you might need containers bigger than 10G in size. In these cases, carefully choose the base device size.\n\n  Rationale: The base device size can be increased at daemon restart. Increasing the base device size allows all future images and containers to be of the new base device size. A user can use this option to expand the base device size however shrinking is not permitted. This value affects the system-wide “base” empty filesystem that may already be initialized and inherited by pulled images. Though the file system does not allot the increased size if it is empty, it will use more space for the empty case depending upon the device size. This may cause a denial of service by ending up in file system being over-allocated or full.","descriptions":{"default":"In certain circumstances, you might need containers bigger than 10G in size. In these cases, carefully choose the base device size.\n\n  Rationale: The base device size can be increased at daemon restart. Increasing the base device size allows all future images and containers to be of the new base device size. A user can use this option to expand the base device size however shrinking is not permitted. This value affects the system-wide “base” empty filesystem that may already be initialized and inherited by pulled images. Though the file system does not allot the increased size if it is empty, it will use more space for the empty case depending upon the device size. This may cause a denial of service by ending up in file system being over-allocated or full."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/#storage-driver-options","ref":"Docker daemon storage driver options"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.10","cis-docker-1.13.0":"2.10","level:2":null},"code":"control 'docker-2.10' do\n  impact 1.0\n  title 'Do not change base device size until needed'\n  desc 'In certain circumstances, you might need containers bigger than 10G in size. In these cases, carefully choose the base device size.\n\n  Rationale: The base device size can be increased at daemon restart. Increasing the base device size allows all future images and containers to be of the new base device size. A user can use this option to expand the base device size however shrinking is not permitted. This value affects the system-wide “base” empty filesystem that may already be initialized and inherited by pulled images. Though the file system does not allot the increased size if it is empty, it will use more space for the empty case depending upon the device size. This may cause a denial of service by ending up in file system being over-allocated or full.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.10'\n  tag 'cis-docker-1.13.0': '2.10'\n  tag 'level:2'\n  ref 'Docker daemon storage driver options', url: 'https://docs.docker.com/engine/reference/commandline/daemon/#storage-driver-options'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['storage-opts']) { should eq(['dm.basesize=10G']) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":223},"id":"docker-2.10"},{"title":"Use authorization plugin","desc":"Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon.\n\n  Rationale: Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon.","descriptions":{"default":"Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon.\n\n  Rationale: Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/#access-authorization","ref":"Access authorization"},{"url":"https://docs.docker.com/engine/extend/plugins_authorization/","ref":"Auhtorization plugins"},{"url":"https://github.com/twistlock/authz","ref":"Twistlock authorization plugin"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.11","cis-docker-1.13.0":"2.11","level:2":null},"code":"control 'docker-2.11' do\n  impact 1.0\n  title 'Use authorization plugin'\n  desc 'Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon.\n\n  Rationale: Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command. The same is true for callers using Docker’s remote API to contact the daemon. If you require greater access control, you can create authorization plugins and add them to your Docker daemon configuration. Using an authorization plugin, a Docker administrator can configure granular access policies for managing access to Docker daemon.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.11'\n  tag 'cis-docker-1.13.0': '2.11'\n  tag 'level:2'\n  ref 'Access authorization', url: 'https://docs.docker.com/engine/reference/commandline/daemon/#access-authorization'\n  ref 'Auhtorization plugins', url: 'https://docs.docker.com/engine/extend/plugins_authorization/'\n  ref 'Twistlock authorization plugin', url: 'https://github.com/twistlock/authz'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['authorization-plugins']) { should_not be_empty }\n    its(['authorization-plugins']) { should eq([AUTHORIZATION_PLUGIN]) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":241},"id":"docker-2.11"},{"title":"Configure centralized and remote logging","desc":"Docker now supports various log drivers. A preferable way to store logs is the one that supports centralized and remote logging.\n\n  Ratonale: Centralized and remote logging ensures that all important log records are safe despite catastrophic events. Docker now supports various such logging drivers. Use the one that suits your environment the best.","descriptions":{"default":"Docker now supports various log drivers. A preferable way to store logs is the one that supports centralized and remote logging.\n\n  Ratonale: Centralized and remote logging ensures that all important log records are safe despite catastrophic events. Docker now supports various such logging drivers. Use the one that suits your environment the best."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/logging/overview/","ref":"Logging overview"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.12","cis-docker-1.13.0":"2.12","level:2":null},"code":"control 'docker-2.12' do\n  impact 1.0\n  title 'Configure centralized and remote logging'\n  desc 'Docker now supports various log drivers. A preferable way to store logs is the one that supports centralized and remote logging.\n\n  Ratonale: Centralized and remote logging ensures that all important log records are safe despite catastrophic events. Docker now supports various such logging drivers. Use the one that suits your environment the best.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.12'\n  tag 'cis-docker-1.13.0': '2.12'\n  tag 'level:2'\n  ref 'Logging overview', url: 'https://docs.docker.com/engine/admin/logging/overview/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['log-driver']) { should_not be_empty }\n    its(['log-driver']) { should eq(LOG_DRIVER) }\n    its(['log-opts']) { should include(LOG_OPTS) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":262},"id":"docker-2.12"},{"title":"Disable operations on legacy registry (v1)","desc":"The latest Docker registry is v2. All operations on the legacy registry version (v1) should be restricted.\n\n  Rationale: Docker registry v2 brings in many performance and security improvements over v1. It supports container image provenance and other security features such as image signing and verification. Hence, operations on Docker legacy registry should be restricted.","descriptions":{"default":"The latest Docker registry is v2. All operations on the legacy registry version (v1) should be restricted.\n\n  Rationale: Docker registry v2 brings in many performance and security improvements over v1. It supports container image provenance and other security features such as image signing and verification. Hence, operations on Docker legacy registry should be restricted."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/daemon/#storage-driver-options","ref":"Docker daemon storage driver options"},{"url":"https://github.com/docker/docker/issues/8093","ref":"Proposal: Provenance step 1 - Transform images for validation and verification"},{"url":"https://github.com/docker/docker/issues/9015","ref":"Proposal: JSON Registry API V2.1"},{"url":"https://github.com/docker/docker-registry/issues/612","ref":"Registry next generation"},{"url":"https://docs.docker.com/registry/spec/api/","ref":"Docker Registry HTTP API V2"},{"url":"https://the.binbashtheory.com/creating-private-docker-registry-2-0-with-token-authentication-service/","ref":"Creating Private Docker Registry 2.0 with Token Authentication Service"},{"url":"https://blog.docker.com/2015/07/new-tool-v1-registry-docker-trusted-registry-v2-open-source/","ref":"New Tool to Migrate From V1 Registry to Docker Trusted Registry or V2 Open Source Registry"},{"url":"https://www.slideshare.net/Docker/docker-registry-v2","ref":"Docker Registry V2"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.13","cis-docker-1.13.0":"2.13","level:1":null},"code":"control 'docker-2.13' do\n  impact 1.0\n  title 'Disable operations on legacy registry (v1)'\n  desc 'The latest Docker registry is v2. All operations on the legacy registry version (v1) should be restricted.\n\n  Rationale: Docker registry v2 brings in many performance and security improvements over v1. It supports container image provenance and other security features such as image signing and verification. Hence, operations on Docker legacy registry should be restricted.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.13'\n  tag 'cis-docker-1.13.0': '2.13'\n  tag 'level:1'\n  ref 'Docker daemon storage driver options', url: 'https://docs.docker.com/engine/reference/commandline/daemon/#storage-driver-options'\n  ref 'Proposal: Provenance step 1 - Transform images for validation and verification', url: 'https://github.com/docker/docker/issues/8093'\n  ref 'Proposal: JSON Registry API V2.1', url: 'https://github.com/docker/docker/issues/9015'\n  ref 'Registry next generation', url: 'https://github.com/docker/docker-registry/issues/612'\n  ref 'Docker Registry HTTP API V2', url: 'https://docs.docker.com/registry/spec/api/'\n  ref 'Creating Private Docker Registry 2.0 with Token Authentication Service', url: 'https://the.binbashtheory.com/creating-private-docker-registry-2-0-with-token-authentication-service/'\n  ref 'New Tool to Migrate From V1 Registry to Docker Trusted Registry or V2 Open Source Registry', url: 'https://blog.docker.com/2015/07/new-tool-v1-registry-docker-trusted-registry-v2-open-source/'\n  ref 'Docker Registry V2', url: 'https://www.slideshare.net/Docker/docker-registry-v2'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['disable-legacy-registry']) { should eq(true) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":282},"id":"docker-2.13"},{"title":"Enable live restore","desc":"The '--live-restore' enables full support of daemon-less containers in docker. It ensures that docker does not stop containers on shutdown or restore and properly reconnects to the container when restarted.\n\n  Rationale: One of the important security triads is availability. Setting '--live-restore' flag in the docker daemon ensures that container execution is not interrupted when the docker daemon is not available. This also means that it is now easier to update and patch the docker daemon without execution downtime.","descriptions":{"default":"The '--live-restore' enables full support of daemon-less containers in docker. It ensures that docker does not stop containers on shutdown or restore and properly reconnects to the container when restarted.\n\n  Rationale: One of the important security triads is availability. Setting '--live-restore' flag in the docker daemon ensures that container execution is not interrupted when the docker daemon is not available. This also means that it is now easier to update and patch the docker daemon without execution downtime."},"impact":1.0,"refs":[{"url":"https://github.com/docker/docker/pull/23213","ref":"Add --live-restore flag"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.14","cis-docker-1.13.0":"2.14","level:1":null},"code":"control 'docker-2.14' do\n  impact 1.0\n  title 'Enable live restore'\n  desc 'The \\'--live-restore\\' enables full support of daemon-less containers in docker. It ensures that docker does not stop containers on shutdown or restore and properly reconnects to the container when restarted.\n\n  Rationale: One of the important security triads is availability. Setting \\'--live-restore\\' flag in the docker daemon ensures that container execution is not interrupted when the docker daemon is not available. This also means that it is now easier to update and patch the docker daemon without execution downtime.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.14'\n  tag 'cis-docker-1.13.0': '2.14'\n  tag 'level:1'\n  ref 'Add --live-restore flag', url: 'https://github.com/docker/docker/pull/23213'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['live-restore']) { should eq(true) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":307},"id":"docker-2.14"},{"title":"Do not enable swarm mode, if not needed","desc":"Do not enable swarm mode on a docker engine instance unless needed.\n\n  Rationale: By default, a Docker engine instance will not listen on any network ports, with all communications with the client coming over the Unix socket. When Docker swarm mode is enabled on a docker engine instance, multiple network ports are opened on the system and made available to other systems on the network for the purposes of cluster management and node communications. Opening network ports on a system increase its attack surface and this should be avoided unless required.","descriptions":{"default":"Do not enable swarm mode on a docker engine instance unless needed.\n\n  Rationale: By default, a Docker engine instance will not listen on any network ports, with all communications with the client coming over the Unix socket. When Docker swarm mode is enabled on a docker engine instance, multiple network ports are opened on the system and made available to other systems on the network for the purposes of cluster management and node communications. Opening network ports on a system increase its attack surface and this should be avoided unless required."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/swarm_init/","ref":"docker swarm init"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.15","cis-docker-1.13.0":"2.15","level:1":null},"code":"control 'docker-2.15' do\n  impact 1.0\n  title 'Do not enable swarm mode, if not needed'\n  desc 'Do not enable swarm mode on a docker engine instance unless needed.\n\n  Rationale: By default, a Docker engine instance will not listen on any network ports, with all communications with the client coming over the Unix socket. When Docker swarm mode is enabled on a docker engine instance, multiple network ports are opened on the system and made available to other systems on the network for the purposes of cluster management and node communications. Opening network ports on a system increase its attack surface and this should be avoided unless required.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.15'\n  tag 'cis-docker-1.13.0': '2.15'\n  tag 'level:1'\n  ref 'docker swarm init', url: 'https://docs.docker.com/engine/reference/commandline/swarm_init/'\n\n  describe docker.info do\n    its('Swarm.LocalNodeState') { should eq SWARM_MODE }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":325},"id":"docker-2.15"},{"title":"Control the number of manager nodes in a swarm","desc":"Ensure that the minimum number of required manager nodes is created in a swarm.\n\n  Rationale: Manager nodes within a swarm have control over the swarm and change its configuration modifying security parameters. Having excessive manager nodes could render the swarm more susceptible to compromise. If fault tolerance is not required in the manager nodes, a single node should be elected as a manger. If fault tolerance is required then the smallest practical odd number to achieve the appropriate level of tolerance should be configured.","descriptions":{"default":"Ensure that the minimum number of required manager nodes is created in a swarm.\n\n  Rationale: Manager nodes within a swarm have control over the swarm and change its configuration modifying security parameters. Having excessive manager nodes could render the swarm more susceptible to compromise. If fault tolerance is not required in the manager nodes, a single node should be elected as a manger. If fault tolerance is required then the smallest practical odd number to achieve the appropriate level of tolerance should be configured."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/swarm/manage-nodes/","ref":"Manage nodes in a swarm"},{"url":"https://docs.docker.com/engine/swarm/admin_guide/","ref":"Administer and maintain a swarm of Docker Engines"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.16","cis-docker-1.13.0":"2.16","level:1":null},"code":"control 'docker-2.16' do\n  impact 1.0\n  title 'Control the number of manager nodes in a swarm'\n  desc 'Ensure that the minimum number of required manager nodes is created in a swarm.\n\n  Rationale: Manager nodes within a swarm have control over the swarm and change its configuration modifying security parameters. Having excessive manager nodes could render the swarm more susceptible to compromise. If fault tolerance is not required in the manager nodes, a single node should be elected as a manger. If fault tolerance is required then the smallest practical odd number to achieve the appropriate level of tolerance should be configured.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.16'\n  tag 'cis-docker-1.13.0': '2.16'\n  tag 'level:1'\n  ref 'Manage nodes in a swarm', url: 'https://docs.docker.com/engine/swarm/manage-nodes/'\n  ref 'Administer and maintain a swarm of Docker Engines', url: 'https://docs.docker.com/engine/swarm/admin_guide/'\n\n  only_if { SWARM_MODE == 'active' }\n  describe docker.info do\n    its('Swarm.Managers') { should cmp <= SWARM_MAX_MANAGER_NODES }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":343},"id":"docker-2.16"},{"title":"Bind swarm services to a specific host interface","desc":"By default, the docker swarm services will listen to all interfaces on the host, which may not be necessary for the operation of the swarm where the host has multiple network interfaces.\n\n  Rationale: When a swarm is initialized the default value for the --listen-addr flag is 0.0.0.0': '2377 which means that the swarm services will listen on all interfaces on the host. If a host has multiple network interfaces this may be undesirable as it may expose the docker swarm services to networks which are not involved in the operation of the swarm. By passing a specific IP address to the --listen-addr, a specific network interface can be specified limiting this exposure.","descriptions":{"default":"By default, the docker swarm services will listen to all interfaces on the host, which may not be necessary for the operation of the swarm where the host has multiple network interfaces.\n\n  Rationale: When a swarm is initialized the default value for the --listen-addr flag is 0.0.0.0': '2377 which means that the swarm services will listen on all interfaces on the host. If a host has multiple network interfaces this may be undesirable as it may expose the docker swarm services to networks which are not involved in the operation of the swarm. By passing a specific IP address to the --listen-addr, a specific network interface can be specified limiting this exposure."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/swarm_init/","ref":"docker swarm init"},{"url":"https://docs.docker.com/engine/swarm/admin_guide/","ref":"Administer and maintain a swarm of Docker Engines"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.17","cis-docker-1.13.0":"2.17","level:1":null},"code":"control 'docker-2.17' do\n  impact 1.0\n  title 'Bind swarm services to a specific host interface'\n  desc 'By default, the docker swarm services will listen to all interfaces on the host, which may not be necessary for the operation of the swarm where the host has multiple network interfaces.\n\n  Rationale: When a swarm is initialized the default value for the --listen-addr flag is 0.0.0.0\\': \\'2377 which means that the swarm services will listen on all interfaces on the host. If a host has multiple network interfaces this may be undesirable as it may expose the docker swarm services to networks which are not involved in the operation of the swarm. By passing a specific IP address to the --listen-addr, a specific network interface can be specified limiting this exposure.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.17'\n  tag 'cis-docker-1.13.0': '2.17'\n  tag 'level:1'\n  ref 'docker swarm init', url: 'https://docs.docker.com/engine/reference/commandline/swarm_init/'\n  ref 'Administer and maintain a swarm of Docker Engines', url: 'https://docs.docker.com/engine/swarm/admin_guide/'\n\n  only_if { SWARM_MODE == 'active' }\n  describe port(SWARM_PORT) do\n    its('addresses') { should_not include '0.0.0.0' }\n    its('addresses') { should_not include '::' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":363},"id":"docker-2.17"},{"title":"Disable Userland Proxy","desc":"The docker daemon starts a userland proxy service for port forwarding whenever a port is exposed. Where hairpin NAT is available, this service is generally superfluous to requirements and can be disabled.\n\n  Rationale: Docker engine provides two mechanisms for forwarding ports from the host to containers, hairpin NAT, and a userland proxy. In most circumstances, the hairpin NAT mode is preferred as it improves performance and makes use of native Linux iptables functionality instead of an additional component. Where hairpin NAT is available, the userland proxy should be disabled on startup to reduce the attack surface of the installation.","descriptions":{"default":"The docker daemon starts a userland proxy service for port forwarding whenever a port is exposed. Where hairpin NAT is available, this service is generally superfluous to requirements and can be disabled.\n\n  Rationale: Docker engine provides two mechanisms for forwarding ports from the host to containers, hairpin NAT, and a userland proxy. In most circumstances, the hairpin NAT mode is preferred as it improves performance and makes use of native Linux iptables functionality instead of an additional component. Where hairpin NAT is available, the userland proxy should be disabled on startup to reduce the attack surface of the installation."},"impact":1.0,"refs":[{"url":"http://windsock.io/the-docker-proxy/","ref":"The docker-proxy"},{"url":"https://github.com/docker/docker/issues/14856","ref":"Disable Userland proxy by default"},{"url":"https://github.com/moby/moby/issues/22741","ref":"overlay networking with userland-proxy disabled prevents port exposure"},{"url":"https://docs.docker.com/engine/userguide/networking/default_network/binding/","ref":"Bind container ports to the host"}],"tags":{"docker":null,"cis-docker-1.12.0":"2.18","cis-docker-1.13.0":"2.18","level:1":null},"code":"control 'docker-2.18' do\n  impact 1.0\n  title 'Disable Userland Proxy'\n  desc 'The docker daemon starts a userland proxy service for port forwarding whenever a port is exposed. Where hairpin NAT is available, this service is generally superfluous to requirements and can be disabled.\n\n  Rationale: Docker engine provides two mechanisms for forwarding ports from the host to containers, hairpin NAT, and a userland proxy. In most circumstances, the hairpin NAT mode is preferred as it improves performance and makes use of native Linux iptables functionality instead of an additional component. Where hairpin NAT is available, the userland proxy should be disabled on startup to reduce the attack surface of the installation.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '2.18'\n  tag 'cis-docker-1.13.0': '2.18'\n  tag 'level:1'\n  ref 'The docker-proxy', url: 'http://windsock.io/the-docker-proxy/'\n  ref 'Disable Userland proxy by default', url: 'https://github.com/docker/docker/issues/14856'\n  ref 'overlay networking with userland-proxy disabled prevents port exposure', url: 'https://github.com/moby/moby/issues/22741'\n  ref 'Bind container ports to the host', url: 'https://docs.docker.com/engine/userguide/networking/default_network/binding/'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['userland-proxy']) { should eq(false) }\n  end\n  describe processes('dockerd').commands do\n    it { should include 'userland-proxy=false' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":384},"id":"docker-2.18"},{"title":"Encrypt data exchanged between containers on different nodes on the overlay network","desc":"Encrypt data exchanged between containers on different nodes on the overlay network.\n\n  Rationale: By default, data exchanged between containers on different nodes on the overlay network is not encrypted. This could potentially expose traffic between the container nodes.","descriptions":{"default":"Encrypt data exchanged between containers on different nodes on the overlay network.\n\n  Rationale: By default, data exchanged between containers on different nodes on the overlay network is not encrypted. This could potentially expose traffic between the container nodes."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/userguide/networking/overlay-security-model/","ref":"Docker swarm mode overlay network security model"},{"url":"https://github.com/moby/moby/issues/24253","ref":"Docker swarm container-container traffic not encrypted when inspecting externally with tcpdump"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.19","level:1":null},"code":"control 'docker-2.19' do\n  impact 1.0\n  title 'Encrypt data exchanged between containers on different nodes on the overlay network'\n  desc 'Encrypt data exchanged between containers on different nodes on the overlay network.\n\n  Rationale: By default, data exchanged between containers on different nodes on the overlay network is not encrypted. This could potentially expose traffic between the container nodes.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.19'\n  tag 'level:1'\n  ref 'Docker swarm mode overlay network security model', url: 'https://docs.docker.com/engine/userguide/networking/overlay-security-model/'\n  ref 'Docker swarm container-container traffic not encrypted when inspecting externally with tcpdump', url: 'https://github.com/moby/moby/issues/24253'\n\n  only_if { SWARM_MODE == 'active' }\n  if docker_helper.overlay_networks\n    docker_helper.overlay_networks.each do |k, _v|\n      describe docker_helper.overlay_networks[k] do\n        its(['encrypted']) { should_not eq(nil) }\n      end\n    end\n  else\n    describe 'Encrypted overlay networks' do\n      skip 'Cannot determine overlay networks'\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":408},"id":"docker-2.19"},{"title":"Apply a daemon-wide custom seccomp profile, if needed","desc":"You can choose to apply your custom seccomp profile at the daemon-wide level if needed and override Docker's default seccomp profile.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security. You could apply your own custom seccomp profile instead of Docker's default seccomp profile. Alternatively, if Docker's default profile is good for your environment, you can choose to ignore this recommendation.","descriptions":{"default":"You can choose to apply your custom seccomp profile at the daemon-wide level if needed and override Docker's default seccomp profile.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security. You could apply your own custom seccomp profile instead of Docker's default seccomp profile. Alternatively, if Docker's default profile is good for your environment, you can choose to ignore this recommendation."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/pull/26276","ref":"daemon: add a flag to override the default seccomp profile"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.20","level:2":null},"code":"control 'docker-2.20' do\n  impact 1.0\n  title 'Apply a daemon-wide custom seccomp profile, if needed'\n  desc 'You can choose to apply your custom seccomp profile at the daemon-wide level if needed and override Docker\\'s default seccomp profile.\n\n  Rationale: A large number of system calls are exposed to every userland process with many of them going unused for the entire lifetime of the process. Most of the applications do not need all the system calls and thus benefit by having a reduced set of available system calls. The reduced set of system calls reduces the total kernel surface exposed to the application and thus improvises application security. You could apply your own custom seccomp profile instead of Docker\\'s default seccomp profile. Alternatively, if Docker\\'s default profile is good for your environment, you can choose to ignore this recommendation.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.20'\n  tag 'level:2'\n  ref 'daemon: add a flag to override the default seccomp profile', url: 'https://github.com/moby/moby/pull/26276'\n\n  describe json('/etc/docker/daemon.json') do\n    its(['seccomp-profile']) { should_not eq(nil) }\n    its(['seccomp-profile']) { should eq(SECCOMP_DEFAULT_PROFILE) }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":435},"id":"docker-2.20"},{"title":"Avoid experimental features in production","desc":"Avoid experimental features in production.\n\n  Rationale: Experimental is now a runtime docker daemon flag instead of a separate build. Passing --experimental as a runtime flag to the docker daemon, activates experimental features. Experimental is now considered a stable release, but with a couple of features which might not have tested and guaranteed API stability.","descriptions":{"default":"Avoid experimental features in production.\n\n  Rationale: Experimental is now a runtime docker daemon flag instead of a separate build. Passing --experimental as a runtime flag to the docker daemon, activates experimental features. Experimental is now considered a stable release, but with a couple of features which might not have tested and guaranteed API stability."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/issues/26713","ref":"Changing the definition of experimental"},{"url":"https://github.com/moby/moby/pull/27223","ref":"Make experimental a runtime flag"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.21","level:1":null},"code":"control 'docker-2.21' do\n  impact 1.0\n  title 'Avoid experimental features in production'\n  desc 'Avoid experimental features in production.\n\n  Rationale: Experimental is now a runtime docker daemon flag instead of a separate build. Passing --experimental as a runtime flag to the docker daemon, activates experimental features. Experimental is now considered a stable release, but with a couple of features which might not have tested and guaranteed API stability.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.21'\n  tag 'level:1'\n  ref 'Changing the definition of experimental', url: 'https://github.com/moby/moby/issues/26713'\n  ref 'Make experimental a runtime flag', url: 'https://github.com/moby/moby/pull/27223'\n\n  describe command('docker version --format \\'{{ .Server.Experimental }}\\'').stdout.chomp do\n    it { should eq('false') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":453},"id":"docker-2.21"},{"title":"Use Docker's secret management commands for managing secrets in a Swarm cluster","desc":"Use Docker's in-built secret management command.\n\n  Rationale: Docker has various commands for managing secrets in a Swarm cluster. This is the foundation for future secret support in Docker with potential improvements such as Windows support, different backing stores, etc.","descriptions":{"default":"Use Docker's in-built secret management command.\n\n  Rationale: Docker has various commands for managing secrets in a Swarm cluster. This is the foundation for future secret support in Docker with potential improvements such as Windows support, different backing stores, etc."},"impact":1.0,"refs":[{"url":"https://github.com/moby/moby/pull/27794","ref":"Secret Management"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.22","level:2":null},"code":"control 'docker-2.22' do\n  impact 1.0\n  title 'Use Docker\\'s secret management commands for managing secrets in a Swarm cluster'\n  desc 'Use Docker\\'s in-built secret management command.\n\n  Rationale: Docker has various commands for managing secrets in a Swarm cluster. This is the foundation for future secret support in Docker with potential improvements such as Windows support, different backing stores, etc.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.22'\n  tag 'level:2'\n  ref 'Secret Management', url: 'https://github.com/moby/moby/pull/27794'\n\n  only_if { SWARM_MODE == 'active' }\n  describe command('docker secret ls -q').stdout.split(\"\\n\").length do\n    it { should be > 0 }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":471},"id":"docker-2.22"},{"title":"Run swarm manager in auto-lock mode","desc":"Run Docker swarm manager in auto-lock mode.\n\n  Rationale: When Docker restarts, both the TLS key used to encrypt communication among swarm nodes, and the key used to encrypt and decrypt Raft logs on disk, are loaded into each manager node's memory. You should protect the mutual TLS encryption key and the key used to encrypt and decrypt Raft logs at rest. This protection could be enabled by initializing swarm with --autolock flag. With --autolock enabled, when Docker restarts, you must unlock the swarm first, using a key encryption key generated by Docker when the swarm was initialized.","descriptions":{"default":"Run Docker swarm manager in auto-lock mode.\n\n  Rationale: When Docker restarts, both the TLS key used to encrypt communication among swarm nodes, and the key used to encrypt and decrypt Raft logs on disk, are loaded into each manager node's memory. You should protect the mutual TLS encryption key and the key used to encrypt and decrypt Raft logs at rest. This protection could be enabled by initializing swarm with --autolock flag. With --autolock enabled, when Docker restarts, you must unlock the swarm first, using a key encryption key generated by Docker when the swarm was initialized."},"impact":1.0,"refs":[{"url":"https://github.com/mistyhacks/docker.github.io/blob/af7dfdba8504f9b102fb31a78cd08a06c33a8975/engine/swarm/swarm_manager_locking.md","ref":"Initialize a swarm with autolocking enabled"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.23","level:1":null},"code":"control 'docker-2.23' do\n  impact 1.0\n  title 'Run swarm manager in auto-lock mode'\n  desc 'Run Docker swarm manager in auto-lock mode.\n\n  Rationale: When Docker restarts, both the TLS key used to encrypt communication among swarm nodes, and the key used to encrypt and decrypt Raft logs on disk, are loaded into each manager node\\'s memory. You should protect the mutual TLS encryption key and the key used to encrypt and decrypt Raft logs at rest. This protection could be enabled by initializing swarm with --autolock flag. With --autolock enabled, when Docker restarts, you must unlock the swarm first, using a key encryption key generated by Docker when the swarm was initialized.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.23'\n  tag 'level:1'\n  ref 'Initialize a swarm with autolocking enabled', url: 'https://github.com/mistyhacks/docker.github.io/blob/af7dfdba8504f9b102fb31a78cd08a06c33a8975/engine/swarm/swarm_manager_locking.md'\n\n  only_if { SWARM_MODE == 'active' }\n  describe command('docker swarm unlock-key -q').stdout.chomp.length do\n    it { should be > 0 }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":489},"id":"docker-2.23"},{"title":"Rotate swarm manager auto-lock key periodically","desc":"Rotate swarm manager auto-lock key periodically.\n\n  Rationale: Swarm manager auto-lock key is not automatically rotated. You should rotate them periodically as a best practice.\n\n  Audit: Currently, there is no mechanism to find out when the key was last rotated on a swarm manager node. You should check with the system administrator if there is a key rotation record and the keys were rotated at a pre-defined frequency.","descriptions":{"default":"Rotate swarm manager auto-lock key periodically.\n\n  Rationale: Swarm manager auto-lock key is not automatically rotated. You should rotate them periodically as a best practice.\n\n  Audit: Currently, there is no mechanism to find out when the key was last rotated on a swarm manager node. You should check with the system administrator if there is a key rotation record and the keys were rotated at a pre-defined frequency."},"impact":1.0,"refs":[{"url":"https://github.com/mistyhacks/docker.github.io/blob/af7dfdba8504f9b102fb31a78cd08a06c33a8975/engine/swarm/swarm_manager_locking.md","ref":"Swarm Key rotation"}],"tags":{"docker":null,"cis-docker-1.13.0":"2.24","level:1":null},"code":"control 'docker-2.24' do\n  impact 1.0\n  title 'Rotate swarm manager auto-lock key periodically'\n  desc 'Rotate swarm manager auto-lock key periodically.\n\n  Rationale: Swarm manager auto-lock key is not automatically rotated. You should rotate them periodically as a best practice.\n\n  Audit: Currently, there is no mechanism to find out when the key was last rotated on a swarm manager node. You should check with the system administrator if there is a key rotation record and the keys were rotated at a pre-defined frequency.'\n\n  tag 'docker'\n  tag 'cis-docker-1.13.0': '2.24'\n  tag 'level:1'\n  ref 'Swarm Key rotation', url: 'https://github.com/mistyhacks/docker.github.io/blob/af7dfdba8504f9b102fb31a78cd08a06c33a8975/engine/swarm/swarm_manager_locking.md'\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration.rb","line":507},"id":"docker-2.24"},{"title":"Verify that docker.service file ownership is set to root:root","desc":"Verify that the 'docker.service' file ownership and group-ownership are correctly set to 'root'.\n\n  Rationale: 'docker.service' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.","descriptions":{"default":"Verify that the 'docker.service' file ownership and group-ownership are correctly set to 'root'.\n\n  Rationale: 'docker.service' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/systemd/","ref":"Control and configure Docker with systemd"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.1","cis-docker-1.13.0":"3.1","level:1":null},"code":"control 'docker-3.1' do\n  impact 1.0\n  title 'Verify that docker.service file ownership is set to root:root'\n  desc 'Verify that the \\'docker.service\\' file ownership and group-ownership are correctly set to \\'root\\'.\n\n  Rationale: \\'docker.service\\' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.1'\n  tag 'cis-docker-1.13.0': '3.1'\n  tag 'level:1'\n  ref 'Control and configure Docker with systemd', url: 'https://docs.docker.com/engine/admin/systemd/'\n\n  describe file(docker_helper.path) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":35},"id":"docker-3.1"},{"title":"Verify that docker.service file permissions are set to 644 or more restrictive","desc":"Verify that the 'docker.service' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: 'docker.service' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should not be writable by any other user other than 'root' to maintain the integrity of the file.","descriptions":{"default":"Verify that the 'docker.service' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: 'docker.service' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should not be writable by any other user other than 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/systemd/","ref":"Control and configure Docker with systemd"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.2","cis-docker-1.13.0":"3.2","level:1":null},"code":"control 'docker-3.2' do\n  impact 1.0\n  title 'Verify that docker.service file permissions are set to 644 or more restrictive'\n  desc 'Verify that the \\'docker.service\\' file permissions are correctly set to \\'644\\' or more restrictive.\n\n  Rationale: \\'docker.service\\' file contains sensitive parameters that may alter the behavior of Docker daemon. Hence, it should not be writable by any other user other than \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.2'\n  tag 'cis-docker-1.13.0': '3.2'\n  tag 'level:1'\n  ref 'Control and configure Docker with systemd', url: 'https://docs.docker.com/engine/admin/systemd/'\n\n  describe file(docker_helper.path) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should_not be_writable.by('group') }\n    it { should be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should_not be_executable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":56},"id":"docker-3.2"},{"title":"Verify that docker.socket file ownership is set to root:root","desc":"Verify that the 'docker.socket' file ownership and group-ownership are correctly set to 'root'\n\n  Rationale: 'docker.socket' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.","descriptions":{"default":"Verify that the 'docker.socket' file ownership and group-ownership are correctly set to 'root'\n\n  Rationale: 'docker.socket' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Dockerd"},{"url":"https://github.com/YungSang/fedora-atomic-packer/blob/master/oem/docker.socket","ref":"YungSang/fedora-atomic-packer"},{"url":"https://daviddaeschler.com/2014/12/14/centos-7rhel-7-and-docker-containers-on-boot/","ref":"CentOS 7/RHEL 7 and docker containers on boot"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.3","cis-docker-1.13.0":"3.3","level:1":null},"code":"control 'docker-3.3' do\n  impact 1.0\n  title 'Verify that docker.socket file ownership is set to root:root'\n  desc 'Verify that the \\'docker.socket\\' file ownership and group-ownership are correctly set to \\'root\\'\n\n  Rationale: \\'docker.socket\\' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.3'\n  tag 'cis-docker-1.13.0': '3.3'\n  tag 'level:1'\n  ref 'Dockerd', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n  ref 'YungSang/fedora-atomic-packer', url: 'https://github.com/YungSang/fedora-atomic-packer/blob/master/oem/docker.socket'\n  ref 'CentOS 7/RHEL 7 and docker containers on boot', url: 'https://daviddaeschler.com/2014/12/14/centos-7rhel-7-and-docker-containers-on-boot/'\n\n  describe file(docker_helper.socket) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":82},"id":"docker-3.3"},{"title":"Verify that docker.socket file permissions are set to 644 or more restrictive","desc":"Verify that the 'docker.socket' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: 'docker.socket' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be writable only by 'root' to maintain the integrity of the file.","descriptions":{"default":"Verify that the 'docker.socket' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: 'docker.socket' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be writable only by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Dockerd"},{"url":"https://github.com/YungSang/fedora-atomic-packer/blob/master/oem/docker.socket","ref":"YungSang/fedora-atomic-packer"},{"url":"https://daviddaeschler.com/2014/12/14/centos-7rhel-7-and-docker-containers-on-boot/","ref":"CentOS 7/RHEL 7 and docker containers on boot"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.4","cis-docker-1.13.0":"3.4","level:1":null},"code":"control 'docker-3.4' do\n  impact 1.0\n  title 'Verify that docker.socket file permissions are set to 644 or more restrictive'\n  desc 'Verify that the \\'docker.socket\\' file permissions are correctly set to \\'644\\' or more restrictive.\n\n  Rationale: \\'docker.socket\\' file contains sensitive parameters that may alter the behavior of Docker remote API. Hence, it should be writable only by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.4'\n  tag 'cis-docker-1.13.0': '3.4'\n  tag 'level:1'\n  ref 'Dockerd', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n  ref 'YungSang/fedora-atomic-packer', url: 'https://github.com/YungSang/fedora-atomic-packer/blob/master/oem/docker.socket'\n  ref 'CentOS 7/RHEL 7 and docker containers on boot', url: 'https://daviddaeschler.com/2014/12/14/centos-7rhel-7-and-docker-containers-on-boot/'\n\n  describe file(docker_helper.socket) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should_not be_writable.by('group') }\n    it { should be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should_not be_executable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":105},"id":"docker-3.4"},{"title":"Verify that /etc/docker directory ownership is set to root:root","desc":"'/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the directory.\n\n  Rationale: '/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the directory.","descriptions":{"default":"'/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the directory.\n\n  Rationale: '/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the directory."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.5","cis-docker-1.13.0":"3.5","level:1":null},"code":"control 'docker-3.5' do\n  impact 1.0\n  title 'Verify that /etc/docker directory ownership is set to root:root'\n  desc '\\'/etc/docker\\' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the directory.\n\n  Rationale: \\'/etc/docker\\' directory contains certificates and keys in addition to various sensitive files. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the directory.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.5'\n  tag 'cis-docker-1.13.0': '3.5'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n\n  describe file('/etc/docker') do\n    it { should exist }\n    it { should be_directory }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":133},"id":"docker-3.5"},{"title":"Verify that /etc/docker directory permissions are set to 755 or more restrictive","desc":"Verify that the /etc/docker directory permissions are correctly set to '755' or more restrictive.\n\n  Rationale: '/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should only be writable by 'root' to maintain the integrity of the directory.","descriptions":{"default":"Verify that the /etc/docker directory permissions are correctly set to '755' or more restrictive.\n\n  Rationale: '/etc/docker' directory contains certificates and keys in addition to various sensitive files. Hence, it should only be writable by 'root' to maintain the integrity of the directory."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/security/#conclusions","ref":"Docker Security"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.6","cis-docker-1.13.0":"3.6","level:1":null},"code":"control 'docker-3.6' do\n  impact 1.0\n  title 'Verify that /etc/docker directory permissions are set to 755 or more restrictive'\n  desc 'Verify that the /etc/docker directory permissions are correctly set to \\'755\\' or more restrictive.\n\n  Rationale: \\'/etc/docker\\' directory contains certificates and keys in addition to various sensitive files. Hence, it should only be writable by \\'root\\' to maintain the integrity of the directory.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.6'\n  tag 'cis-docker-1.13.0': '3.6'\n  tag 'level:1'\n  ref 'Docker Security', url: 'https://docs.docker.com/engine/security/security/#conclusions'\n\n  describe file('/etc/docker') do\n    it { should exist }\n    it { should be_directory }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should be_executable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should_not be_writable.by('group') }\n    it { should be_executable.by('group') }\n    it { should be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should be_executable.by('other') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":154},"id":"docker-3.6"},{"title":"Verify that registry certificate file ownership is set to root:root","desc":"Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) are owned and group-owned by 'root'.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must be owned and group-owned by 'root' to maintain the integrity of the certificates.","descriptions":{"default":"Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) are owned and group-owned by 'root'.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must be owned and group-owned by 'root' to maintain the integrity of the certificates."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.7","cis-docker-1.13.0":"3.7","level:1":null},"code":"control 'docker-3.7' do\n  impact 1.0\n  title 'Verify that registry certificate file ownership is set to root:root'\n  desc 'Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) are owned and group-owned by \\'root\\'.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must be owned and group-owned by \\'root\\' to maintain the integrity of the certificates.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.7'\n  tag 'cis-docker-1.13.0': '3.7'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(REGISTRY_CERT_PATH) do\n    it { should exist }\n    it { should be_directory }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\n\n  describe file(REGISTRY_NAME) do\n    it { should exist }\n    it { should be_directory }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\n\n  describe file(REGISTRY_CA_FILE) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":182},"id":"docker-3.7"},{"title":"Verify that registry certificate file permissions are set to 444 or more restrictive","desc":"Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) have permissions of '444' or more restrictive.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must have permissions of '444' to maintain the integrity of the certificates.","descriptions":{"default":"Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) have permissions of '444' or more restrictive.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must have permissions of '444' to maintain the integrity of the certificates."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.8","cis-docker-1.13.0":"3.8","level:1":null},"code":"control 'docker-3.8' do\n  impact 1.0\n  title 'Verify that registry certificate file permissions are set to 444 or more restrictive'\n  desc 'Verify that all the registry certificate files (usually found under /etc/docker/certs.d/<registry-name> directory) have permissions of \\'444\\' or more restrictive.\n\n  Rationale: /etc/docker/certs.d/<registry-name> directory contains Docker registry certificates. These certificate files must have permissions of \\'444\\' to maintain the integrity of the certificates.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.8'\n  tag 'cis-docker-1.13.0': '3.8'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(REGISTRY_CA_FILE) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable }\n    it { should_not be_executable }\n    it { should_not be_writable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":219},"id":"docker-3.8"},{"title":"Verify that TLS CA certificate file ownership is set to root:root","desc":"Verify that the TLS CA certificate file (the file that is passed alongwith '--tlscacert' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the CA certificate.","descriptions":{"default":"Verify that the TLS CA certificate file (the file that is passed alongwith '--tlscacert' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the CA certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.9","cis-docker-1.13.0":"3.9","level:1":null},"code":"control 'docker-3.9' do\n  impact 1.0\n  title 'Verify that TLS CA certificate file ownership is set to root:root'\n  desc 'Verify that the TLS CA certificate file (the file that is passed alongwith \\'--tlscacert\\' parameter) is owned and group-owned by \\'root\\'.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must be owned and group-owned by \\'root\\' to maintain the integrity of the CA certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.9'\n  tag 'cis-docker-1.13.0': '3.9'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlscacert']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":243},"id":"docker-3.9"},{"title":"Verify that TLS CA certificate file permissions are set to 444 or more restrictive","desc":"Verify that the TLS CA certificate file (the file that is passed alongwith '--tlscacert' parameter) has permissions of '444' or more restrictive.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must have permissions of '444' to maintain the integrity of the CA certificate.","descriptions":{"default":"Verify that the TLS CA certificate file (the file that is passed alongwith '--tlscacert' parameter) has permissions of '444' or more restrictive.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must have permissions of '444' to maintain the integrity of the CA certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.10","cis-docker-1.13.0":"3.10","level:1":null},"code":"control 'docker-3.10' do\n  impact 1.0\n  title 'Verify that TLS CA certificate file permissions are set to 444 or more restrictive'\n  desc 'Verify that the TLS CA certificate file (the file that is passed alongwith \\'--tlscacert\\' parameter) has permissions of \\'444\\' or more restrictive.\n\n  Rationale: The TLS CA certificate file should be protected from any tampering. It is used to authenticate Docker server based on given CA certificate. Hence, it must have permissions of \\'444\\' to maintain the integrity of the CA certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.10'\n  tag 'cis-docker-1.13.0': '3.10'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlscacert']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable }\n    it { should_not be_executable }\n    it { should_not be_writable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":266},"id":"docker-3.10"},{"title":"Verify that Docker server certificate file ownership is set to root:root","desc":"Verify that the Docker server certificate file (the file that is passed alongwith '--tlscert' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the certificate.","descriptions":{"default":"Verify that the Docker server certificate file (the file that is passed alongwith '--tlscert' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.11","cis-docker-1.13.0":"3.11","level:1":null},"code":"control 'docker-3.11' do\n  impact 1.0\n  title 'Verify that Docker server certificate file ownership is set to root:root'\n  desc 'Verify that the Docker server certificate file (the file that is passed alongwith \\'--tlscert\\' parameter) is owned and group-owned by \\'root\\'.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must be owned and group-owned by \\'root\\' to maintain the integrity of the certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.11'\n  tag 'cis-docker-1.13.0': '3.11'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlscert']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":290},"id":"docker-3.11"},{"title":"Verify that Docker server certificate file permissions are set to 444 or more restrictive","desc":"Verify that the Docker server certificate file (the file that is passed alongwith '--tlscert' parameter) has permissions of '444' or more restrictive.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must have permissions of '444' to maintain the integrity of the certificate.","descriptions":{"default":"Verify that the Docker server certificate file (the file that is passed alongwith '--tlscert' parameter) has permissions of '444' or more restrictive.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must have permissions of '444' to maintain the integrity of the certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.12","cis-docker-1.13.0":"3.12","level:1":null},"code":"control 'docker-3.12' do\n  impact 1.0\n  title 'Verify that Docker server certificate file permissions are set to 444 or more restrictive'\n  desc 'Verify that the Docker server certificate file (the file that is passed alongwith \\'--tlscert\\' parameter) has permissions of \\'444\\' or more restrictive.\n\n  Rationale: The Docker server certificate file should be protected from any tampering. It is used to authenticate Docker server based on the given server certificate. Hence, it must have permissions of \\'444\\' to maintain the integrity of the certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.12'\n  tag 'cis-docker-1.13.0': '3.12'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlscert']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable }\n    it { should_not be_executable }\n    it { should_not be_writable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":313},"id":"docker-3.12"},{"title":"Verify that Docker server certificate key file ownership is set to root:root","desc":"Verify that the Docker server certificate key file (the file that is passed alongwith '--tlskey' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the Docker server certificate.","descriptions":{"default":"Verify that the Docker server certificate key file (the file that is passed alongwith '--tlskey' parameter) is owned and group-owned by 'root'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must be owned and group-owned by 'root' to maintain the integrity of the Docker server certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.13","cis-docker-1.13.0":"3.13","level:1":null},"code":"control 'docker-3.13' do\n  impact 1.0\n  title 'Verify that Docker server certificate key file ownership is set to root:root'\n  desc 'Verify that the Docker server certificate key file (the file that is passed alongwith \\'--tlskey\\' parameter) is owned and group-owned by \\'root\\'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must be owned and group-owned by \\'root\\' to maintain the integrity of the Docker server certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.13'\n  tag 'cis-docker-1.13.0': '3.13'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlskey']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":337},"id":"docker-3.13"},{"title":"Verify that Docker server certificate key file permissions are set to 444 or more restrictive","desc":"Verify that the Docker server certificate key file (the file that is passed alongwith '--tlskey' parameter) has permissions of '400'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must have permissions of '400' to maintain the integrity of the Docker server certificate.","descriptions":{"default":"Verify that the Docker server certificate key file (the file that is passed alongwith '--tlskey' parameter) has permissions of '400'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must have permissions of '400' to maintain the integrity of the Docker server certificate."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/security/certificates/","ref":"Verify repository client with certificates"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/","ref":"Insecure Registry"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.14","cis-docker-1.13.0":"3.14","level:1":null},"code":"control 'docker-3.14' do\n  impact 1.0\n  title 'Verify that Docker server certificate key file permissions are set to 444 or more restrictive'\n  desc 'Verify that the Docker server certificate key file (the file that is passed alongwith \\'--tlskey\\' parameter) has permissions of \\'400\\'.\n\n  Rationale: The Docker server certificate key file should be protected from any tampering or unneeded reads. It holds the private key for the Docker server certificate. Hence, it must have permissions of \\'400\\' to maintain the integrity of the Docker server certificate.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.14'\n  tag 'cis-docker-1.13.0': '3.14'\n  tag 'level:1'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'Verify repository client with certificates', url: 'https://docs.docker.com/engine/security/certificates/'\n  ref 'Insecure Registry', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/'\n\n  describe file(json('/etc/docker/daemon.json').params['tlskey']) do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable }\n    it { should_not be_executable }\n    it { should_not be_writable }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":360},"id":"docker-3.14"},{"title":"Verify that Docker socket file ownership is set to root:docker","desc":"Verify that the Docker socket file is owned by 'root' and group-owned by 'docker'.\n\n  Rationale: Docker daemon runs as 'root'. The default Unix socket hence must be owned by 'root'. If any other user or process owns this socket, then it might be possible for that non-privileged user or process to interact with Docker daemon. Also, such a non-privileged user or process might interact with containers. This is neither secure nor desired behavior. Additionally, the Docker installer creates a Unix group called 'docker'. You can add users to this group, and then those users would be able to read and write to default Docker Unix socket. The membership to the 'docker' group is tightly controlled by the system administrator. If any other group owns this socket, then it might be possible for members of that group to interact with Docker daemon. Also, such a group might not be as tightly controlled as the 'docker' group. This is neither secure nor desired behavior. Hence, the default Docker Unix socket file must be owned by 'root' and group-owned by 'docker' to maintain the integrity of the socket file.","descriptions":{"default":"Verify that the Docker socket file is owned by 'root' and group-owned by 'docker'.\n\n  Rationale: Docker daemon runs as 'root'. The default Unix socket hence must be owned by 'root'. If any other user or process owns this socket, then it might be possible for that non-privileged user or process to interact with Docker daemon. Also, such a non-privileged user or process might interact with containers. This is neither secure nor desired behavior. Additionally, the Docker installer creates a Unix group called 'docker'. You can add users to this group, and then those users would be able to read and write to default Docker Unix socket. The membership to the 'docker' group is tightly controlled by the system administrator. If any other group owns this socket, then it might be possible for members of that group to interact with Docker daemon. Also, such a group might not be as tightly controlled as the 'docker' group. This is neither secure nor desired behavior. Hence, the default Docker Unix socket file must be owned by 'root' and group-owned by 'docker' to maintain the integrity of the socket file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option","ref":"Use the Docker command line"},{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.15","cis-docker-1.13.0":"3.15","level:1":null},"code":"control 'docker-3.15' do\n  impact 1.0\n  title 'Verify that Docker socket file ownership is set to root:docker'\n  desc 'Verify that the Docker socket file is owned by \\'root\\' and group-owned by \\'docker\\'.\n\n  Rationale: Docker daemon runs as \\'root\\'. The default Unix socket hence must be owned by \\'root\\'. If any other user or process owns this socket, then it might be possible for that non-privileged user or process to interact with Docker daemon. Also, such a non-privileged user or process might interact with containers. This is neither secure nor desired behavior. Additionally, the Docker installer creates a Unix group called \\'docker\\'. You can add users to this group, and then those users would be able to read and write to default Docker Unix socket. The membership to the \\'docker\\' group is tightly controlled by the system administrator. If any other group owns this socket, then it might be possible for members of that group to interact with Docker daemon. Also, such a group might not be as tightly controlled as the \\'docker\\' group. This is neither secure nor desired behavior. Hence, the default Docker Unix socket file must be owned by \\'root\\' and group-owned by \\'docker\\' to maintain the integrity of the socket file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.15'\n  tag 'cis-docker-1.13.0': '3.15'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n\n  describe file('/var/run/docker.sock') do\n    it { should exist }\n    it { should be_socket }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'docker' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":384},"id":"docker-3.15"},{"title":"Verify that Docker socket file permissions are set to 660 or more restrictive","desc":"Only 'root' and members of 'docker' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of '660' or more restrictive.\n\n  Rationale: Only 'root' and members of 'docker' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of '660' or more restrictive.","descriptions":{"default":"Only 'root' and members of 'docker' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of '660' or more restrictive.\n\n  Rationale: Only 'root' and members of 'docker' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of '660' or more restrictive."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option","ref":"Use the Docker command line"},{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.16","cis-docker-1.13.0":"3.16","level:1":null},"code":"control 'docker-3.16' do\n  impact 1.0\n  title 'Verify that Docker socket file permissions are set to 660 or more restrictive'\n  desc 'Only \\'root\\' and members of \\'docker\\' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of \\'660\\' or more restrictive.\n\n  Rationale: Only \\'root\\' and members of \\'docker\\' group should be allowed to read and write to default Docker Unix socket. Hence, the Docket socket file must have permissions of \\'660\\' or more restrictive.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.16'\n  tag 'cis-docker-1.13.0': '3.16'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n\n  describe file('/var/run/docker.sock') do\n    it { should exist }\n    it { should be_socket }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should_not be_executable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should be_writable.by('group') }\n    it { should_not be_executable.by('group') }\n    it { should_not be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should_not be_executable.by('other') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":406},"id":"docker-3.16"},{"title":"Verify that daemon.json file ownership is set to root:root","desc":"'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.\n\n  Rationale: 'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.","descriptions":{"default":"'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.\n\n  Rationale: 'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/#miscellaneous-options","ref":"dockerd"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.17","cis-docker-1.13.0":"3.17","level:1":null},"code":"control 'docker-3.17' do\n  impact 1.0\n  title 'Verify that daemon.json file ownership is set to root:root'\n  desc '\\'daemon.json\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.\n\n  Rationale: \\'daemon.json\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.17'\n  tag 'cis-docker-1.13.0': '3.17'\n  tag 'level:1'\n  ref 'dockerd', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/#miscellaneous-options'\n\n  describe file('/etc/docker/daemon.json') do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":435},"id":"docker-3.17"},{"title":"Verify that /etc/docker/daemon.json file permissions are set to 644 or more restrictive","desc":"'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file.\n\n  Rationale: 'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file.","descriptions":{"default":"'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file.\n\n  Rationale: 'daemon.json' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option","ref":"Use the Docker command line"},{"url":"https://docs.docker.com/engine/security/https/","ref":"Protect the Docker daemon socket"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/#miscellaneous-options","ref":"dockerd"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.18","cis-docker-1.13.0":"3.18","level:1":null},"code":"control 'docker-3.18' do\n  impact 1.0\n  title 'Verify that /etc/docker/daemon.json file permissions are set to 644 or more restrictive'\n  desc '\\'daemon.json\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by \\'root\\' to maintain the integrity of the file.\n\n  Rationale: \\'daemon.json\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.18'\n  tag 'cis-docker-1.13.0': '3.18'\n  tag 'level:1'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/#daemon-socket-option'\n  ref 'Protect the Docker daemon socket', url: 'https://docs.docker.com/engine/security/https/'\n  ref 'dockerd', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/#miscellaneous-options'\n\n  describe file('/etc/docker/daemon.json') do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should_not be_executable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should_not be_writable.by('group') }\n    it { should_not be_executable.by('group') }\n    it { should be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should_not be_executable.by('other') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":456},"id":"docker-3.18"},{"title":"Verify that /etc/default/docker file ownership is set to root:root","desc":"'/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.\n\n  Rationale: '/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.","descriptions":{"default":"'/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file.\n\n  Rationale: '/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/","ref":"Configure and troubleshoot the Docker daemon"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.19","cis-docker-1.13.0":"3.19","level:1":null},"code":"control 'docker-3.19' do\n  impact 1.0\n  title 'Verify that /etc/default/docker file ownership is set to root:root'\n  desc '\\'/etc/default/docker\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.\n\n  Rationale: \\'/etc/default/docker\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be owned and group-owned by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.19'\n  tag 'cis-docker-1.13.0': '3.19'\n  tag 'level:1'\n  ref 'Configure and troubleshoot the Docker daemon', url: 'https://docs.docker.com/engine/admin/'\n\n  only_if { os[:family] != 'centos' }\n  describe file('/etc/default/docker') do\n    it { should exist }\n    it { should be_file }\n    it { should be_owned_by 'root' }\n    it { should be_grouped_into 'root' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":486},"id":"docker-3.19"},{"title":"Verify that /etc/default/docker file permissions are set to 644 or more restrictive","desc":"Verify that the '/etc/default/docker' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: '/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file.","descriptions":{"default":"Verify that the '/etc/default/docker' file permissions are correctly set to '644' or more restrictive.\n\n  Rationale: '/etc/default/docker' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by 'root' to maintain the integrity of the file."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/","ref":"Configure and troubleshoot the Docker daemon"}],"tags":{"docker":null,"cis-docker-1.12.0":"3.20","cis-docker-1.13.0":"3.20","level:1":null},"code":"control 'docker-3.20' do\n  impact 1.0\n  title 'Verify that /etc/default/docker file permissions are set to 644 or more restrictive'\n  desc 'Verify that the \\'/etc/default/docker\\' file permissions are correctly set to \\'644\\' or more restrictive.\n\n  Rationale: \\'/etc/default/docker\\' file contains sensitive parameters that may alter the behavior of docker daemon. Hence, it should be writable only by \\'root\\' to maintain the integrity of the file.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '3.20'\n  tag 'cis-docker-1.13.0': '3.20'\n  tag 'level:1'\n  ref 'Configure and troubleshoot the Docker daemon', url: 'https://docs.docker.com/engine/admin/'\n\n  only_if { os[:family] != 'centos' }\n  describe file('/etc/default/docker') do\n    it { should exist }\n    it { should be_file }\n    it { should be_readable.by('owner') }\n    it { should be_writable.by('owner') }\n    it { should_not be_executable.by('owner') }\n    it { should be_readable.by('group') }\n    it { should_not be_writable.by('group') }\n    it { should_not be_executable.by('group') }\n    it { should be_readable.by('other') }\n    it { should_not be_writable.by('other') }\n    it { should_not be_executable.by('other') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_daemon_configuration_files.rb","line":508},"id":"docker-3.20"},{"title":"Perform regular security audits of your host system and containers","desc":"Perform regular security audits of your host system and containers to identify any mis-configurations or vulnerabilities that could expose your system to compromise.\n\n  Rationale: Performing regular and dedicated security audits of your host systems and containers could provide deep security insights that you might not know in your daily course of business. The identified security weaknesses should be then mitigated and this overall improves security posture of your environment.","descriptions":{"default":"Perform regular security audits of your host system and containers to identify any mis-configurations or vulnerabilities that could expose your system to compromise.\n\n  Rationale: Performing regular and dedicated security audits of your host systems and containers could provide deep security insights that you might not know in your daily course of business. The identified security weaknesses should be then mitigated and this overall improves security posture of your environment."},"impact":1.0,"refs":[{"url":"http://searchsecurity.techtarget.com/IT-security-auditing-Best-practices-for-conducting-audits","ref":"IT security auditing: Best practices for conducting audits"}],"tags":{"docker":null,"cis-docker-1.12.0":"6.1","cis-docker-1.13.0":"6.1","level:1":null},"code":"control 'docker-6.1' do\n  impact 1.0\n  title 'Perform regular security audits of your host system and containers'\n  desc 'Perform regular security audits of your host system and containers to identify any mis-configurations or vulnerabilities that could expose your system to compromise.\n\n  Rationale: Performing regular and dedicated security audits of your host systems and containers could provide deep security insights that you might not know in your daily course of business. The identified security weaknesses should be then mitigated and this overall improves security posture of your environment.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '6.1'\n  tag 'cis-docker-1.13.0': '6.1'\n  tag 'level:1'\n  ref 'IT security auditing: Best practices for conducting audits', url: 'http://searchsecurity.techtarget.com/IT-security-auditing-Best-practices-for-conducting-audits'\n\n  describe 'docker-test' do\n    skip 'Perform regular security audits of your host system and containers'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_security_operations.rb","line":30},"id":"docker-6.1"},{"title":"Monitor Docker containers usage, performance and metering","desc":"Containers might run services that are critical for your business. Monitoring their usage, performance and metering would be of paramount importance.\n\n  Rationale: Tracking container usage, performance and having some sort of metering around them would be important as you embrace the containers to run critical services for your business. This would give you\n\n      Capacity Management and Optimization\n      Performance Management\n      Comprehensive Visibility\n\n  Such a deep visibility of container performance would help you ensure high availability of containers and minimum downtime.","descriptions":{"default":"Containers might run services that are critical for your business. Monitoring their usage, performance and metering would be of paramount importance.\n\n  Rationale: Tracking container usage, performance and having some sort of metering around them would be important as you embrace the containers to run critical services for your business. This would give you\n\n      Capacity Management and Optimization\n      Performance Management\n      Comprehensive Visibility\n\n  Such a deep visibility of container performance would help you ensure high availability of containers and minimum downtime."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/admin/runmetrics/","ref":"Runtime metrics"},{"url":"https://github.com/google/cadvisor","ref":"cAdvisor (Container Advisor)"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"}],"tags":{"docker":null,"cis-docker-1.12.0":"6.2","cis-docker-1.13.0":"6.2","level:1":null},"code":"control 'docker-6.2' do\n  impact 1.0\n  title 'Monitor Docker containers usage, performance and metering'\n  desc 'Containers might run services that are critical for your business. Monitoring their usage, performance and metering would be of paramount importance.\n\n  Rationale: Tracking container usage, performance and having some sort of metering around them would be important as you embrace the containers to run critical services for your business. This would give you\n\n      Capacity Management and Optimization\n      Performance Management\n      Comprehensive Visibility\n\n  Such a deep visibility of container performance would help you ensure high availability of containers and minimum downtime.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '6.2'\n  tag 'cis-docker-1.13.0': '6.2'\n  tag 'level:1'\n  ref 'Runtime metrics', url: 'https://docs.docker.com/engine/admin/runmetrics/'\n  ref 'cAdvisor (Container Advisor)', url: 'https://github.com/google/cadvisor'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n\n  describe 'docker-test' do\n    skip 'Monitor Docker containers usage, performance and metering'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_security_operations.rb","line":48},"id":"docker-6.2"},{"title":"Backup container data","desc":"Take regular backups of your container data volumes.\n\n  Rationale: Containers might run services that are critical for your business. Taking regular data backups would ensure that if there is ever any loss of data you would still have your data in backup. The loss of data could be devastating for your business.","descriptions":{"default":"Take regular backups of your container data volumes.\n\n  Rationale: Containers might run services that are critical for your business. Taking regular data backups would ensure that if there is ever any loss of data you would still have your data in backup. The loss of data could be devastating for your business."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/datacenter/ucp/2.2/guides/admin/backups-and-disaster-recovery/","ref":"Backups and disaster recovery"},{"url":"https://stackoverflow.com/questions/26331651/how-can-i-backup-a-docker-container-with-its-data-volumes","ref":"How can I backup a Docker-container with its data-volumes?"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"}],"tags":{"docker":null,"cis-docker-1.12.0":"6.3","cis-docker-1.13.0":"6.3","level:1":null},"code":"control 'docker-6.3' do\n  impact 1.0\n  title 'Backup container data'\n  desc 'Take regular backups of your container data volumes.\n\n  Rationale: Containers might run services that are critical for your business. Taking regular data backups would ensure that if there is ever any loss of data you would still have your data in backup. The loss of data could be devastating for your business.'\n\n  tag 'docker'\n  tag 'cis-docker-1.12.0': '6.3'\n  tag 'cis-docker-1.13.0': '6.3'\n  tag 'level:1'\n  ref 'Backups and disaster recovery', url: 'https://docs.docker.com/datacenter/ucp/2.2/guides/admin/backups-and-disaster-recovery/'\n  ref 'How can I backup a Docker-container with its data-volumes?', url: 'https://stackoverflow.com/questions/26331651/how-can-i-backup-a-docker-container-with-its-data-volumes'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n\n  describe 'docker-test' do\n    skip 'Backup container data'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_security_operations.rb","line":74},"id":"docker-6.3"},{"title":"Avoid image sprawl","desc":"Do not keep a large number of container images on the same host. Use only tagged images as appropriate.\n\n  Rationale: Tagged images are useful to fall back from \"latest\" to a specific version of an image in production. Images with unused or old tags may contain vulnerabilities that might be exploited, if instantiated. Additionally, if you fail to remove unused images from the system and there are various such redundant and unused images, the host filesystem may become full and could lead to denial of service.","descriptions":{"default":"Do not keep a large number of container images on the same host. Use only tagged images as appropriate.\n\n  Rationale: Tagged images are useful to fall back from \"latest\" to a specific version of an image in production. Images with unused or old tags may contain vulnerabilities that might be exploited, if instantiated. Additionally, if you fail to remove unused images from the system and there are various such redundant and unused images, the host filesystem may become full and could lead to denial of service."},"impact":1.0,"refs":[{"url":"http://craiccomputing.blogspot.de/2014/09/clean-up-unused-docker-containers-and.html","ref":"Clean up unused Docker Containers and Images"},{"url":"https://forums.docker.com/t/command-to-remove-all-unused-images/20/8","ref":"Command to remove all unused images"},{"url":"https://github.com/moby/moby/issues/9054","ref":"docker rmi --unused"},{"url":"https://docs.docker.com/engine/reference/commandline/cli/","ref":"Use the Docker command line"},{"url":"https://github.com/moby/moby/pull/11109","ref":"Add support for referring to images by digest"}],"tags":{"host":null,"cis-docker-1.12.0":"6.4","cis-docker-1.13.0":"6.4","level:1":null},"code":"control 'host-6.4' do\n  impact 1.0\n  title 'Avoid image sprawl'\n  desc 'Do not keep a large number of container images on the same host. Use only tagged images as appropriate.\n\n  Rationale: Tagged images are useful to fall back from \"latest\" to a specific version of an image in production. Images with unused or old tags may contain vulnerabilities that might be exploited, if instantiated. Additionally, if you fail to remove unused images from the system and there are various such redundant and unused images, the host filesystem may become full and could lead to denial of service.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '6.4'\n  tag 'cis-docker-1.13.0': '6.4'\n  tag 'level:1'\n  ref 'Clean up unused Docker Containers and Images', url: 'http://craiccomputing.blogspot.de/2014/09/clean-up-unused-docker-containers-and.html'\n  ref 'Command to remove all unused images', url: 'https://forums.docker.com/t/command-to-remove-all-unused-images/20/8'\n  ref 'docker rmi --unused', url: 'https://github.com/moby/moby/issues/9054'\n  ref 'Use the Docker command line', url: 'https://docs.docker.com/engine/reference/commandline/cli/'\n  ref 'Add support for referring to images by digest', url: 'https://github.com/moby/moby/pull/11109'\n\n  instantiated_images = command('docker ps -qa | xargs docker inspect -f \\'{{.Image}}\\'').stdout.split\n  all_images = command('docker images -q --no-trunc').stdout.split\n  diff = all_images - instantiated_images\n\n  describe diff do\n    it { should be_empty }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_security_operations.rb","line":94},"id":"host-6.4"},{"title":"Avoid container sprawl","desc":"Do not keep a large number of containers on the same host.\n\n  Rationale: The flexibility of containers makes it easy to run multiple instances of applications and indirectly leads to Docker images that exist at varying security patch levels. It also means that you are consuming host resources that otherwise could have been used for running 'useful' containers. Having more than just the manageable number of containers on a particular host makes the situation vulnerable to mishandling, misconfiguration and fragmentation. Thus, avoid container sprawl and keep the number of containers on a host to a manageable total.","descriptions":{"default":"Do not keep a large number of containers on the same host.\n\n  Rationale: The flexibility of containers makes it easy to run multiple instances of applications and indirectly leads to Docker images that exist at varying security patch levels. It also means that you are consuming host resources that otherwise could have been used for running 'useful' containers. Having more than just the manageable number of containers on a particular host makes the situation vulnerable to mishandling, misconfiguration and fragmentation. Thus, avoid container sprawl and keep the number of containers on a host to a manageable total."},"impact":1.0,"refs":[{"url":"https://zeltser.com/security-risks-and-benefits-of-docker-application/","ref":"Security Risks and Benefits of Docker Application Containers"},{"url":"http://searchsdn.techtarget.com/feature/Docker-networking-How-Linux-containers-will-change-your-network","ref":"Docker networking: How Linux containers will change your network"}],"tags":{"host":null,"cis-docker-1.12.0":"6.5","cis-docker-1.13.0":"6.5","level:1":null},"code":"control 'host-6.5' do\n  impact 1.0\n  title 'Avoid container sprawl'\n  desc 'Do not keep a large number of containers on the same host.\n\n  Rationale: The flexibility of containers makes it easy to run multiple instances of applications and indirectly leads to Docker images that exist at varying security patch levels. It also means that you are consuming host resources that otherwise could have been used for running \\'useful\\' containers. Having more than just the manageable number of containers on a particular host makes the situation vulnerable to mishandling, misconfiguration and fragmentation. Thus, avoid container sprawl and keep the number of containers on a host to a manageable total.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '6.5'\n  tag 'cis-docker-1.13.0': '6.5'\n  tag 'level:1'\n  ref 'Security Risks and Benefits of Docker Application Containers', url: 'https://zeltser.com/security-risks-and-benefits-of-docker-application/'\n  ref 'Docker networking: How Linux containers will change your network', url: 'http://searchsdn.techtarget.com/feature/Docker-networking-How-Linux-containers-will-change-your-network'\n\n  total_on_host = command('docker info').stdout.split[1].to_i\n  total_running = command('docker ps -q').stdout.split.length\n  diff = total_on_host - total_running\n\n  describe diff do\n    it { should be <= MANAGEABLE_CONTAINER_NUMBER }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/docker_security_operations.rb","line":120},"id":"host-6.5"},{"title":"Create a separate partition for containers","desc":"All Docker containers and their data and metadata is stored under /var/lib/docker directory. By default, /var/lib/docker would be mounted under / or /var partitions based on availability.\n\n  Rationale: Docker depends on /var/lib/docker as the default directory where all Docker related files, including the images, are stored. This directory might fill up fast and soon Docker and the host could become unusable. So, it is advisable to create a separate partition (logical volume) for storing Docker files.","descriptions":{"default":"All Docker containers and their data and metadata is stored under /var/lib/docker directory. By default, /var/lib/docker would be mounted under / or /var partitions based on availability.\n\n  Rationale: Docker depends on /var/lib/docker as the default directory where all Docker related files, including the images, are stored. This directory might fill up fast and soon Docker and the host could become unusable. So, it is advisable to create a separate partition (logical volume) for storing Docker files."},"impact":1.0,"refs":[{"url":"http://www.projectatomic.io/docs/docker-storage-recommendation/","ref":"Docker storage recommendation"}],"tags":{"host":null,"cis-docker-1.12.0":"1.1","cis-docker-1.13.0":"1.1","level:1":null},"code":"control 'host-1.1' do\n  impact 1.0\n  title 'Create a separate partition for containers'\n  desc 'All Docker containers and their data and metadata is stored under /var/lib/docker directory. By default, /var/lib/docker would be mounted under / or /var partitions based on availability.\n\n  Rationale: Docker depends on /var/lib/docker as the default directory where all Docker related files, including the images, are stored. This directory might fill up fast and soon Docker and the host could become unusable. So, it is advisable to create a separate partition (logical volume) for storing Docker files.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.1'\n  tag 'cis-docker-1.13.0': '1.1'\n  tag 'level:1'\n  ref 'Docker storage recommendation', url: 'http://www.projectatomic.io/docs/docker-storage-recommendation/'\n\n  describe mount('/var/lib/docker') do\n    it { should be_mounted }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":34},"id":"host-1.1"},{"title":"Use the updated Linux Kernel","desc":"Docker in daemon mode has specific kernel requirements. A 3.10 Linux kernel is the minimum requirement for Docker.","descriptions":{"default":"Docker in daemon mode has specific kernel requirements. A 3.10 Linux kernel is the minimum requirement for Docker."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/installation/binaries/#check-kernel-dependencies","ref":"Check kernel dependencies"},{"url":"https://docs.docker.com/engine/installation/#installation-list","ref":"Installation list"}],"tags":{"host":null,"cis-docker-1.12.0":"1.2","level:1":null},"code":"control 'host-1.2' do\n  impact 1.0\n  title 'Use the updated Linux Kernel'\n  desc 'Docker in daemon mode has specific kernel requirements. A 3.10 Linux kernel is the minimum requirement for Docker.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.2'\n  tag 'level:1'\n  ref 'Check kernel dependencies', url: 'https://docs.docker.com/engine/installation/binaries/#check-kernel-dependencies'\n  ref 'Installation list', url: 'https://docs.docker.com/engine/installation/#installation-list'\n\n  only_if { os.linux? }\n  kernel_version = command('uname -r | grep -o \\'^\\w\\.\\w*\\.\\w*\\'').stdout\n  kernel_compare = Gem::Version.new('3.10') <= Gem::Version.new(kernel_version)\n  describe kernel_compare do\n    it { should eq true }\n  end\n  only_if { BENCHMARK_VERSION == '1.12.0' }\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":52},"id":"host-1.2"},{"title":"Harden the container host","desc":"Containers run on a Linux host. A container host can run one or more containers. It is of utmost importance to harden the host to mitigate host security misconfiguration.\n\n  Rationale: You should follow infrastructure security best practices and harden your host OS. Keeping the host system hardened would ensure that the host vulnerabilities are mitigated. Not hardening the host system could lead to security exposures and breaches. You can use the dev-sec.io Hardening Framework for this task\n\n  By default, host has factory settings. It is not hardened.","descriptions":{"default":"Containers run on a Linux host. A container host can run one or more containers. It is of utmost importance to harden the host to mitigate host security misconfiguration.\n\n  Rationale: You should follow infrastructure security best practices and harden your host OS. Keeping the host system hardened would ensure that the host vulnerabilities are mitigated. Not hardening the host system could lead to security exposures and breaches. You can use the dev-sec.io Hardening Framework for this task\n\n  By default, host has factory settings. It is not hardened."},"impact":1.0,"refs":[{"url":"http://dev-sec.io/","ref":"Dev-Sec Hardening Framework"},{"url":"https://docs.docker.com/engine/security/","ref":"Secure Engine"},{"url":"https://learn.cisecurity.org/benchmarks","ref":"Center of Internet Security Benchmarks"},{"url":"https://grsecurity.net/","ref":"Grsecurity"},{"url":"https://en.wikibooks.org/wiki/Grsecurity","ref":"Grsecurity Wiki"},{"url":"https://pax.grsecurity.net/","ref":"PAX Security"},{"url":"https://en.wikipedia.org/wiki/PaX","ref":"PAX Security Wiki"}],"tags":{"host":null,"cis-docker-1.12.0":"1.3","cis-docker-1.13.0":"1.2","level:1":null},"code":"control 'host-1.3' do\n  impact 1.0\n  title 'Harden the container host'\n  desc 'Containers run on a Linux host. A container host can run one or more containers. It is of utmost importance to harden the host to mitigate host security misconfiguration.\n\n  Rationale: You should follow infrastructure security best practices and harden your host OS. Keeping the host system hardened would ensure that the host vulnerabilities are mitigated. Not hardening the host system could lead to security exposures and breaches. You can use the dev-sec.io Hardening Framework for this task\n\n  By default, host has factory settings. It is not hardened.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.3'\n  tag 'cis-docker-1.13.0': '1.2'\n  tag 'level:1'\n  ref 'Dev-Sec Hardening Framework', url: 'http://dev-sec.io/'\n  ref 'Secure Engine', url: 'https://docs.docker.com/engine/security/'\n  ref 'Center of Internet Security Benchmarks', url: 'https://learn.cisecurity.org/benchmarks'\n  ref 'Grsecurity', url: 'https://grsecurity.net/'\n  ref 'Grsecurity Wiki', url: 'https://en.wikibooks.org/wiki/Grsecurity'\n  ref 'PAX Security', url: 'https://pax.grsecurity.net/'\n  ref 'PAX Security Wiki', url: 'https://en.wikipedia.org/wiki/PaX'\n\n  describe 'docker-test' do\n    skip 'Harden the container host. Use the Dev-Sec Hardening Framework'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":72},"id":"host-1.3"},{"title":"Remove all non-essential services from the host","desc":"Ensure that the host running the docker daemon is running only the essential services.","descriptions":{"default":"Ensure that the host running the docker daemon is running only the essential services."},"impact":1.0,"refs":[{"url":"https://blog.docker.com/2013/08/containers-docker-how-secure-are-they/","ref":"Containers & Docker: How Secure Are They?"},{"url":"http://dev-sec.io/","ref":"Dev-Sec Hardening Framework"}],"tags":{"host":null,"cis-docker-1.12.0":"1.4","level:1":null},"code":"control 'host-1.4' do\n  impact 1.0\n  title 'Remove all non-essential services from the host'\n  desc 'Ensure that the host running the docker daemon is running only the essential services.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.4'\n  tag 'level:1'\n  ref 'Containers & Docker: How Secure Are They?', url: 'https://blog.docker.com/2013/08/containers-docker-how-secure-are-they/'\n  ref 'Dev-Sec Hardening Framework', url: 'http://dev-sec.io/'\n\n  describe 'docker-test' do\n    skip 'Remove all non-essential services from the host. Use the Dev-Sec Hardening Framework'\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":98},"id":"host-1.4"},{"title":"Keep Docker up to date","desc":"There are frequent releases for Docker software that address security vulnerabilities,product bugs and bring in new functionality. Keep a tab on these product updates and upgrade as frequently as when new security vulnerabilities are fixed or deemed correct for your organization.\n\n  Rationale: By staying up to date on Docker updates, vulnerabilities in the Docker software can be mitigated. An educated attacker may exploit known vulnerabilities when attempting to attain access or elevate privileges. Not installing regular Docker updates may leave you ith running vulnerable Docker software. It might lead to elevation privileges, unauthorized access or other security breaches. Keep a track of new releases and update as necessary.","descriptions":{"default":"There are frequent releases for Docker software that address security vulnerabilities,product bugs and bring in new functionality. Keep a tab on these product updates and upgrade as frequently as when new security vulnerabilities are fixed or deemed correct for your organization.\n\n  Rationale: By staying up to date on Docker updates, vulnerabilities in the Docker software can be mitigated. An educated attacker may exploit known vulnerabilities when attempting to attain access or elevate privileges. Not installing regular Docker updates may leave you ith running vulnerable Docker software. It might lead to elevation privileges, unauthorized access or other security breaches. Keep a track of new releases and update as necessary."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/installation/","ref":"Docker installation"},{"url":"https://github.com/moby/moby/releases/tag/v17.03.2-ce","ref":"Docker releases"},{"url":"https://docs.docker.com/enterprise/","ref":"About Docker EE"}],"tags":{"host":null,"cis-docker-1.12.0":"1.5","cis-docker-1.13.0":"1.3","level:1":null},"code":"control 'host-1.5' do\n  impact 1.0\n  title 'Keep Docker up to date'\n  desc 'There are frequent releases for Docker software that address security vulnerabilities,product bugs and bring in new functionality. Keep a tab on these product updates and upgrade as frequently as when new security vulnerabilities are fixed or deemed correct for your organization.\n\n  Rationale: By staying up to date on Docker updates, vulnerabilities in the Docker software can be mitigated. An educated attacker may exploit known vulnerabilities when attempting to attain access or elevate privileges. Not installing regular Docker updates may leave you ith running vulnerable Docker software. It might lead to elevation privileges, unauthorized access or other security breaches. Keep a track of new releases and update as necessary.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.5'\n  tag 'cis-docker-1.13.0': '1.3'\n  tag 'level:1'\n  ref 'Docker installation', url: 'https://docs.docker.com/engine/installation/'\n  ref 'Docker releases', url: 'https://github.com/moby/moby/releases/tag/v17.03.2-ce'\n  ref 'About Docker EE', url: 'https://docs.docker.com/enterprise/'\n\n  describe docker do\n    its('version.Client.Version') { should cmp >= '17.06' }\n    its('version.Server.Version') { should cmp >= '17.06' }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":114},"id":"host-1.5"},{"title":"Only allow trusted users to control Docker daemon","desc":"The Docker daemon currently requires 'root' privileges. A user added to the 'docker' group gives him full 'root' access rights.\n\n  Rationale: Docker allows you to share a directory between the Docker host and a guest container without limiting the access rights of the container. This means that you can start a container and map the / directory on your host to the container. The container will then be able to alter your host file system without any restrictions. In simple terms, it means that you can attain elevated privileges with just being a member of the 'docker' group and then starting a container with mapped / directory on the host.","descriptions":{"default":"The Docker daemon currently requires 'root' privileges. A user added to the 'docker' group gives him full 'root' access rights.\n\n  Rationale: Docker allows you to share a directory between the Docker host and a guest container without limiting the access rights of the container. This means that you can start a container and map the / directory on your host to the container. The container will then be able to alter your host file system without any restrictions. In simple terms, it means that you can attain elevated privileges with just being a member of the 'docker' group and then starting a container with mapped / directory on the host."},"impact":1.0,"refs":[{"url":"https://docs.docker.com/engine/security/","ref":"Docker Engine Security"},{"url":"https://www.zopyx.com/andreas-jung/contents/on-docker-security-docker-group-considered-harmful","ref":"On Docker security: 'docker' group considered harmful"},{"url":"http://www.projectatomic.io/blog/2015/08/why-we-dont-let-non-root-users-run-docker-in-centos-fedora-or-rhel/","ref":"Why we don't let non-root users run Docker in CentOS, Fedora, or RHEL"}],"tags":{"host":null,"cis-docker-1.12.0":"1.6","cis-docker-1.13.0":"1.4","level:1":null},"code":"control 'host-1.6' do\n  impact 1.0\n  title 'Only allow trusted users to control Docker daemon'\n  desc 'The Docker daemon currently requires \\'root\\' privileges. A user added to the \\'docker\\' group gives him full \\'root\\' access rights.\n\n  Rationale: Docker allows you to share a directory between the Docker host and a guest container without limiting the access rights of the container. This means that you can start a container and map the / directory on your host to the container. The container will then be able to alter your host file system without any restrictions. In simple terms, it means that you can attain elevated privileges with just being a member of the \\'docker\\' group and then starting a container with mapped / directory on the host.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.6'\n  tag 'cis-docker-1.13.0': '1.4'\n  tag 'level:1'\n  ref 'Docker Engine Security', url: 'https://docs.docker.com/engine/security/'\n  ref 'On Docker security: \\'docker\\' group considered harmful', url: 'https://www.zopyx.com/andreas-jung/contents/on-docker-security-docker-group-considered-harmful'\n  ref 'Why we don\\'t let non-root users run Docker in CentOS, Fedora, or RHEL', url: 'http://www.projectatomic.io/blog/2015/08/why-we-dont-let-non-root-users-run-docker-in-centos-fedora-or-rhel/'\n\n  describe group('docker') do\n    it { should exist }\n  end\n\n  describe etc_group.where(group_name: 'docker') do\n    its('users') { should include TRUSTED_USER }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":135},"id":"host-1.6"},{"title":"Audit docker daemon","desc":"Audit all Docker daemon activities.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit Docker daemon as well. Docker daemon runs with 'root' privileges. It is thus necessary to audit its activities and usage.","descriptions":{"default":"Audit all Docker daemon activities.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit Docker daemon as well. Docker daemon runs with 'root' privileges. It is thus necessary to audit its activities and usage."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.7","cis-docker-1.13.0":"1.5","level:1":null},"code":"control 'host-1.7' do\n  impact 1.0\n  title 'Audit docker daemon'\n  desc 'Audit all Docker daemon activities.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit Docker daemon as well. Docker daemon runs with \\'root\\' privileges. It is thus necessary to audit its activities and usage.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.7'\n  tag 'cis-docker-1.13.0': '1.5'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /usr/bin/docker -p rwxa -k docker') }\n  end\n  describe service('auditd') do\n    it { should be_installed }\n    it { should be_enabled }\n    it { should be_running }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":159},"id":"host-1.7"},{"title":"Audit Docker files and directories - /var/lib/docker","desc":"Audit /var/lib/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /var/lib/docker is one such directory. It holds all the information about containers. It must be audited.","descriptions":{"default":"Audit /var/lib/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /var/lib/docker is one such directory. It holds all the information about containers. It must be audited."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.8","cis-docker-1.13.0":"1.6","level:1":null},"code":"control 'host-1.8' do\n  impact 1.0\n  title 'Audit Docker files and directories - /var/lib/docker'\n  desc 'Audit /var/lib/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /var/lib/docker is one such directory. It holds all the information about containers. It must be audited.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.8'\n  tag 'cis-docker-1.13.0': '1.6'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /var/lib/docker/ -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":183},"id":"host-1.8"},{"title":"Audit Docker files and directories - /etc/docker","desc":"Audit /etc/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/docker is one such directory. It holds various certificates and keys used for TLS communication between Docker daemon and Docker client. It must be audited.","descriptions":{"default":"Audit /etc/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/docker is one such directory. It holds various certificates and keys used for TLS communication between Docker daemon and Docker client. It must be audited."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.9","cis-docker-1.13.0":"1.7","level:1":null},"code":"control 'host-1.9' do\n  impact 1.0\n  title 'Audit Docker files and directories - /etc/docker'\n  desc 'Audit /etc/docker.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /etc/docker is one such directory. It holds various certificates and keys used for TLS communication between Docker daemon and Docker client. It must be audited.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.9'\n  tag 'cis-docker-1.13.0': '1.7'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /etc/docker/ -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":202},"id":"host-1.9"},{"title":"Audit Docker files and directories - docker.service","desc":"Audit docker.service, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. docker.service is one such file. The docker.service file might be present if the daemon parameters have been changed by an administrator. It holds various parameters for Docker daemon. It must be audited, if applicable.","descriptions":{"default":"Audit docker.service, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. docker.service is one such file. The docker.service file might be present if the daemon parameters have been changed by an administrator. It holds various parameters for Docker daemon. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.10","cis-docker-1.13.0":"1.8","level:1":null},"code":"control 'host-1.10' do\n  impact 1.0\n  title 'Audit Docker files and directories - docker.service'\n  desc 'Audit docker.service, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. docker.service is one such file. The docker.service file might be present if the daemon parameters have been changed by an administrator. It holds various parameters for Docker daemon. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.10'\n  tag 'cis-docker-1.13.0': '1.8'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  if docker_helper.path\n    rule = '-w ' + docker_helper.path + ' -p rwxa -k docker'\n    describe auditd do\n      its(:lines) { should include(rule) }\n    end\n  else\n    describe 'audit docker service' do\n      skip 'Cannot determine docker path'\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":221},"id":"host-1.10"},{"title":"Audit Docker files and directories - docker.socket","desc":"Audit docker.socket, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. docker.socket is one such file. It holds various parameters for Docker daemon socket. It must be audited, if applicable.","descriptions":{"default":"Audit docker.socket, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. docker.socket is one such file. It holds various parameters for Docker daemon socket. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.11","cis-docker-1.13.0":"1.9","level:1":null},"code":"control 'host-1.11' do\n  impact 1.0\n  title 'Audit Docker files and directories - docker.socket'\n  desc 'Audit docker.socket, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. docker.socket is one such file. It holds various parameters for Docker daemon socket. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.11'\n  tag 'cis-docker-1.13.0': '1.9'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  if docker_helper.socket\n    rule = '-w ' + docker_helper.socket + ' -p rwxa -k docker'\n    describe auditd do\n      its(:lines) { should include(rule) }\n    end\n  else\n    describe 'audit docker service' do\n      skip 'Cannot determine docker socket'\n    end\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":247},"id":"host-1.11"},{"title":"Audit Docker files and directories - /etc/default/docker","desc":"Audit /etc/default/docker , if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/default/docker is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable.","descriptions":{"default":"Audit /etc/default/docker , if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/default/docker is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"}],"tags":{"host":null,"cis-docker-1.12.0":"1.12","cis-docker-1.13.0":"1.10","level:1":null},"code":"control 'host-1.12' do\n  impact 1.0\n  title 'Audit Docker files and directories - /etc/default/docker'\n  desc 'Audit /etc/default/docker , if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /etc/default/docker is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.12'\n  tag 'cis-docker-1.13.0': '1.10'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /etc/default/docker -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":273},"id":"host-1.12"},{"title":"Audit Docker files and directories - /etc/docker/daemon.json","desc":"Audit /etc/docker/daemon.json, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/docker/daemon.json is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable.","descriptions":{"default":"Audit /etc/docker/daemon.json, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /etc/docker/daemon.json is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"},{"url":"https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file","ref":"Daemon configuration"}],"tags":{"host":null,"cis-docker-1.12.0":"1.13","cis-docker-1.13.0":"1.11","level:1":null},"code":"control 'host-1.13' do\n  impact 1.0\n  title 'Audit Docker files and directories - /etc/docker/daemon.json'\n  desc 'Audit /etc/docker/daemon.json, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /etc/docker/daemon.json is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.13'\n  tag 'cis-docker-1.13.0': '1.11'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n  ref 'Daemon configuration', url: 'https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /etc/docker/daemon.json -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":292},"id":"host-1.13"},{"title":"Audit Docker files and directories - /usr/bin/docker-containerd","desc":"Audit /usr/bin/docker-containerd, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-containerd is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable.","descriptions":{"default":"Audit /usr/bin/docker-containerd, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-containerd is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"},{"url":"https://github.com/docker/docker/pull/20662","ref":"Containerd integration"},{"url":"https://containerd.tools/","ref":"Containerd tools"}],"tags":{"host":null,"cis-docker-1.12.0":"1.14","cis-docker-1.13.0":"1.12","level:1":null},"code":"control 'host-1.14' do\n  impact 1.0\n  title 'Audit Docker files and directories - /usr/bin/docker-containerd'\n  desc 'Audit /usr/bin/docker-containerd, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-containerd is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.14'\n  tag 'cis-docker-1.13.0': '1.12'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n  ref 'Containerd integration', url: 'https://github.com/docker/docker/pull/20662'\n  ref 'Containerd tools', url: 'https://containerd.tools/'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /usr/bin/docker-containerd -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":312},"id":"host-1.14"},{"title":"Audit Docker files and directories - /usr/bin/docker-runc","desc":"Audit /usr/bin/docker-runc, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-runc is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable.","descriptions":{"default":"Audit /usr/bin/docker-runc, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with 'root' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-runc is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable."},"impact":1.0,"refs":[{"url":"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html","ref":"System auditing"},{"url":"https://github.com/docker/docker/pull/20662","ref":"Containerd integration"},{"url":"https://containerd.tools/","ref":"Containerd tools"},{"url":"https://github.com/opencontainers/runc","ref":"Opencontainers runc repository"}],"tags":{"host":null,"cis-docker-1.12.0":"1.15","cis-docker-1.13.0":"1.13","level:1":null},"code":"control 'host-1.15' do\n  impact 1.0\n  title 'Audit Docker files and directories - /usr/bin/docker-runc'\n  desc 'Audit /usr/bin/docker-runc, if applicable.\n\n  Rationale: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with \\'root\\' privileges. Its behavior depends on some key files and directories. /usr/bin/docker-runc is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable.'\n\n  tag 'host'\n  tag 'cis-docker-1.12.0': '1.15'\n  tag 'cis-docker-1.13.0': '1.13'\n  tag 'level:1'\n  ref 'System auditing', url: 'https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/chap-system_auditing.html'\n  ref 'Containerd integration', url: 'https://github.com/docker/docker/pull/20662'\n  ref 'Containerd tools', url: 'https://containerd.tools/'\n  ref 'Opencontainers runc repository', url: 'https://github.com/opencontainers/runc'\n\n  only_if { os.linux? }\n  describe auditd do\n    its(:lines) { should include('-w /usr/bin/docker-runc -p rwxa -k docker') }\n  end\nend\n","source_location":{"ref":"cis-docker-benchmark-master/controls/host_configuration.rb","line":333},"id":"host-1.15"}],"groups":[{"title":"Container Images and Build File","controls":["docker-4.1","docker-4.2","docker-4.3","docker-4.4","docker-4.5","docker-4.6","docker-4.7","docker-4.8","docker-4.9","docker-4.10","docker-4.11"],"id":"controls/container_images.rb"},{"title":"Container Runtime","controls":["docker-5.1","docker-5.2","docker-5.3","docker-5.4","docker-5.5","docker-5.6","docker-5.7","docker-5.8","docker-5.9","docker-5.10","docker-5.11","docker-5.12","docker-5.13","docker-5.14","docker-5.15","docker-5.16","docker-5.17","docker-5.18","docker-5.19","docker-5.20","docker-5.21","docker-5.22","docker-5.23","docker-5.24","docker-5.25","docker-5.26","docker-5.27","docker-5.28","docker-5.29","docker-5.30","docker-5.31"],"id":"controls/container_runtime.rb"},{"title":"Docker Daemon Configuration","controls":["docker-2.1","docker-2.2","docker-2.3","docker-2.4","docker-2.5","docker-2.6","docker-2.7","docker-2.8","docker-2.9","docker-2.10","docker-2.11","docker-2.12","docker-2.13","docker-2.14","docker-2.15","docker-2.16","docker-2.17","docker-2.18","docker-2.19","docker-2.20","docker-2.21","docker-2.22","docker-2.23","docker-2.24"],"id":"controls/docker_daemon_configuration.rb"},{"title":"Docker Daemon Configuration Files","controls":["docker-3.1","docker-3.2","docker-3.3","docker-3.4","docker-3.5","docker-3.6","docker-3.7","docker-3.8","docker-3.9","docker-3.10","docker-3.11","docker-3.12","docker-3.13","docker-3.14","docker-3.15","docker-3.16","docker-3.17","docker-3.18","docker-3.19","docker-3.20"],"id":"controls/docker_daemon_configuration_files.rb"},{"title":"Docker Security Operations","controls":["docker-6.1","docker-6.2","docker-6.3","host-6.4","host-6.5"],"id":"controls/docker_security_operations.rb"},{"title":"Host Configuration","controls":["host-1.1","host-1.2","host-1.3","host-1.4","host-1.5","host-1.6","host-1.7","host-1.8","host-1.9","host-1.10","host-1.11","host-1.12","host-1.13","host-1.14","host-1.15"],"id":"controls/host_configuration.rb"}],"inputs":[{"name":"container_user","options":{"required":false,"description":"define user within containers.","type":"string","value":"ubuntu"}},{"name":"container_capadd","options":{"required":true,"description":"define needed capabilities for containers.","type":"string"}},{"name":"app_armor_profile","options":{"required":false,"description":"define apparmor profile for Docker containers.","type":"string","value":"docker-default"}},{"name":"selinux_profile","options":{"required":false,"description":"define SELinux profile for Docker containers.","type":"string","value":"label:level:s0-s0:c1023"}},{"name":"trusted_user","options":{"required":false,"description":"define trusted user to control Docker daemon.","type":"string","value":"vagrant"}},{"name":"managable_container_number","options":{"required":true,"description":"keep number of containers on a host to a manageable total.","type":"numeric","value":25}},{"name":"benchmark_version","options":{"required":true,"description":"to execute also the old controls from previous benchmarks. to execute the controls, define the value as 1.12.0","type":"string"}},{"name":"registry_cert_path","options":{"required":true,"description":"directory contains various Docker registry directories.","type":"string","value":"/etc/docker/certs.d"}},{"name":"registry_name","options":{"required":true,"description":"directory contain certificate certain Docker registry.","type":"string","value":"/etc/docker/certs.d/registry_hostname:port"}},{"name":"registry_ca_file","options":{"required":false,"description":"directory contain certificate certain Docker registry.","type":"string","value":"/etc/docker/certs.d/registry_hostname:port/ca.crt"}},{"name":"daemon_tlscacert","options":{"required":false,"description":"Trust certs signed only by this CA","type":"string","value":"/etc/docker/ssl/ca.pem"}},{"name":"daemon_tlscert","options":{"required":false,"description":"Path to TLS certificate file","type":"string","value":"/etc/docker/ssl/server_cert.pem"}},{"name":"daemon_tlskey","options":{"required":false,"description":"Path to TLS key file","type":"string","value":"/etc/docker/ssl/server_key.pem"}},{"name":"authorization_plugin","options":{"required":false,"description":"define authorization plugin to manage access to Docker daemon.","type":"string","value":"authz-broker"}},{"name":"log_driver","options":{"required":false,"description":"define preferable way to store logs.","type":"string","value":"syslog"}},{"name":"log_opts","options":{"required":false,"description":"define Docker daemon log-opts.","type":"string","value":"syslog-address"}},{"name":"swarm_mode","options":{"required":false,"description":"define the swarm mode, `active` or `inactive`","type":"string","value":"inactive"}},{"name":"swarm_max_manager_nodes","options":{"required":false,"description":"number of manager nodes in a swarm","type":"numeric","value":3}},{"name":"swarm_port","options":{"required":false,"description":"port of the swarm node","type":"numeric","value":2377}},{"name":"seccomp_default_profile","options":{"required":false,"description":"define the default seccomp profile","type":"string","value":"default"}}],"sha256":"8a7663bd3a28c0888d878e1e21cc198efcd458d472ca24ffe837c3f20edcbe1f","status":"loaded","generator":{"name":"inspec","version":"3.9.3"}}
